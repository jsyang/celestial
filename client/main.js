!function(t){function e(e){for(var a,r,l=e[0],c=e[1],s=e[2],u=0,h=[];u<l.length;u++)r=l[u],i[r]&&h.push(i[r][0]),i[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);for(p&&p(e);h.length;)h.shift()();return o.push.apply(o,s||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],a=!0,l=1;l<n.length;l++){var c=n[l];0!==i[c]&&(a=!1)}a&&(o.splice(e--,1),t=r(r.s=n[0]))}return t}var a={},i={0:0},o=[];function r(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=a,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var l=window.webpackJsonp=window.webpackJsonp||[],c=l.push.bind(l);l.push=e,l=l.slice();for(var s=0;s<l.length;s++)e(l[s]);var p=c;o.push([297,1]),n()}({141:function(module,__webpack_exports__,__webpack_require__){"use strict";var pixi_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),pixi_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(pixi_js__WEBPACK_IMPORTED_MODULE_0__),TEXT="\nClick to add a new vertex to each polyline\n\nPress Z to undo last vertex\nPress Q / P to add / delete a layer\nPress H to export all layers\n\nPress S to set the scale of the preview / exported geometry\n",DIVISION=12,SIZE=400,scaleX=.25,scaleY=.25,layerPoints=[],editor,preview;function getRelativeXY(t){var e=t.data.originalEvent,n=e.x,a=e.y,i=DIVISION/SIZE,o=1/i,r=n-editor.x,l=a-editor.y;return{x:r,y:l,gridX:Math.min(Math.round(r*i)*o,SIZE),gridY:Math.min(Math.round(l*i)*o,SIZE)}}function onClick(t){var e=editor.children,n=getRelativeXY(t),a=n.gridX,i=n.gridY,o=e[e.length-1],r=layerPoints[layerPoints.length-1];r.push(a),r.push(i),updateLayer(o,r)}function onMouseMove(t){var e=getRelativeXY(t),n=e.gridX,a=e.gridY;editor.children[1].x=n,editor.children[1].y=a}function deleteLayer(){1<layerPoints.length?(editor.removeChild(editor.children[editor.children.length-1]),layerPoints.pop()):layerPoints[0]=[],updatePreview()}function exportLayers(){var t=1<layerPoints.length?JSON.stringify(layerPoints):JSON.stringify(layerPoints[0]);prompt("Exported geometry",t)}var setScale=function(){var userScaleX=prompt('Scale X coordinates\nYou may also use fractions here, e.g. "0.25" or "1/4"',scaleX.toString())||"1/4",userScaleY=prompt('Scale Y coordinates\nYou may also use fractions here, e.g. "0.25" or "1/4"',scaleY.toString())||"1/4";scaleX=parseFloat(eval(userScaleX)),scaleY=parseFloat(eval(userScaleY))};function onKeyPress(t){var e;switch(t.which){case 115:setScale(),updatePreview();break;case 104:exportLayers();break;case 112:deleteLayer();break;case 113:addLayer();break;case 122:var n=editor.children;(e=layerPoints[layerPoints.length-1]).pop(),e.pop(),updateLayer(n[n.length-1],e)}}function create(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),(editor=new pixi_js__WEBPACK_IMPORTED_MODULE_0__.Graphics).lineStyle(1,16777215,.25),editor.beginFill(0,0),editor.drawRect(0,0,SIZE,SIZE),editor.endFill(),editor.x=t,editor.y=e,editor.interactive=!0,editor.hitArea=new pixi_js__WEBPACK_IMPORTED_MODULE_0__.Rectangle(0,0,SIZE,SIZE),editor.buttonMode=!0,editor.click=onClick,editor.mousemove=onMouseMove,drawGridLines(),drawHelpLabel(),addSnapCursor(),addPreviewWindow(),addLayer(),addEventListener("keypress",onKeyPress),editor}function addPreviewWindow(){(preview=new pixi_js__WEBPACK_IMPORTED_MODULE_0__.Graphics).x=SIZE+20,preview.y=0,editor.addChild(preview)}function addSnapCursor(){var t=new pixi_js__WEBPACK_IMPORTED_MODULE_0__.Graphics;t.lineStyle(1,16711680,1),t.drawRect(-2,-2,4,4),editor.addChild(t)}function addLayer(){editor.addChild(new pixi_js__WEBPACK_IMPORTED_MODULE_0__.Graphics),layerPoints.push([])}function drawGridLines(){var t,e=SIZE/DIVISION;for(t=0;t<SIZE;t+=e)t>>0==SIZE>>1?editor.lineStyle(1,16777215,.5):editor.lineStyle(1,16777215,.25),editor.moveTo(t,0),editor.lineTo(t,SIZE);for(t=0;t<SIZE;t+=e)t>>0==SIZE>>1?editor.lineStyle(1,16777215,.5):editor.lineStyle(1,16777215,.25),editor.moveTo(0,t),editor.lineTo(SIZE,t)}function drawHelpLabel(){var t=new pixi_js__WEBPACK_IMPORTED_MODULE_0__.Text(TEXT,{fontFamily:"arial",fontSize:12,fill:16777215});t.x=0,t.y=editor.height,editor.addChild(t)}function updateLayer(t,e){t.clear(),t.lineStyle(1,16711680,1),t.drawPolygon(e),updatePreview()}function updatePreview(){preview.clear(),preview.lineStyle(1,65280,1);var t=function(t,e){return e%2?scaleX*t:scaleY*t};layerPoints.forEach(function(e){return preview.drawPolygon(e.map(t))})}function destroy(){removeEventListener("keypress",onKeyPress)}__webpack_exports__.a={create:create,destroy:destroy}},250:function(t,e){},297:function(t,e,n){"use strict";n.r(e);var a,i,o,r=n(0);r.settings.SCALE_MODE=r.SCALE_MODES.NEAREST;var l=new r.Container;function c(){i=innerWidth,o=innerHeight,a&&a.resize(i,o)}var s,p,u={init:function(){!function(){for(;l.children[0];)l.removeChild(l.children[0])}(),void 0===a&&(c(),a=new r.WebGLRenderer(i,o),document.body.appendChild(a.view))},addChild:function(t){return l.addChild(t)},removeChild:function(t){return l.removeChild(t)},onResize:c,render:function(){return a.render(l)}},h=n(141),d=1e3/60;function f(){var t=Date.now(),e=t-p;d<e&&(u.render(),p=t-e%d),s=requestAnimationFrame(f)}var y={start:function(){u.init(),u.addChild(h.a.create(20,20)),p=Date.now(),f()},stop:function(){cancelAnimationFrame(s)}},m=function(t,e){return Math.round(g(t,e))},g=function(t,e){return t+Math.random()*(e-t)},v={int:m,float:g,arrayElement:function(t){return t[m(0,t.length-1)]}},_=[];function T(t){var e=t.color,n=t.size,a=t.x,i=t.y,o=new r.Graphics;return o.beginFill(e),o.drawRect(0,0,n,n),o.lineWidth=n,o.endFill(),o.x=a,o.y=i,o}var E={speed:.01,count:8,size:2,color:11184810,x:0,y:0},S={speed:.3,count:20,size:1,color:15790320,x:0,y:0},P=innerWidth>>1,x=innerHeight>>1;function b(){O=null}var O=null,A={init:function(){var t;if(0===_.length){for(t=0;t<S.count;t++)_.push(T(S));for(t=0;t<E.count;t++)_.push(T(E))}else b();return _},process:function(t){if(t){var e=t.x,n=t.y,a=0,i=0;O?(a=e-O.x,i=n-O.y):(o=t,P=innerWidth>>1,x=innerHeight>>1,_.forEach(function(t){t.x=o.x+v.float(-P,P),t.y=o.y+v.float(-x,x)})),_.forEach(function(t,e,n,a){1===a.lineWidth?(t*=S.speed,e*=S.speed):(t*=E.speed,e*=E.speed),a.x+=t,a.y+=e,a.x<n.x-P?a.x=n.x+P:a.x>n.x+P&&(a.x=n.x-P),a.y<n.y-x?a.y=n.y+x:a.y>n.y+x&&(a.y=n.y-x)}.bind(null,a,i,t)),O={x:e,y:n}}else O=null;var o},onResize:b},C={componentFlag:"canAutoTargetEnemy",DEFAULTS:{AUTO_TARGET_ENEMY_TIME:1500,autoTargetSearchDist2:16e4,autoTargetLastSearchTime:0},process:function(t){if(t.canAttack){var e=Date.now();e-t.autoTargetLastSearchTime>=t.AUTO_TARGET_ENEMY_TIME&&((n=t).attackTarget=sr.getNearestEnemyUnit(n,n.autoTargetSearchDist2),n.isAttacking=Boolean(n.attackTarget),t.autoTargetLastSearchTime=e)}var n}},w=function(){return(w=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},F={left:!1,right:!1,up:!1,down:!1,analogAngle:0,button0:!1,button1:!1,button2:!1,button3:!1},M={getEvents:function(t){void 0===t&&(t=0);var e,n,a,i,o,r,l,c,s=navigator.getGamepads()[t];if(s){var p=s.axes,u=p[0],h=p[1],d=.1<Math.abs(u),f=.1<Math.abs(h),y=void 0;(d||f)&&(d||(u=0<u?1e-6:-1e-6),f||(h=0<h?1e-6:-1e-6),y=Math.atan2(h,u)),F={left:s.axes[0]<-.1,right:.1<s.axes[0],up:s.axes[1]<-.1,down:.1<s.axes[1],analogAngle:y,button0:s.buttons[0].pressed,button1:s.buttons[1].pressed,button2:s.buttons[2].pressed,button3:s.buttons[3].pressed}}return n=(e=F).left,a=e.right,e.up,i=e.analogAngle,o=e.button0,r=e.button1,l=e.button2,c=e.button3,{TURN_LEFT:Boolean(n),TURN_RIGHT:Boolean(a),ACCELERATE:Boolean(c),SPECIAL:Boolean(r),SHOOT:Boolean(o),PAUSE:Boolean(l),FOCUS_NEXT_ENEMY:!1,TARGET_NEXT_ENEMY:!1,TOGGLE_RADAR:!1,NAV_POINT_SET:!1,NAV_POINT_CLEAR:!1,analogAngle:i}},getInputState:function(){return w({},F)}},R=function(){return(R=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},k={27:"escape",32:"spacebar",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:"0",37:"left_arrow",38:"up_arrow",39:"right_arrow",40:"down_arrow",69:"e",80:"p",70:"f",77:"m",84:"t",88:"x",81:"q",190:".",13:"enter",8:"backspace"},I={left_arrow:!1,right_arrow:!1,up_arrow:!1,down_arrow:!1,p:!1,q:!1,e:!1,f:!1,m:!1,t:!1,x:!1,".":!1,1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1,8:!1,9:!1,0:!1,spacebar:!1,backspace:!1,enter:!1};addEventListener("keydown",function(t){var e=t.which;I[k[e]]=!0}),addEventListener("keyup",function(t){var e=t.which;I[k[e]]=!1});var D,N,L={getEvents:function(){return{PAUSE:Boolean(I.p),TURN_LEFT:Boolean(I.left_arrow),TURN_RIGHT:Boolean(I.right_arrow),ACCELERATE:Boolean(I.up_arrow),SHOOT:Boolean(I.f),FOCUS_NEXT_ENEMY:Boolean(I["."]),TARGET_NEXT_ENEMY:Boolean(I.t),TOGGLE_RADAR:Boolean(I.m),NAV_POINT_SET:Boolean(I.enter),NAV_POINT_CLEAR:Boolean(I.backspace),SPECIAL:Boolean(I.spacebar),OPTION1:Boolean(I[1]),OPTION2:Boolean(I[2]),OPTION3:Boolean(I[3]),OPTION4:Boolean(I[4]),OPTION5:Boolean(I[5]),OPTION6:Boolean(I[6]),OPTION7:Boolean(I[7]),OPTION8:Boolean(I[8]),OPTION9:Boolean(I[9]),OPTION0:Boolean(I[0])}},getInputState:function(){return R({},I)}};(N=D||(D={})).AudioMuted="mute",N.GamePadInUse="gamepad",N.SkipTitleScreen="game",N.GeometryEditorInUse="editor",N.TestSectorInUse="test";var H={};location.search.slice(1).split("&").forEach(function(t){var e=t.split("="),n=e[0],a=e[1];H[n]=a});var B,U,j,G=function(t){return H.hasOwnProperty(t)},z=G(D.AudioMuted),W=G(D.GamePadInUse),X=G(D.SkipTitleScreen),q=G(D.TestSectorInUse),V=G(D.GeometryEditorInUse);(U=B||(B={}))[U.Keyboard=0]="Keyboard",U[U.GamePad=1]="GamePad",j=W?B.GamePad:B.Keyboard;var Y,Z=function(){return j===B.Keyboard?L:M},K={getFocus:function(){return Y?{x:Y.x,y:Y.y}:{x:0,y:0}},setFocus:function(t){return Y=t}},J=0,Q=62.5;function $(t,e){var n=Date.now(),a=n-J;Q<a&&(e.up||e.up_arrow?t.prevButton():e.down||e.down_arrow?t.nextButton():(e.f||e.button0||e.button1||e.button2||e.button3)&&t.clickButton(),J=n-a%Q)}var tt=n(14),et=function(t,e){return new tt.Vector(t,e)},nt=2*Math.PI;function at(t,e){var n=t.x,a=t.y,i=e.geo.collider,o=et(n,a);return i instanceof tt.Circle?0!==i.r&&Object(tt.pointInCircle)(o,i):Object(tt.pointInPolygon)(o,i)}var it,ot,rt=function(t,e,n,a,i){return void 0===e&&(e=0),void 0===n&&(n=0),void 0===a&&(a=1),void 0===i&&(i=1),t.map(function(t,o){return o%2==0?t*a+e:t*i+n})};function lt(t){var e,n=t.lineStyle,a=t.fill,i=t.type,o=t.path,l=t.collisionPath,c=t.radius,s=t.collisionRadius,p=t.x,u=t.y,h=new r.Graphics;n&&h.lineStyle(n.width,n.color,n.alpha),a?h.beginFill(a.color,a.alpha):h.beginFill(0,0),h.x=p||0,h.y=u||0;var d=et(h.x,h.y);if("circle"===i)h.drawCircle(0,0,c),e=new tt.Circle(d,s||c);else{for(var f=[],y=l||o,m=0;m<y.length;m+=2)f.push(et(y[m],y[m+1]));h.drawPolygon(o),e=new tt.Polygon(d,f)}return h.endFill(),{set x(t){t<0?t=0:st<t&&(t=st),this.graphics.x=t,this.collider.pos.x=t},set y(t){t<0?t=0:st<t&&(t=st),this.graphics.y=t,this.collider.pos.y=t},set rotation(t){t>Math.PI?t-=nt:t<-Math.PI&&(t+=nt),this.collider instanceof tt.Circle||(this.collider.setAngle(t),this.graphics.rotation=t)},get x(){return this.graphics.x},get y(){return this.graphics.y},get rotation(){return this.graphics.rotation},graphics:h,collider:e}}(ot=it||(it={})).Circle="circle",ot.Polygon="polygon";var ct,st=32768,pt=.05,ut=.2,ht=1,dt={d:[0,0,266.6666666666667,0,400,100,400,300,266.6666666666667,400,0,400,0,0],f:[400,0,0,0,0,400,0,200,300,200],g:[400,0,100,0,0,100,0,300,100,400,300,400,400,300,400,166.66666666666669,200,166.66666666666669],h:[0,0,0,400,0,200,400,200,400,0,400,400],j:[400,0,400,333.33333333333337,333.33333333333337,400,66.66666666666667,400,0,333.33333333333337],k:[0,0,0,400,0,200,266.6666666666667,200,400,0,266.6666666666667,200,400,400],n:[0,400,0,0,400,400,400,0],p:[0,400,0,0,300,0,400,100,300,200,0,200],q:[66.66666666666667,0,0,66.66666666666667,0,266.6666666666667,66.66666666666667,333.33333333333337,300,333.33333333333337,400,400,200,266.6666666666667,300,333.33333333333337,366.6666666666667,266.6666666666667,366.6666666666667,66.66666666666667,300,0,66.66666666666667,0],r:[0,400,0,0,300,0,400,100,300,200,0,200,300,200,400,266.6666666666667,400,400],u:[400,0,400,400,66.66666666666667,400,0,333.33333333333337,0,0],v:[0,0,0,133.33333333333334,200,400,400,133.33333333333334,400,0],w:[0,0,0,400,200,166.66666666666669,400,400,400,0],x:[0,0,0,100,66.66666666666667,200,200,200,66.66666666666667,200,0,300,0,400,0,300,66.66666666666667,200,333.33333333333337,200,400,100,400,0,400,100,333.33333333333337,200,400,300,400,400],y:[0,0,0,200,133.33333333333334,266.6666666666667,266.6666666666667,266.6666666666667,400,200,400,0,400,200,266.6666666666667,266.6666666666667,200,266.6666666666667,200,400],z:[0,0,400,0,400,33.333333333333336,0,300,0,400,400,400],c:[400,100,300,0,100,0,0,100,0,300,100,400,300,400,400,300],e:[400,0,0,0,0,200,300,200,0,200,0,400,400,400],l:[0,0,0,400,400,400],s:[400,0,100,0,0,100,100,200,300,200,400,300,300,400,0,400],t:[0,0,200,0,200,400,200,0,400,0],i:[0,0,400,0,200,0,200,400,0,400,400,400],a:[0,400,0,166.66666666666669,200,0,400,166.66666666666669,400,400,400,200,0,200],b:[400,100,300,0,0,0,0,400,300,400,400,300,300,200,0,200,300,200,400,100],m:[0,400,0,0,200,266.6666666666667,400,0,400,400],o:[0,100,100,0,300,0,400,100,400,300,300,400,100,400,0,300,0,100],symbol:[[0,233.33333333333334,0,166.66666666666669,33.333333333333336,66.66666666666667,66.66666666666667,33.333333333333336,166.66666666666669,0,233.33333333333334,0,333.33333333333337,33.333333333333336,366.6666666666667,66.66666666666667,400,166.66666666666669,400,233.33333333333334,366.6666666666667,333.33333333333337,333.33333333333337,366.6666666666667,233.33333333333334,400,166.66666666666669,400,66.66666666666667,366.6666666666667,33.333333333333336,333.33333333333337,0,233.33333333333334,400,166.66666666666669],[33.333333333333336,66.66666666666667,366.6666666666667,333.33333333333337]]},ft=rt([200,0,0,200,200,400,400,200,200,0],0,0,.02,.02),yt=rt([0,0,100,100,300,100,400,0,300,100,300,300,400,400,300,300,100,300,0,400,100,300,100,100],0,0,.02,.02),mt=rt([0,400,0,0,66.66666666666667,0,333.33333333333337,333.33333333333337,333.33333333333337,0,400,0,400,400,300,400,66.66666666666667,100,66.66666666666667,400,0,400],0,0,.02,.02),gt=[[0,10,0,0,-10,-10,0,0,10,0],[-10,0,0,0,10,-10,0,0,0,10],[0,-10,0,0,10,10,0,0,-10,0],[10,0,0,0,-10,10,0,0,0,-10]],vt={NONE:-1,BLUE:0,GREEN:1,RED:2,YELLOW:3,MAGENTA:4},_t=[255,65280,16711680,16776960,16711935],Tt=function(t){return t===vt.MAGENTA},Et=function(){return(Et=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},St=new PIXI.Graphics;St.visible=!1;var Pt=0,xt={init:function(){return yr.addChild(St)},setNavPoint:function(t){ct=t,St.x=t.x,St.y=t.y,St.visible=!0},update:function(){St.visible&&(60<Pt?Pt=0:Pt+=.5,St.clear(),St.lineStyle(1,65535,.4),St.beginFill(0,0),St.drawCircle(0,0,Pt),St.drawCircle(0,0,60-Pt),St.endFill())},getNavPoint:function(){return Et({},ct)},clear:function(){ct=null,St.visible=!1}};function bt(t,e){var n=e.x-t.x,a=e.y-t.y;return n*n+a*a}function Ot(t,e){var n=e.x-t.x,a=e.y-t.y;return Math.atan2(a,n)}var At=1e-6,Ct=n(142),wt=n.n(Ct),Ft=new AudioContext,Mt={},Rt=!z;function kt(t){if(Rt){var e=Ft.createBufferSource();e.buffer=Mt[t],e.connect(Ft.destination),e.start()}}var It=Math.pow(3e3,2)>>12,Dt=1/Math.log(It),Nt=wt()(function(t){return 1-Math.log(t)*Dt});function Lt(t,e){if(Rt){var n=K.getFocus(),a=Math.max(bt(e,n)>>12,1);if(a<It){var i=Ft.createBufferSource(),o=Ft.createGain();i.buffer=Mt[t],o.gain.value=Nt(a),i.connect(o),o.connect(Ft.destination),i.start()}}}var Ht,Bt=0,Ut=["Fighter","Freighter","PBase","PColony","PComm","PLab","SpacePort"].join(","),jt=function(t){return!Tt(t.team)&&-1!==Ut.indexOf(t.type)};function Gt(t){return!t.pbase||!t.pcolony}function zt(t){return t.pcolony&&!t.pcolony.isManufacturing}function Wt(t,e,n){if(e){var a=void 0;if(Tt(t)&&Ht){var i=Ht.pcolony;i&&!i.isManufacturing&&(a=i)}a||(a=v.arrayElement(e).pcolony),a&&a.orderManufacture(n)}}function Xt(t){var e=t.planet,n=t.isDockedPlanet,a=t.team,i=t.isDockedSpacePort,o=t.reload_HomingMissile,r=t.reload_ClusterRocket,l=t.reload_LaserBolt,c=!1;i?(t.hp<t.maxHp&&(c=Tt(a),t.hp=t.maxHp,Oa.displayText(t.team,"Fully repaired.")),o&&t.reload_HomingMissile(!1),r&&t.reload_ClusterRocket(!1),l&&t.reload_LaserBolt(!1)):n&&a===e.team&&e.isOccupied()&&(o&&t.reload_HomingMissile(),r&&t.reload_ClusterRocket(),l&&t.reload_LaserBolt(),t.hp<t.maxHp&&(c=Tt(a),t.hp+=.5,Oa.displayText(t.team,"Repairing: "+Math.round(t.hp/t.maxHp*100)+"%"))),c&&kt("repaired")}function qt(t){if(!t.colonizationTarget){var e,n=1/0;sr.getByType("Planet").forEach(function(a){var i=bt(t,a);i<n&&(e=a,n=i)}),e&&(t.exitPlanetOrbit(),t.colonizationTarget=e)}}function Vt(t,e){var n=t.planet===Ht||t.spaceport&&t.spaceport.planet===Ht;return((e.planet===Ht||e.spaceport&&e.spaceport.planet===Ht)>>0)-(n>>0)}function Yt(t){var e,n=function(e){return e.team===t},a=function(e){return e.team!==t},i=sr.getByType("Planet").filter(n),o=sr.getByType("PColony").filter(n),r=sr.getByType("Freighter").filter(n),l=sr.getByType("Fighter").filter(n);if(e=0<(e=i.filter(zt)).length?e:void 0,0===i.length&&0<r.length?r.forEach(qt):i.filter(Gt).forEach(function(t,e){var n=!1;if(0<t.length){for(var a=t.length-1;0<=a;a--){var i=t[a];if(!Boolean(i.colonizationTarget)){i.isOrbitingPlanet&&i.exitPlanetOrbit(),i.colonizationTarget=e,n=!0;break}}n&&Oa.displayText(t[0].team,"Freighter fleet heading towards target.")}}.bind(null,r)),l.length<i.length&&Wt(t,e,"Fighter"),0<l.length){var c=v.arrayElement(l);if(Tt(t)&&(Ht&&!Tt(Ht.team)&&(Ht=null),Re.getControlledEntity()||(c=l.filter(function(t){return!t.isFighterAutoAccelerated||!t.attackTarget&&(t.planet||t.spaceport)}).sort(Vt)[0])&&(c.isFighterAutoAccelerated=!1,Re.setControlledEntity(c),K.setFocus(c),A.init())),c&&!c.attackTarget&&c.isFighterAutoAccelerated){var s=Math.random(),p=void 0;s<.1?(p=v.arrayElement(sr.getByType("Freighter").filter(a)),Oa.displayText(t,"Friendly Fighter targeting enemy Freighter!")):s<.3&&(p=v.arrayElement(sr.getByType("PBase").filter(a)),Oa.displayText(t,"Friendly Fighter targeting enemy planet!")),p&&(c.attackTarget=p)}}l.forEach(Xt),i.length>r.length&&Wt(t,e,"Freighter"),0===o.length&&0===l.length&&0===r.length&&(Zt=Zt.filter(function(e){return e!==t}),Qt(t))}var Zt,Kt=0,Jt=[vt.GREEN,vt.BLUE,vt.YELLOW,vt.RED,vt.MAGENTA],Qt=new Function,$t=new Function,te={init:function(){Zt=Jt.slice()},update:function(){var t=Date.now();3e3<t-Kt&&(Zt.forEach(Yt),1===Zt.length&&$t(Zt[0]),Kt=t)},setHumanFightersTarget:function(t){sr.getByType("Fighter").forEach(function(e){Tt(e.team)&&(e.attackTarget=t)}),kt("alert"),Oa.displayText(vt.MAGENTA,"All fighters attacking your target!")},setHumanTeamHomePlanet:function(t){kt("install"),Ht=t},setOnTeamLostCallback:function(t){return Qt=t},setOnTeamWinCallback:function(t){return $t=t}},ee=["Fighter is docked","  [1] Swap weapon","  [2] Set current location as home"],ne="Cannon",ae=[function(t,e){var n=e.isDockedPlanet,a=e.isDockedSpacePort,i=e.planet,o=e.spaceport,r=e.team;return n&&i.team===r||a&&o.team===r},function(t,e){switch(t.menuId){case 0:Oa.displayCommandText(ee),t.menuId=1,t.options=[function(){return t.menuId=2},function(){te.setHumanTeamHomePlanet(e.planet||e.spaceport.planet),t.shouldReset=!0}];break;case 2:var n=(e.planet||e.spaceport.planet).plab,a=!(!n||!n.developEquipment_equipmentReady||"Shield"===n.developEquipment_equipmentReady)&&n.developEquipment_equipmentReady,i=["Swap Fighter's "+e.attackWeapon+" for","  [1] Cannon"];t.menuId=3,t.options=[function(){n&&e.attackWeapon!==ne&&(n.developEquipment_equipmentReady=e.attackWeapon),e.attackWeapon=ne,t.shouldReset=!0}],a&&(i.push("  [2] "+a),t.options.push(function(){n&&e.attackWeapon!==ne&&(n.developEquipment_equipmentReady=e.attackWeapon),e.attackWeapon=a,t.shouldReset=!0})),Oa.displayCommandText(i)}return!0}],ie=["Wingmates:","  [1] Attack my target"],oe=[function(t,e){var n=e.attackTarget;return n&&0<n.hp},function(t,e){switch(t.menuId){case 0:var n=e.attackTarget;Oa.displayCommandText(ie),t.menuId=1,t.options=[function(){te.setHumanFightersTarget(n),t.shouldReset=!0}]}return!0}],re={isCommanding:!1,shouldReset:!1,menuId:0,options:[]},le=function(){re.isCommanding=!1,re.shouldReset=!1,re.menuId=0,re.options=[],Oa.displayCommandText()},ce={update:function(t,e,n){if(re.shouldReset&&le(),re.isCommanding){var a=function(a){return a(re,t,e,n)};t&&(ae.every(a),oe.every(a))}var i;e.OPTION1&&!n.OPTION1?i=re.options[0]:e.OPTION2&&!n.OPTION2?i=re.options[1]:e.OPTION3&&!n.OPTION3?i=re.options[2]:e.OPTION4&&!n.OPTION4?i=re.options[3]:e.OPTION5&&!n.OPTION5?i=re.options[4]:e.OPTION6&&!n.OPTION6?i=re.options[5]:e.OPTION7&&!n.OPTION7?i=re.options[6]:e.OPTION8&&!n.OPTION8?i=re.options[7]:e.OPTION9&&!n.OPTION9?i=re.options[8]:e.OPTION0&&!n.OPTION0?i=le:e.SPECIAL&&!n.SPECIAL&&(re.isCommanding=!re.isCommanding,re.isCommanding||(re.shouldReset=!0)),i&&i()},reset:le};var se=-1;function pe(t){var e=sr.getByType("Fighter");return e[se+=t?1:-1]||(se=t?0:e.length-1),e[se]}function ue(t,e){t.interactive=!0,t.interactiveChildren=!1,t.buttonMode=!0,t.click=e}var he,de,fe=function(){return(fe=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},ye=16,me=[[100,0,0,0,0,100],[300,0,400,0,400,100],[400,300,400,400,300,400],[100,400,0,400,0,300]].map(function(t){return rt(t,-8,-8,.04,.04)}),ge=!1,ve={x:0,y:0},_e={x:0,y:0},Te=0,Ee=0,Se=0,Pe=new r.Graphics;Pe.x=ye,Pe.y=ye,ue(Pe,function(t){var e=t.data.global,n=e.x,a=e.y;Oe(!1);var i={x:(n-ye)/Te,y:(a-ye)/Ee};K.setFocus(i),he.revertControlToAI&&he.revertControlToAI(),he.setControlledEntity(fe({},i,{hp:1})),A.init()}),Pe.mousemove=function(t){var e=t.data.global,n=e.x,a=e.y;ge&&(ve.x=n,ve.y=a)};var xe=function(t){var e,n,a=t.type,i=t.team,o=t.x*Te,r=t.y*Ee;switch(a){case"Planet":n=65280,e=12,Pe.beginFill(n,.1),Pe.lineStyle(0,0,0),Pe.drawCircle(o,r,e),i!==vt.NONE&&(Pe.endFill(),Pe.beginFill(_t[i],.75),Pe.lineStyle(0,0,0),Pe.drawRect(o-1.5,r-1,3,2));break;case"Star":n=16776960,e=16,Pe.beginFill(0,0),Pe.lineStyle(1,n,1),Pe.drawCircle(o,r,e);break;case"Fighter":n=_t[i],e=2,Pe.beginFill(n,1),Pe.lineStyle(1,n,1),Pe.drawRect(o-e/2,r-e/2,e,e),t===de&&(Pe.endFill(),Pe.beginFill(0,0),Pe.lineStyle(1,16777215,1),me.forEach(function(t){return Pe.drawPolygon(rt(t,o,r))}));break;case"Freighter":default:n=11184810,e=4,Pe.beginFill(0,0),Pe.lineStyle(1,n,1),Pe.drawRect(o-e/2,r-e/2,e,e)}Pe.endFill()};function be(){_e.x=innerWidth-2*ye,_e.y=innerHeight-2*ye,Te=_e.x/st,Ee=_e.y/st}function Oe(t){t&&be(),Pe.visible=t,ge=t}var Ae,Ce={init:function(t){void 0===t&&(t=Re),he=t,yr.addChildToHUD(Pe)},update:function(){if(ge){var t,e,n=Date.now();125<n-Se&&(Pe.clear(),Pe.beginFill(526344,1),Pe.lineStyle(1,16777215,.25),Pe.drawRect(0,0,_e.x,_e.y),Pe.endFill(),de=he.getControlledEntity(),sr.getByType("Star").forEach(xe),sr.getByType("Planet").forEach(xe),sr.getByType("Freighter").forEach(xe),sr.getByType("Fighter").forEach(xe),t=ve.x,e=ve.y,Pe.beginFill(0,0),Pe.lineStyle(1,13421772,1),Pe.drawRect(t-ye-.5*_e.x*Te,e-ye-.5*_e.y*Ee,innerWidth*Te,innerHeight*Ee),Pe.endFill(),Se=n)}},onResize:be,getIsVisible:function(){return ge},setVisible:Oe},we=function(t){return Ae=t},Fe={};function Me(){Ae&&Tt(Ae.team)&&(Ae.isFighterAutoAccelerated=!0)}var Re={update:function(){var t=Z(),e=t.getEvents(),n=t.getInputState();if(e.PAUSE&&!Fe.PAUSE&&Qr.togglePause(),Qr.getIsPaused())Ae&&Ae.modal&&$(Ae,n);else{if(Ae)if(Ae.modal)$(Ae,n);else if(0<Ae.hp){if(K.setFocus(Ae),Tt(Ae.team))switch(Ae&&Tt(Ae.team)&&(Ae.isFighterAutoAccelerated=!1),Ae.type){case"Fighter":!function(t,e,n){var a=t.isDockedPlanet,i=t.isDockedSpacePort,o=t.attackTarget,r=a||i;if(!r){if("number"==typeof e.analogAngle?t.rotation=e.analogAngle:e.TURN_LEFT?t.rotation-=pt:e.TURN_RIGHT&&(t.rotation+=pt),t.isAttacking=e.SHOOT,e.NAV_POINT_SET&&!n.NAV_POINT_SET){var l={x:t.x,y:t.y};xt.setNavPoint(l)}else e.NAV_POINT_CLEAR&&!n.NAV_POINT_CLEAR&&xt.clear();e.TARGET_NEXT_ENEMY&&!n.TARGET_NEXT_ENEMY&&(t.attackTarget=function(t){var e=sr.getNearestUnits(t).filter(jt);e[++Bt]||(Bt=0);var n=e[Bt];return n&&kt("bopp"),n}(t))}e.ACCELERATE?(r&&(a?t.undockPlanet():i&&t.undockSpacePort(),t.accelerate(ht),ce.reset()),t.flameOn(),t.accelerate(ut)):t.flameOff(),o&&o.hp<=0&&(t.attackTarget=null,ce.reset())}(Ae,e,Fe)}}else ce.reset(),we(null);e.FOCUS_NEXT_ENEMY&&!Fe.FOCUS_NEXT_ENEMY&&(A.process(null),Me(),K.setFocus(we(pe(!0)))),e.TOGGLE_RADAR&&!Fe.TOGGLE_RADAR&&Ce.setVisible(!Ce.getIsVisible()),ce.update(Ae,e,Fe)}Fe=e},getControlledEntity:function(){return Ae},setControlledEntity:we,revertControlToAI:Me},ke=new r.Graphics;ke.x=12,ke.y=164;var Ie=new r.Text("Unknown",{fontFamily:"arial",fontSize:12,fill:16316664,align:"left"});Ie.x=0,Ie.y=0;var De=new r.Graphics;De.x=0,De.y=16;var Ne=new r.Graphics;Ne.x=0,Ne.y=16,ke.addChild(Ie),ke.addChild(De),ke.addChild(Ne);var Le=0,He=function(){yr.addChildToHUD(ke)},Be=function(){if(0<Le)Le--;else{Le=10;var t=Re.getControlledEntity();t&&t.type?(Tt(t.team)?Ie.text=t.type:Ie.text="Enemy "+t.type,n=(e=t).hp,a=e.maxHp,i=Math.floor(n/a*100),De.clear(),De.beginFill(6728294,1),De.drawRect(0,0,i,12),De.endFill(),Ne.clear(),Ne.beginFill(11167334,1),Ne.drawRect(0,0,100-i,12),Ne.endFill(),Ne.x=i):(Ie.text="",De.clear(),Ne.clear())}var e,n,a,i},Ue=new r.Graphics;Ue.x=12,Ue.y=202;var je=new r.Text("Unarmed",{fontFamily:"arial",fontSize:12,fill:16316664,align:"left"});je.x=0,je.y=0;var Ge=new r.Text("",{fontFamily:"arial",fontSize:12,fill:16711680,align:"left"});Ge.x=0,Ge.y=14,Ue.addChild(je),Ue.addChild(Ge);var ze,We,Xe=function(){yr.addChildToHUD(Ue)},qe=function(){var t=Re.getControlledEntity();if(je.text="",Ge.text="",t&&t.canAttack){var e=t.attackWeapon,n=t.ammo_HomingMissile,a=t.ammo_ClusterRocket,i=t.ammo_LaserBolt;switch(je.text=e){case"HomingMissile":Ge.text="|".repeat(n);break;case"ClusterRocket":Ge.text="|".repeat(a);break;case"LaserBolt":Ge.text="|".repeat(i);break;case"HeavyCannon":case"Cannon":default:Ge.text="Infinite ammo"}}},Ve=function(){function t(){this.team=vt.NONE}return Object.defineProperty(t.prototype,"x",{get:function(){return this.geo.x},set:function(t){this.geo.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.geo.y},set:function(t){this.geo.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.geo.rotation},set:function(t){this.geo.rotation=t},enumerable:!0,configurable:!0}),t.prototype.getChildAt=function(t){return this.geo.graphics.getChildAt(t)},t.prototype.setChildVisible=function(t,e){var n=this.getChildAt(t);n&&(n.visible=e)},t.prototype.assignTeamColor=function(){var t=_t[this.team];return this.geo.graphics.currentPath.lineColor=t},t.prototype.renderHit=function(){0<this.hitTime?(this.hitTime--,this.geo.graphics.alpha=Math.random()):0===this.hitTime&&(this.hitTime=-1,this.geo.graphics.alpha=1)},t}(),Ye=(ze=function(t,e){return(ze=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}ze(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Ze={body:{type:it.Circle,radius:100,fill:{color:0,alpha:1},lineStyle:{width:1,color:65280,alpha:1}},flag:{type:it.Polygon,fill:{color:16777215,alpha:1},path:[-5,-4,-5,4,5,4,5,-4]}},Ke=function(t){function e(e){var n=t.call(this)||this;return n.type="Planet",n.canOrbitStar=!0,n.canStoreMaterial=!0,n.materialsRaw=0,n.materialsFinished=0,n.hp=2e3,n.mass=180,n.geo=lt(Ze.body),n.geo.graphics.addChild(lt(Ze.flag).graphics),Object.assign(n,e),n.updateFlagColor(),n}return Ye(e,t),e.prototype.isOccupied=function(){return Boolean(this.pbase||this.plab||this.pcolony||this.pcomm)},e.prototype.updateFlagColor=function(){var t=this.geo.graphics.children[0];this.team===vt.NONE?t.visible=!1:(t.visible=!0,t.tint=_t[this.team])},e.DIST_SURFACE2=11025,e}(Ve),Je=(We=function(t,e){return(We=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}We(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Qe={type:it.Circle,radius:200,fill:{color:0,alpha:1},lineStyle:{width:1,color:16776960,alpha:1}},$e=function(t){function e(e){var n=t.call(this)||this;return n.geo=lt(Qe),n.type="Star",n.hp=1e4,n.mass=600,Object.assign(n,e),n}return Je(e,t),e.DIST_SURFACE2=4e4,e}(Ve),tn=[{name:"Serf",scoreNeeded:-1/0},{name:"Peasant",scoreNeeded:-50},{name:"Recruit",scoreNeeded:0},{name:"Cadet",scoreNeeded:200},{name:"Private",scoreNeeded:1e3},{name:"Corporal",scoreNeeded:2e3},{name:"Lieutenant",scoreNeeded:3200},{name:"Captain",scoreNeeded:4500},{name:"Major",scoreNeeded:6e3},{name:"Colonel",scoreNeeded:8e3},{name:"Rear Admiral",scoreNeeded:12e3},{name:"Vice Admiral",scoreNeeded:18e3},{name:"Fleet Admiral",scoreNeeded:24e3},{name:"Fleet Commander",scoreNeeded:5e4}],en=function(t){return tn[tn.findIndex(function(e){return t<e.scoreNeeded})-1]},nn=function(t){return tn[tn.findIndex(function(e){return t<e.scoreNeeded})]},an=0,on=en(0),rn=nn(0),ln=0,cn={add:function(t){on=en(an+=t),rn=nn(an)},addSectorResult:function(t){ln+=t},getIsGameOver:function(){return ln<-1},getScoreRank:function(){return{rank:on,score:an,nextRank:rn}}},sn=Math.pow(1e3,2),pn=Math.pow(800,2),un=Math.PI/4,hn=Math.pow(3.5,2),dn=2*Math.PI;function fn(t){t.explode(),sr.destroy(t),Tt(t.team)&&cn.add(-10)}var yn={componentFlag:"canGravitate",DEFAULTS:{},process:function(t){var e=t.isDockedPlanet,n=t.isDockedSpacePort,a=t.hp;!e&&!n&&0<a&&sr.getBodies().forEach(function(t){var e=t.type;"Star"===e?function(t){var e=bt(this,t);if(e<sn){var n=t.x-this.x,a=t.y-this.y,i=this.mass*t.mass/Math.pow(e,1.5);this.dx+=n*i,this.dy+=a*i,e<$e.DIST_SURFACE2&&fn(this)}}.call(this,t):"Planet"===e&&function(t){var e=bt(this,t);if(e<pn){var n=this.mass*t.mass/Math.pow(e,1.5),a=t.x-this.x,i=t.y-this.y;if(this.dx+=a*n,this.dy+=i*n,e<Ke.DIST_SURFACE2){var o=this.dx*this.dx+this.dy*this.dy,r=this.rotation,l=Ot(t,this),c=Math.abs(l-r);c>Math.PI&&(0<r?r-=dn:r+=dn,c=Math.abs(l-r)),c<un&&o<hn?this.dockPlanet(t):fn(this)}}}.call(this,t)}.bind(t))}},mn=1/hn,gn=new r.Graphics,vn=new r.Text("Landing Speed",{fontFamily:"arial",fontSize:12,fill:16777215});vn.x=-50,vn.y=27,gn.addChild(vn);var _n=!0;function Tn(){gn.x=innerWidth>>1,gn.y=innerHeight>>1}var En={init:function(){Tn(),yr.addChildToHUD(gn)},update:function(){if(_n){var t=Re.getControlledEntity();if(t){var e=t.dx,n=t.dy;if(!isNaN(e+n)){var a=65280,i=e*e+n*n,o=Math.min(i*mn,1),r=100*o;gn.beginFill(4473924,1),gn.drawRect(-50,41,100,14),gn.endFill(),.3<o&&(a=8978176),.5<o&&(a=16776960),.7<o&&(a=16746496),.9<o&&(a=16711680),gn.beginFill(a,1),gn.drawRect(-50,41,r,14),gn.endFill()}}}},setVisible:function(t){gn.visible=t,_n=t},onResize:Tn},Sn=Math.pow(300,2),Pn=new r.Graphics,xn=new r.Graphics;xn.beginFill(0,0),xn.lineStyle(2,16776960,1),xn.drawPolygon(rt(ft,-10,-10)),xn.endFill(),xn.visible=!1;var bn=new r.Graphics;bn.beginFill(0,0),bn.lineStyle(2,65280,1),bn.drawPolygon(rt(ft,-10,-10)),bn.endFill(),bn.visible=!1;var On=new r.Graphics;On.beginFill(0,0),On.lineStyle(1,16711680,1),On.drawPolygon(rt(yt,-10,-10)),On.endFill(),On.visible=!1;var An=new r.Graphics;An.beginFill(0,0),An.lineStyle(1.5,65535,1),An.drawPolygon(rt(mt,-10,-10)),An.endFill(),An.visible=!1,Pn.addChild(xn,bn,On,An);var Cn,wn,Fn,Mn=12,Rn=12,kn=0,In=0,Dn=0,Nn=0,Ln=1,Hn=0;function Bn(t,e){if(t)if(fr(t)){e.visible=!0;var n=t.x-Fn.x+At,a=t.y-Fn.y+At,i=n/a,o=Math.abs(i);Ln<o?(e.x=0<n?In:-In+Mn,e.y=1/i*e.x):i<Ln&&(e.y=0<a?Nn:-Nn+Rn,e.x=i*e.y)}else e.visible=!1}function Un(){kn=innerWidth,Dn=innerHeight,Ln=kn/Dn,In=kn/2,Nn=Dn/2,Pn.x=In,Pn.y=Nn}var jn={init:function(){Un(),yr.addChildToHUD(Pn)},update:function(){if(Fn){var t=Re.getControlledEntity();0===Hn?(Hn=20,Cn=sr.getAbsoluteNearestByBodyType(Fn,"Planet"),wn=sr.getAbsoluteNearestByBodyType(Fn,"Star"),function(t){if(Cn&&t&&"Fighter"===t.type){var e=t.isDockedPlanet,n=t.isDockedSpacePort,a=e||n,i=bt(t,Cn)<=Sn;En.setVisible(i&&!a)}else En.setVisible(!1)}(t)):Hn--,Hn%2&&(Bn(Cn,bn),Bn(wn,xn),Bn(xt.getNavPoint(),An),t&&t.attackTarget?Bn(t.attackTarget,On):On.visible=!1)}},setOrigin:function(t){var e=t.x,n=t.y;return Fn={x:e,y:n}},onResize:Un},Gn=0,zn=new r.Graphics;zn.x=12,zn.y=12,ue(zn,function(){Ce.setVisible(!0),kt("expand-detail")});var Wn,Xn,qn,Vn=100/st,Yn=function(t){var e,n,a=t.type,i=t.team;switch(a){case"Planet":n=Kn,e=4;break;case"Star":n=Zn,e=2;break;case"Fighter":n=t===Wn&&6<Gn?16777215:_t[i],e=2;break;case"Freighter":default:n=Jn,e=1}var o=t.x*Vn,r=t.y*Vn;zn.beginFill(0,0),zn.lineStyle(1,n,1),zn.drawRect(o-e/2,r-e/2,e,e),zn.endFill()},Zn=16776960,Kn=65280,Jn=11184810,Qn=function(){yr.addChildToHUD(zn)},$n=function(){0<Gn?Gn--:(Wn=Re.getControlledEntity(),Gn=12,zn.clear(),zn.beginFill(0,1),zn.lineStyle(1,16777215,.3),zn.drawRect(0,0,100,100),zn.endFill(),sr.getByType("Star").forEach(Yn),sr.getByType("Planet").forEach(Yn),sr.getByType("Freighter").forEach(Yn)),sr.getByType("Fighter").forEach(Yn),Wn&&(!Wn.type||Wn.hp<=0)&&(Wn=null)},ta=new r.Graphics;function ea(){ta.x=.5*(innerWidth-ta.width),ta.y=.5*(innerHeight-ta.height)+40}ta.lineStyle(1,16777215,1),Xn=14,qn=0,"game".split("").forEach(function(t){ta.drawPolygon(rt(dt[t],Xn,qn,.03125,.025)),Xn+=17}),Xn=0,qn=20,"paused".split("").forEach(function(t){ta.drawPolygon(rt(dt[t],Xn,qn,.03125,.025)),Xn+=16});var na={init:function(){ta.renderable=!1,yr.addChildToHUD(ta)},setVisible:function(t){(ta.renderable=t)&&ea()},onResize:ea},aa=new r.Container,ia=12;function oa(){aa.x=innerWidth-ia,aa.y=innerHeight-ia+4}var ra=[],la=400;function ca(){aa.children.forEach(function(t,e){t.text=ra[e],t.x=-t.width})}var sa={init:function(){for(var t;aa.children.length<8;){t=new r.Text("",{fontFamily:"arial",fontSize:12,fill:11184810}),aa.addChild(t),ra.push();var e=aa.children.length-1;aa.children[e].y=-20*(e+1)}ra=[],ca(),yr.addChildToHUD(aa),oa()},update:function(){0<la?la--:(la=400,ra.shift(),ca())},onResize:oa,displayText:function(t){void 0===t&&(t=""),ra.push(t),8<ra.length&&ra.shift(),ca()}},pa=function(){return(pa=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},ua=new r.Graphics;ua.x=12,ua.y=124;var ha=new r.Text("<rank>",pa({},{fontFamily:"arial",fontSize:12},{fill:16777215}));ua.addChild(ha);var da=0,fa=function(){yr.addChildToHUD(ua)},ya=function(){if(0<da)da--;else{var t=cn.getScoreRank(),e=t.rank,n=t.score,a=t.nextRank;ha.text=e.name,ua.beginFill(4473924,1),ua.drawRect(0,16,100,14),ua.endFill(),ua.beginFill(65535,1),ua.drawRect(0,16,(n-e.scoreNeeded)/a.scoreNeeded*100,14),ua.endFill(),da=20}},ma=new r.Graphics,ga=0,va=function(){yr.addChildToHUD(ma)},_a=function(){var t=Re.getControlledEntity();if(t&&t.attackTarget&&!fr(t.attackTarget)){ma.visible=!0;var e=t.attackTarget,n=e.reticleWidth2,a=e.reticleHeight2,i=e.x,o=e.y,r=e.reticleOffsetX,l=void 0===r?0:r,c=e.reticleOffsetY,s=void 0===c?0:c,p=yr.getSceneCoordFromStageCoord(i,o);if(!n||!a){var u=t.attackTarget.geo.graphics.getBounds();n=10+(u.width>>1),a=10+(u.height>>1)}ma.x=p.x+l,ma.y=p.y+s,ma.clear(),ma.beginFill(0,0),ma.lineStyle(1,ga%6?16711680:65535,1),ma.drawPolygon(rt(gt[0],-n,-a)),ma.drawPolygon(rt(gt[1],n,-a)),ma.drawPolygon(rt(gt[2],n,a)),ma.drawPolygon(rt(gt[3],-n,a)),ma.endFill(),ga++}else ma.visible=!1,ga=0},Ta=new r.Container,Ea=12;function Sa(){Ta.x=Ea,Ta.y=innerHeight-Ea+4}var Pa=" ".repeat(4).split("");function xa(t){void 0===t&&(t=Pa);for(var e=3;0<=e;e--)Ta.children[e].text=t[4-e-1]||""}var ba={init:function(){for(var t;Ta.children.length<4;){t=new r.Text("",{fontFamily:"arial",fontSize:12,fill:_t[vt.MAGENTA]}),Ta.addChild(t);var e=Ta.children.length-1;Ta.children[e].y=-20*(e+1)}yr.addChildToHUD(Ta),Sa()},clear:function(){return xa()},onResize:Sa,displayText:xa},Oa={init:function(t){jn.init(),Qn(),He(),Xe(),En.init(),fa(),sa.init(),Ce.init(t),ba.init(),na.init(),va()},update:function(){En.update(),sa.update(),$n(),jn.update(),Be(),qe(),ya(),Ce.update(),_a()},displayText:function(t,e){Tt(t)&&sa.displayText(e)},onResize:function(){jn.onResize(),Ce.onResize(),En.onResize(),sa.onResize(),ba.onResize(),na.onResize()},displayCommandText:ba.displayText,setFocus:jn.setOrigin,setPauseVisible:na.setVisible},Aa={Freighter:{cost:800,time:1500},Fighter:{cost:500,time:100}},Ca={componentFlag:"canManufacture",DEFAULTS:{orderManufacture:function(t){this.isManufacturing||(this.isManufacturing=!0,this.manufactureTime=Aa[t].time,this.manufactureType=t,Oa.displayText(this.team,"Manufacturing new "+t+"."))},isManufacturing:!1,manufactureTime:0,manufactureType:void 0},process:function(t){if(t.isManufacturing){var e=t.planet,n=t.team;if(t.planet.pbase&&t.planet.pbase.materialsFinished>=t.PRODUCT[t.manufactureType].cost)if(0<t.manufactureTime)t.manufactureTime--;else{var a=t.x+v.int(-20,20),i=t.y+v.int(-20,20),o=sr.create(t.manufactureType,{x:a,y:i,team:n});"Fighter"===t.manufactureType?e.spaceport&&!e.spaceport.isCarryingFighter?o.dockSpacePort(e.spaceport):o.dockPlanet(e):"Freighter"===t.manufactureType&&o.enterPlanetOrbit(e),Oa.displayText(n,"New "+o.type+" manufactured."),t.isManufacturing=!1,t.manufactureType=void 0}}}},wa={componentFlag:"canMoveLinearly",DEFAULTS:{dx:0,dy:0},process:function(t){t.isDockedPlanet||(t.x+=t.dx,t.y+=t.dy,0!==t.x&&t.x!==st||(t.dx=0),0!==t.y&&t.y!==st||(t.dy=0))}},Fa={TURN_RATE:.07,SPEED:2.5,DIST_HALT2:Math.pow(80,2)},Ma=Math.pow(200,2),Ra={componentFlag:"canMoveToColonizationTarget",DEFAULTS:Fa,process:function(t){var e,n,a,i,o=t.isOrbitingPlanet,r=t.colonizationTarget,l=t.DIST_HALT2;if(!o&&r){var c=bt(t,r);if("Planet"===r.type&&(l=Ma),l<c){var s=(n=(e=t).rotation,a=Ot(e,e.colonizationTarget),(i=Math.abs(a-n))>Math.PI?0<n?e.rotation+=e.TURN_RATE:e.rotation-=e.TURN_RATE:i>e.TURN_RATE?a<n?e.rotation-=e.TURN_RATE:e.rotation+=e.TURN_RATE:e.rotation=a,n=e.rotation);t.x+=Math.cos(s)*t.SPEED,t.y+=Math.sin(s)*t.SPEED,t.flameOn&&t.flameOn()}else"Planet"===r.type&&t.canOrbitPlanet&&t.enterPlanetOrbit(r),t.flameOff&&t.flameOff()}}},ka={DEFAULTS:{anchorOffsetX:0,anchorOffsetY:0},componentFlag:"canAnchor",process:function(t){0<t.anchor.hp?(t.x=t.anchor.x+t.anchorOffsetX,t.y=t.anchor.y+t.anchorOffsetY):sr.destroy(t)}},Ia=[{type:"PLab",cost:200},{type:"PComm",cost:300},{type:"SpacePort",cost:1e3,prerequisite:"PColony"},{type:"SpaceDock",cost:500,prerequisite:"SpacePort",occupation:"SpacePort"},{type:"SensorArray",cost:500,prerequisite:"SpacePort",occupation:"SpacePort"}],Da={componentFlag:"canConstruct",DEFAULTS:{constructionTime:8e3},process:function(t){0<t.materialsFinished&&(0<t.constructionTime?t.constructionTime--:(Ia.some(function(t){var e=this.team,n=this.planet,a=t.type.toLowerCase(),i=!0;return t.prerequisite&&(i=Boolean(this.planet[t.prerequisite.toLowerCase()])),!!(!this.planet[a]&&this.materialsFinished>=t.cost&&i)&&("SpacePort"===t.occupation?this.planet[a]=sr.create(t.type,{spaceport:this.planet.spaceport,planet:n,team:e}):this.planet[a]=sr.create(t.type,{planet:n,team:e}),this.materialsFinished-=t.cost,!0)}.bind(t)),t.constructionTime=8e3))}};function Na(){var t=this,e=t.EXPLOSION_SOUND,n=t.EXPLOSION_FRAGMENTS,a=t.x,i=t.y,o=t.dx,r=t.dy,l=t.explosionOriginDx,c=t.explosionOriginDy;Lt(e,this);for(var s=n;0<s;s--)sr.create("CannonShot",{x:l+a+v.float(-10,10),y:c+i+v.float(-10,10),team:vt.NONE,dx:v.float(-2,2)+(o||0),dy:v.float(-2,2)+(r||0)});this.hasExploded=!0}var La={componentFlag:"canExplode",DEFAULTS:{explosionOriginDx:0,explosionOriginDy:0,EXPLOSION_SOUND:"collide",EXPLOSION_FRAGMENTS:6,hasExploded:!1,explode:Na},process:function(t){var e=t.hasExploded,n=t.canExplode;t.hp<=0&&!e&&n&&Na.call(t)}},Ha={componentFlag:"canOccupySpacePort",process:function(t){var e=t.spaceport,n=e.x,a=e.y,i=e.rotation;0<e.hp?(t.x=n,t.y=a,t.rotation=i):(t.explode&&t.explode(),sr.destroy(t))}},Ba={componentFlag:"canOrbitStar",DEFAULTS:{D_ROTATION:1e-4,orbitDistance:1800,orbitRotation:0},process:function(t){t.orbitRotation+=t.D_ROTATION,t.x=Math.cos(t.orbitRotation)*t.orbitDistance+t.star.x,t.y=Math.sin(t.orbitRotation)*t.orbitDistance+t.star.y}},Ua={enterPlanetOrbit:function(t){this.isOrbitingPlanet=!0,this.dx=0,this.dy=0,this.orbitRotation=Ot(t,this),this.rotation=this.orbitRotation+ja,this.planet=t,this.flameOff&&this.flameOff()},exitPlanetOrbit:function(){this.isOrbitingPlanet=!1,this.planet=void 0,this.flameOn&&this.flameOn()},isOrbitingPlanet:!0,D_ROTATION:1e-4,orbitDistance:105,orbitRotation:0},ja=.5*Math.PI,Ga={componentFlag:"canOrbitPlanet",DEFAULTS:Ua,process:function(t){t.isOrbitingPlanet&&t.planet&&("SpacePort"===t.type?t.rotation=Ot(t.planet,t):"Freighter"===t.type&&(t.rotation+=t.D_ROTATION),t.orbitRotation+=t.D_ROTATION,t.x=Math.cos(t.orbitRotation)*t.orbitDistance+t.planet.x,t.y=Math.sin(t.orbitRotation)*t.orbitDistance+t.planet.y)}},za={componentFlag:"canDamage",DEFAULTS:{damageHp:1},process:function(t){sr.getNearestUnits(t).some(function(t){var e=this.team,n=this.damageHp;return!(t.team===e||!at(this,t)||(Lt(t.AUDIO_HIT||"hit",this),t.hp-=n,t.lastDamagedByTeam=e,t.hitTime=10,sr.destroy(this),0))}.bind(t))}},Wa={componentFlag:"canShootCannon",DEFAULTS:{lastShotTime_Cannon:0,reloadTime_Cannon:100},process:function(t){var e=t.isAttacking,n=t.attackWeapon;if(e&&"Cannon"===n){var a=Date.now();a-t.lastShotTime_Cannon>=t.reloadTime_Cannon&&(t.attackTurretPositions.forEach(function(t){var e=this.team,n=t(this),a=n.rotation,i=n.x,o=n.y,r=5*Math.cos(a),l=5*Math.sin(a),c=this.dx||0,s=this.dy||0;sr.create("CannonShot",{team:e,x:i+this.x-c,y:o+this.y-s,dx:r+c,dy:l+s})}.bind(t)),Lt("fire",t),t.lastShotTime_Cannon=a)}}},Xa={componentFlag:"canShootHeavyCannon",DEFAULTS:{lastShotTime_HeavyCannon:0,reloadTime_HeavyCannon:120},process:function(t){var e=t.isAttacking,n=t.attackWeapon;if(e&&"HeavyCannon"===n){var a=Date.now();a-t.lastShotTime_HeavyCannon>=t.reloadTime_HeavyCannon&&(t.attackTurretPositions.forEach(function(t){var e=this.team,n=t(this),a=n.rotation,i=n.x,o=n.y,r=6*Math.cos(a),l=6*Math.sin(a),c=this.dx||0,s=this.dy||0;sr.create("HeavyCannonShot",{team:e,x:i+this.x-c,y:o+this.y-s,dx:r+c,dy:l+s})}.bind(t)),Lt("fire",t),t.lastShotTime_HeavyCannon=a)}}},qa={componentFlag:"canShootLaserBolt",DEFAULTS:{reload_LaserBolt:function(t){void 0===t&&(t=!0),this.ammo_LaserBolt<this.ammoMax_LaserBolt&&(kt("empty"),t?this.ammo_LaserBolt++:this.ammo_LaserBolt=this.ammoMax_LaserBolt)},range_LaserBolt:20,ammo_LaserBolt:4,ammoMax_LaserBolt:4,lastShotTime_LaserBolt:0,reloadTime_LaserBolt:1e3},process:function(t){var e=t.isAttacking,n=t.attackWeapon,a=t.ammo_LaserBolt;if(e&&"LaserBolt"===n){var i=Date.now();i-t.lastShotTime_LaserBolt>=t.reloadTime_LaserBolt&&0<a&&(t.attackTurretPositions.forEach(function(t){for(var e=this.team,n=this.range_LaserBolt,a=t(this),i=a.rotation,o=a.x,r=a.y,l=10*Math.cos(i),c=10*Math.sin(i),s=this.dx||0,p=this.dy||0,u=n;0<u;u--)sr.create("LaserBolt",{team:e,rotation:i,x:o+this.x-s+l*u,y:r+this.y-p+c*u})}.bind(t)),Lt("laser",t),t.ammo_LaserBolt--,t.lastShotTime_LaserBolt=i)}}},Va={componentFlag:"canShootHomingMissile",DEFAULTS:{reload_HomingMissile:function(t){void 0===t&&(t=!0),this.ammo_HomingMissile<this.ammoMax_HomingMissile&&(kt("empty"),t?this.ammo_HomingMissile++:this.ammo_HomingMissile=this.ammoMax_HomingMissile)},lastShotTime_HomingMissile:0,ammo_HomingMissile:40,ammoMax_HomingMissile:40},process:function(t){var e=t.isAttacking,n=t.ammo_HomingMissile,a=t.attackWeapon;if(e&&"HomingMissile"===a){var i=Date.now();300<=i-t.lastShotTime_HomingMissile&&0<n&&(t.attackTurretPositions.forEach(function(t){var e=this.attackTarget,n=this.team,a=t(this),i=a.rotation,o=a.x,r=a.y,l=4*Math.cos(i),c=4*Math.sin(i),s=this.dx||0,p=this.dy||0;sr.create("HomingMissile",{team:n,attackTarget:e,rotation:i,x:o+this.x-s,y:r+this.y-p,dx:l+s,dy:c+p})}.bind(t)),t.lastShotTime_HomingMissile=i,t.ammo_HomingMissile--,Lt("missile",t))}}},Ya={componentFlag:"canShootClusterRocket",DEFAULTS:{reload_ClusterRocket:function(t){void 0===t&&(t=!0),this.ammo_ClusterRocket<this.ammoMax_ClusterRocket&&(kt("empty"),t?this.ammo_ClusterRocket++:this.ammo_ClusterRocket=this.ammoMax_ClusterRocket)},lastShotTime_ClusterRocket:0,reloadTime_ClusterRocket:600,ammo_ClusterRocket:8,ammoMax_ClusterRocket:8},process:function(t){var e=t.isAttacking,n=t.attackWeapon,a=t.ammo_ClusterRocket;if(e&&"ClusterRocket"===n){var i=Date.now();i-t.lastShotTime_ClusterRocket>=t.reloadTime_ClusterRocket&&0<a&&(t.attackTurretPositions.forEach(function(t){var e=this.team,n=t(this),a=n.rotation,i=n.x,o=n.y,r=2.5*Math.cos(a),l=2.5*Math.sin(a),c=this.dx||0,s=this.dy||0;sr.create("ClusterRocket",{rotation:a,team:e,x:i+this.x-c,y:o+this.y-s,dx:r+c,dy:l+s})}.bind(t)),t.lastShotTime_ClusterRocket=i,t.ammo_ClusterRocket--,Lt("bomb-release",t))}}},Za={componentFlag:"canLimitSpeed",DEFAULTS:{MAX_SPEED:40,MAX_SPEED2:Math.pow(40,2)},process:function(t){var e=Math.pow(t.dx,2)+Math.pow(t.dy,2);if(e>t.MAX_SPEED2){var n=t.MAX_SPEED*Math.pow(e,-.5);t.dx*=n,t.dy*=n}}},Ka={componentFlag:"canAccelerate",DEFAULTS:{accelerate:function(t){this.dx+=Math.cos(this.rotation)*t,this.dy+=Math.sin(this.rotation)*t}}},Ja={componentFlag:"canAccelerateToAttackTarget",DEFAULTS:{delayBeforeTracking:5},process:function(t){if(0<t.delayBeforeTracking)t.delayBeforeTracking--;else{var e=t.attackTarget;if(e){var n=e.x,a=e.y;t.x>n?t.dx-=.26:t.x<n&&(t.dx+=.26),t.y>a?t.dy-=.26:t.y<a&&(t.dy+=.26),t.rotation=Math.atan2(t.dy,t.dx)}}}},Qa=2*pt,$a=Math.PI/pt,ti=Math.pow(500,2),ei=Math.pow(400,2),ni=Math.pow(200,2)/1.4;function ai(t,e){void 0===e&&(e=ut),t.accelerate(e),t.flameOn()}var ii=[function(t){var e=t.isDockedPlanet,n=t.isDockedSpacePort,a=t.isFighterPreviouslyDocked;if(e)return t.isFighterPreviouslyDocked=!0,t.undockPlanet(),ai(t,2*ht+ut),!0;if(n)return t.isFighterPreviouslyDocked=!0,t.undockSpacePort(),ai(t,ht+ut),!0;var i=t.dx,o=t.dy,r=Math.pow(i,2)+Math.pow(o,2);return!!(a&&r<9)&&(ai(t),!0)},function(t){var e,n,a=t.attackTarget,i=t.dx,o=t.dy,r=bt(t,a),l=Math.pow(i,2)+Math.pow(o,2);n="PBase"===a.type?ei:ti;var c,s,p,u=Ot(t,a),h=Math.atan2(o,i);if(t.isFighterPreviouslyDocked=!1,t.isAttacking=!1,r<ni/l)e=u-Math.PI;else if(r<n){var d=5*Math.cos(u),f=5*Math.sin(u);e=Math.atan2(f-o,d-i),t.isAttacking=Math.abs(e-t.rotation)<.1}else{var y=Math.sqrt(Math.sqrt(r)/ut)+$a+5;e=Math.sqrt(r/l)<y?h+Math.PI:u}p=(s=e)-(c=t).rotation,Math.abs(p)>Math.PI&&(s>Math.PI?s-=2*Math.PI:s<-Math.PI&&(s+=2*Math.PI),p=s-c.rotation),Math.abs(p)>=.01&&(0<p?c.rotation+=Qa:c.rotation-=Qa),!t.isAttacking&&Math.abs(Math.cos(e)-Math.cos(t.rotation))<.1&&ai(t)}],oi={componentFlag:"canAccelerateFighterToAttackTarget",DEFAULTS:{isFighterPreviouslyDocked:!1,isFighterAutoAccelerated:!0},process:function(t){var e,n;t.isFighterAutoAccelerated&&(n=(e=t).attackTarget,e.flameOff(),n&&(0<n.hp?function(t,e){for(var n=0;n<t.length;n++)if(t[n](e))return}(ii,e):(e.attackTarget=null,e.isAttacking=!1)))}},ri={componentFlag:"canDockPlanet",DEFAULTS:{isDockedPlanet:!1,dockPlanet:function(t){this.isDockedPlanet=!0,this.dx=0,this.dy=0,this.rotation=Ot(t,this),(this.planet=t).isOccupied()||t.team==this.team||(Tt(this.team)&&cn.add(20),t.team=this.team,t.updateFlagColor())},undockPlanet:function(){this.isDockedPlanet=!1,this.planet=void 0}},process:function(t){t.isDockedPlanet&&(t.x=105*Math.cos(t.rotation)+t.planet.x,t.y=105*Math.sin(t.rotation)+t.planet.y)}},li={componentFlag:"canDockSpacePort",DEFAULTS:{spaceport:null,isDockedSpacePort:!1,dockSpacePort:function(t){this.isDockedSpacePort=!0,this.dx=0,this.dy=0,this.rotation=t.rotation,this.spaceport=t,(this.spaceport.fighter=this).spaceport.isCarryingFighter=!0},undockSpacePort:function(){this.isDockedSpacePort=!1,this.spaceport.fighter=null,this.spaceport.isCarryingFighter=!1,this.spaceport=null,this.x+=Math.cos(this.rotation),this.y+=Math.cos(this.rotation)}},process:function(t){var e=t.isDockedSpacePort,n=t.spaceport;e&&(t.rotation=n.rotation,t.x=211*Math.cos(t.rotation)+n.planet.x,t.y=211*Math.sin(t.rotation)+n.planet.y)}},ci=Math.pow(8,2),si={componentFlag:"canCarryFighter",DEFAULTS:{fighter:null,isCarryingFighter:!1},process:function(t){t.isCarryingFighter||sr.getNearestUnits(t).some(function(t){var e=t.dx,n=t.dy,a=t.type,i=t.team,o=t.canDockSpacePort,r=t.rotation,l=t.isDockedSpacePort;return!!("Fighter"===a&&i===this.team&&o&&!l&&at(t,this)&&Math.abs(Math.cos(r)-Math.cos(this.rotation))<.1&&Math.pow(e,2)+Math.pow(n,2)<=ci)&&(Tt(i)&&kt("repaired"),t.dockSpacePort(this),!0)}.bind(t))}},pi={componentFlag:"canColonizePlanet",DEFAULTS:{MAX_MATERIALS_FINISHED:500,colonizationTarget:null},process:function(t){var e,n,a,i,o,r,l,c,s,p,u=t.colonizationTarget,h=t.isOrbitingPlanet,d=t.planet,f=t.team;u&&h&&d&&(d.team===f?0<t.materialsFinished&&(void 0===t.supplyTime?t.supplyTime=600:0<t.supplyTime?t.supplyTime--:0===t.supplyTime&&(d.pbase?d.pcolony?d.spaceport?(function(t){var e=t.planet.pbase;if(0===e.materialsFinished){e.materialsFinished+=t.materialsFinished;var n=t.materialsFinished=0;e.materialsFinished>e.MAX_FINISHED_MATERIALS?(n=e.materialsFinished-e.MAX_FINISHED_MATERIALS,e.materialsFinished=e.MAX_MATERIALS_FINISHED,t.materialsFinished=n,t.unloadSupply()):(t.canExplode=!1,sr.destroy(t))}else if(0<t.planet.materialsFinished&&t.materialsFinished<t.MAX_MATERIALS_FINISHED){var a=t.MAX_MATERIALS_FINISHED-t.materialsFinished;a>=t.planet.materialsFinished?(t.materialsFinished+=t.planet.materialsFinished,t.planet.materialsFinished=0):(t.materialsFinished+=a,t.planet.materialsFinished-=a),t.loadSupply()}}(t),t.colonizationTarget=null):(n=(e=t).planet,a=e.team,i=e.orbitRotation,Tt(a)&&(kt("nav"),cn.add(50)),n.spaceport=sr.create("SpacePort",{x:n.x,y:n.y,planet:n,team:a}),n.spaceport.enterPlanetOrbit(n),n.spaceport.orbitRotation=i,e.canExplode=!1,sr.destroy(e),Oa.displayText(f,"Colonization successful: SpacePort secured.")):(r=(o=t).planet,l=o.team,Tt(l)&&(kt("nav"),cn.add(20)),r.pcolony=sr.create("PColony",{x:r.x,y:r.y,planet:r,team:l}),o.canExplode=!1,sr.destroy(o),Oa.displayText(f,"Colonization successful: Colony secured.")):(s=(c=t).planet,p=c.team,Tt(p)&&(kt("nav"),cn.add(200)),s.pbase=sr.create("PBase",{x:s.x,y:s.y,planet:s,team:p}),c.canExplode=!1,sr.destroy(c),Oa.displayText(f,"Colonization successful: PBase secured.")))):u.isOccupied()||(u.team=f,u.updateFlagColor()))}},ui={HeavyCannon:.6,ClusterRocket:.3,HomingMissile:.4,LaserBolt:.2,Shield:.7},hi={componentFlag:"canDevelopEquipment",DEFAULTS:{developEquipment_installTimeMax:150,developEquipment_installTime:150,developEquipment_timeMax:2e3,developEquipment_time:2e3,developEquipment_equipmentReady:""},process:function(t){var e=t.developEquipment_time,n=t.developEquipment_installTime,a=t.developEquipment_installTimeMax,i=t.developEquipment_timeMax,o=t.developEquipment_equipmentReady,r=t.team;if(Boolean(o))if(t.isShimmering=!0,0<n)t.developEquipment_installTime--;else{var l=sr.getNearestUnits(t).find(function(e){return e.team===r&&(e.isDockedPlanet&&e.planet===t.planet||e.isDockedSpacePort&&e.spaceport===t.planet.spaceport)});l&&("Shield"!==o||l.shield?"Cannon"===l.attackWeapon&&(l.attackWeapon=o,t.developEquipment_equipmentReady="",Tt(r)&&(kt("install"),l.isFighterAutoAccelerated||Oa.displayText(r,o+" installed."))):(l.shield=sr.create("Shield",{team:r,anchor:l}),t.developEquipment_equipmentReady="",Tt(r)&&(kt("install"),l.isFighterAutoAccelerated||Oa.displayText(r,o+" installed.")))),t.developEquipment_installTime=a}else if(t.isShimmering=!1,0<e)t.developEquipment_time--;else{t.developEquipment_time=i;var c=v.arrayElement(Object.keys(ui));Math.random()<ui[c]&&(t.developEquipment_equipmentReady=c,Tt(r)&&(kt("develop"),Oa.displayText(r,"New equipment: "+c+" available.")))}}},di=Math.pow(20,2),fi=[{componentFlag:"canFlock",DEFAULTS:{flockPoint:null},process:function(t){var e,n,a,i,o;t.canMoveLinearly&&(o=t,sr.getNearestUnits(o).filter(function(t){return t.canFlock&&t!==o}).forEach(function(t){var e=bt(o,t);if(e<di){var n=-5;e<6&&(n*=4),o.dx+=(t.x-o.x)*n,o.dy+=(t.y-o.y)*n}}),function(t){var e=t.flockPoint;if(e){var n=Ot(t,e);t.dx+=5*Math.cos(n),t.dy+=5*Math.sin(n)}}(t),n=(e=t).dx,a=e.dy,i=Math.atan2(a,n),e.rotation=i,e.dx=2.5*Math.cos(i),e.dy=2.5*Math.sin(i))}},ri,li,ka,{componentFlag:"canOccupyPlanet",process:function(t){t.x=t.planet.x,t.y=t.planet.y}},Ha,Ka,Ja,oi,wa,Ra,Ba,Ga,Za,C,za,{componentFlag:"canStoreMaterial",DEFAULTS:{MAX_RAW_MATERIALS:3e3,MAX_FINISHED_MATERIALS:2e3,materialsRaw:0,materialsFinished:0},process:function(){}},{componentFlag:"canHarvest",DEFAULTS:{HARVEST_RATE_RAW:35,HARVEST_RATE_FINISHED:25,HARVEST_TIME:10,harvestTime:0},process:function(t){0<t.harvestTime?t.harvestTime--:(t.harvestTime=t.HARVEST_TIME,0<t.planet.materialsRaw&&t.materialsRaw<t.MAX_RAW_MATERIALS&&(t.MAX_RAW_MATERIALS-t.materialsRaw<t.HARVEST_RATE_RAW?(t.planet.materialsRaw=0,t.materialsRaw+=t.MAX_RAW_MATERIALS-t.materialsRaw):(t.planet.materialsRaw-=t.HARVEST_RATE_RAW,t.materialsRaw+=t.HARVEST_RATE_RAW)),0<t.planet.materialsFinished&&t.materialsFinished<t.MAX_FINISHED_MATERIALS&&(t.MAX_FINISHED_MATERIALS-t.materialsFinished<t.HARVEST_RATE_FINISHED?(t.planet.materialsFinished=0,t.materialsFinished+=t.MAX_FINISHED_MATERIALS-t.materialsFinished):(t.planet.materialsFinished-=t.HARVEST_RATE_FINISHED,t.materialsFinished+=t.HARVEST_RATE_FINISHED)))}},{componentFlag:"canMine",DEFAULTS:{MINE_RATE:25,MINE_TIME:20,mineTime:20},process:function(t){0<t.mineTime?t.mineTime--:(t.mineTime=t.MINE_TIME,t.planet.materialsRaw+=t.MINE_RATE)}},hi,{componentFlag:"canRepair",DEFAULTS:{REPAIR_COST_FINISHED:25,REPAIR_TIME:30,repairTime:0},process:function(t){t.hp<t.maxHp&&t.materialsFinished>t.REPAIR_COST_FINISHED&&0<t.materialsFinished&&(0<t.repairTime?t.repairTime--:(t.hp++,t.materialsFinished-=t.REPAIR_COST_FINISHED,t.repairTime=t.REPAIR_TIME))}},{componentFlag:"canRefine",DEFAULTS:{REFINE_RATE_RAW_TO_FINISHED:.5},process:function(t){t.materialsFinished<t.MAX_FINISHED_MATERIALS?0<t.materialsRaw&&(t.materialsFinished+=t.REFINE_RATE_RAW_TO_FINISHED,t.materialsFinished>t.MAX_FINISHED_MATERIALS&&(t.planet.materialsFinished+=t.materialsFinished-t.MAX_FINISHED_MATERIALS,t.materialsFinished=t.MAX_FINISHED_MATERIALS),t.materialsRaw--):0<t.materialsRaw&&(t.planet.materialsFinished+=t.REFINE_RATE_RAW_TO_FINISHED,t.materialsRaw--)}},Da,Ca,{componentFlag:"canAttack",DEFAULTS:{attackTurretPositions:[],attackTarget:null,attackWeapon:"Cannon",isAttacking:!1}},Wa,Xa,qa,Va,Ya,pi,si,{componentFlag:"canMetabolize",process:function(t){t.hp--}},{componentFlag:"canDisplayHit",DEFAULTS:{hitTime:-1},process:function(t){t.renderHit&&t.renderHit()}},{componentFlag:"canShimmer",DEFAULTS:{isShimmering:!0,isShimmerBlink:!1,shimmerTime:3,shimmerTimeMax:3,shimmerBlinkColor:16777215,shimmerNormalColor:16711935},process:function(t){if(t.isShimmering){var e=t.shimmerBlinkColor,n=t.shimmerNormalColor,a=t.shimmerTime,i=t.shimmerTimeMax,o=t.isShimmerBlink;0<a?t.shimmerTime--:(t.shimmerTime=i,t.isShimmerBlink=!o),t.geo.graphics.tint=o?e:n}else t.geo.graphics.tint=t.shimmerNormalColor}},La,yn,{DEFAULTS:{shield:null},componentFlag:"canBeShielded"}],yi={init:function(t){fi.forEach(function(e){e.DEFAULTS&&t[e.componentFlag]&&Object.keys(e.DEFAULTS).forEach(function(n){void 0===t[n]&&(t[n]=e.DEFAULTS[n])})})},update:function(t){0<t.hp?fi.forEach(function(e){t[e.componentFlag]&&e.process&&e.process(t)}):t[La.componentFlag]&&La.process(t),0<t.hp?sr.commit(t):(sr.destroy(t),Tt(t.team)?isNaN(t.lastDamagedByTeam)||Tt(t.lastDamagedByTeam)||cn.add(-2*t.maxHp):Tt(t.lastDamagedByTeam)&&cn.add(t.maxHp))}},mi={},gi=function(t){return mi[t]||[]};function vi(t){t.hp=0;var e=t.type.toLowerCase();t.planet&&delete t.planet[e],t.spaceport&&delete t.spaceport[e],t.fighter&&(t.fighter.hp=0,t.fighter.undockSpacePort(),delete t.fighter),t.anchor&&(t.anchor.shield=null,delete t.anchor),delete t.shield,delete t.attackTarget,delete t.colonizationTarget;var n=gi(t.type),a=n.indexOf(t);-1!==a&&n.splice(a,1),yr.removeChild(t.geo.graphics)}var _i={add:function(t){var e=t.type;mi[e]?mi[e].push(t):mi[e]=[t],yr.addChild(t.geo.graphics)},remove:vi,getAll:function(){var t=[];return Object.keys(mi).forEach(function(e){return Array.prototype.push.apply(t,mi[e])}),t},clearAll:function(){Object.keys(mi).forEach(function(t){mi[t].forEach(vi),delete mi[t]})},getByType:gi},Ti=st>>8;function Ei(t,e,n){var a=t.x>>8,i=t.y>>8;return(a+=e||0)+(i+=n||0)*Ti}var Si,Pi,xi,bi,Oi,Ai,Ci,wi,Fi,Mi,Ri,ki,Ii,Di,Ni,Li,Hi,Bi=function(){function t(){this.grid=[],this.nextGrid=[]}return t.prototype.prepareNext=function(){return this.grid=this.nextGrid,this.nextGrid=[],this},t.prototype.commit=function(t){var e=this.nextGrid;if(0<t.hp){var n=Ei(t,0,0);e[n]instanceof Array?e[n].push(t):e[n]=[t]}return this},t.prototype.get1CellRadiusAroundEntity=function(t){for(var e=this.grid,n=[],a=[e[Ei(t,-1,-1)],e[Ei(t,0,-1)],e[Ei(t,1,-1)],e[Ei(t,-1,0)],e[Ei(t,0,0)],e[Ei(t,1,0)],e[Ei(t,0,1)],e[Ei(t,-1,1)],e[Ei(t,1,1)]],i=a.length-1;0<=i;i--)a[i]&&0<a[i].length&&Array.prototype.push.apply(n,a[i]);return n},t.prototype.getNearestEnemy=function(t,e){void 0===e&&(e=1/0);var n,a=this.get1CellRadiusAroundEntity(t).filter(function(e){return e.team!==t.team}),i=1/0;return a&&a.forEach(function(a){var o=bt(t,a);o<=e&&o<i&&(i=o,n=a)}),n},t}(),Ui=(Si=function(t,e){return(Si=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Si(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),ji={body:{type:it.Polygon,lineStyle:{width:1,color:255,alpha:1},path:[-2,2,-4,0,-2,-2,-4,-4,-4,-6,2,-4,0,-2,8,0,0,2,2,4,-4,6,-4,4,-2,2],collisionPath:[-4,-6,8,0,-4,6]},flame1:{type:it.Polygon,lineStyle:{width:1,color:65535,alpha:1},path:[-4,-4,-8,-5,-4,-6]},flame2:{type:it.Polygon,lineStyle:{width:1,color:65535,alpha:1},path:[-4,4,-8,5,-4,6]}},Gi=[function(t){var e=t.geo.collider.calcPoints[1];return{x:e.x,y:e.y,rotation:t.rotation}}],zi=function(t){function e(e){var n=t.call(this)||this;return n.type="Fighter",n.geo=lt(ji.body),n.mass=10,n.hp=4,n.maxHp=4,n.rotation=0,n.canGravitate=!0,n.canExplode=!0,n.canAttack=!0,n.attackWeapon="Cannon",n.attackTurretPositions=Gi,n.canBeShielded=!0,n.canShootLaserBolt=!0,n.canShootCannon=!0,n.canShootHeavyCannon=!0,n.canShootClusterRocket=!0,n.canShootHomingMissile=!0,n.canLimitSpeed=!0,n.canMoveLinearly=!0,n.canAccelerate=!0,n.canDockPlanet=!0,n.canDockSpacePort=!0,n.canAccelerateFighterToAttackTarget=!0,n.flameOn=function(){n.setChildVisible(0,!0),n.setChildVisible(1,!0)},n.flameOff=function(){n.setChildVisible(0,!1),n.setChildVisible(1,!1)},Object.assign(n,e),n.assignTeamColor(),n.geo.graphics.addChild(lt(ji.flame1).graphics,lt(ji.flame2).graphics),n.flameOff(),n}return Ui(e,t),e}(Ve),Wi=(Pi=function(t,e){return(Pi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Pi(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Xi={body:{type:it.Polygon,lineStyle:{width:1,color:15658734,alpha:1},collisionPath:[-44,-4,-38,-8,26,-10,44,0,26,10,-38,8,-44,4],path:[-26,-2,-26,-8,-38,-8,-38,2,-44,4,-44,-4,-38,-2,-38,8,-26,8,-26,-2,24,-2,26,-10,44,0,26,10,24,2,-26,2]},cargopodL:{type:it.Polygon,lineStyle:{width:1,color:15658734,alpha:1},path:[-24,-2,-24,-12,22,-12,22,-2]},cargopodR:{type:it.Polygon,lineStyle:{width:1,color:15658734,alpha:1},path:[-24,2,-24,12,22,12,22,2]},flag:{type:it.Polygon,lineStyle:{width:2,color:255,alpha:1},path:[34,0,42,0]},turret1:{type:it.Polygon,lineStyle:{width:1,color:65535,alpha:.5},path:[-34,0,-30,-3,-30,3,-34,0]},turret2:{type:it.Polygon,lineStyle:{width:1,color:65535,alpha:.5},path:[28,-3,32,0,28,3,28,-2]},flame:{type:it.Polygon,lineStyle:{width:1,color:65535,alpha:1},path:[-44,-2,-50,0,-44,2]}},qi=function(t,e,n){var a=t.attackTarget,i=(a=a||{}).dx||0,o=a.dy||0,r={x:a.x+24*i,y:a.y+24*o};return Ot({x:e+t.x,y:n+t.y},r)+v.float(-.2,.2)},Vi=[function(t){var e=-34*Math.cos(t.rotation),n=-34*Math.sin(t.rotation);return{x:e,y:n,rotation:qi(t,e,n)}},function(t){var e=32*Math.cos(t.rotation),n=32*Math.sin(t.rotation);return{x:e,y:n,rotation:qi(t,e,n)}}],Yi=function(t){function e(e){var n=t.call(this)||this;return n.type="Freighter",n.geo=lt(Xi.body),n.hp=10,n.maxHp=10,n.canDisplayHit=!0,n.canOrbitPlanet=!0,n.isOrbitingPlanet=!1,n.orbitDistance=205,n.canExplode=!0,n.canColonizePlanet=!0,n.canMoveToColonizationTarget=!0,n.canStoreMaterial=!0,n.materialsRaw=0,n.materialsFinished=500,n.canAutoTargetEnemy=!0,n.autoTargetSearchDist2=16e4,n.canAttack=!0,n.attackTurretPositions=Vi,n.canShootHomingMissile=!0,n.canShootLaserBolt=!0,n.canShootCannon=!0,n.reloadTime_Cannon=400,n.loadSupply=function(){n.setChildVisible(2,!0),n.setChildVisible(3,!0)},n.unloadSupply=function(){n.setChildVisible(2,!1),n.setChildVisible(3,!1)},n.flameOn=function(){return n.setChildVisible(0,!0)},n.flameOff=function(){return n.setChildVisible(0,!1)},Object.assign(n,e),n.geo.graphics.addChild(lt(Xi.flame).graphics,lt(Xi.flag).graphics,lt(Xi.cargopodL).graphics,lt(Xi.cargopodR).graphics,lt(Xi.turret1).graphics,lt(Xi.turret2).graphics),n.assignTeamColor(),n.flameOff(),n}return Wi(e,t),e.prototype.assignTeamColor=function(){this.getChildAt(1).currentPath.lineColor=_t[this.team]},e}(Ve),Zi=(xi=function(t,e){return(xi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}xi(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Ki={_name:"Planetary Base",body:{type:it.Polygon,lineStyle:{width:1,color:255,alpha:1},path:[-20,20,-20,-20,20,-20,20,20,-20,20]},turret1:{type:it.Polygon,lineStyle:{width:1,color:65280,alpha:.5},path:[65,-60,65,-65,60,-65,65,-60]},turret2:{type:it.Polygon,lineStyle:{width:1,color:65280,alpha:.5},path:[-65,-60,-65,-65,-60,-65,-65,-60]},turret3:{type:it.Polygon,lineStyle:{width:1,color:65280,alpha:.5},path:[65,60,65,65,60,65,65,60]},turret4:{type:it.Polygon,lineStyle:{width:1,color:65280,alpha:.5},path:[-65,60,-65,65,-60,65,-65,60]}},Ji=function(t,e,n){var a=t.attackTarget,i=a.dx||0,o=a.dy||0,r={x:a.x+24*i,y:a.y+24*o};return Ot({x:e+t.x,y:n+t.y},r)+v.float(-.2,.2)},Qi=[function(t){return{x:65,y:65,rotation:Ji(t,65,65)}},function(t){return{x:65,y:-65,rotation:Ji(t,65,-65)}},function(t){return{x:-65,y:-65,rotation:Ji(t,-65,-65)}},function(t){return{x:-65,y:65,rotation:Ji(t,-65,65)}}],$i=function(t){function e(e){var n=t.call(this)||this;return n.type="PBase",n.geo=lt(Ki.body),n.reticleWidth2=30,n.reticleHeight2=30,n.hp=20,n.maxHp=20,n.canBeShielded=!0,n.canDisplayHit=!0,n.canExplode=!0,n.canHarvest=!0,n.canRepair=!0,n.canRefine=!0,n.canConstruct=!0,n.canOccupyPlanet=!0,n.canStoreMaterial=!0,n.materialsRaw=0,n.materialsFinished=0,n.canAutoTargetEnemy=!0,n.autoTargetSearchDist2=36e4,n.canAttack=!0,n.attackTurretPositions=Qi,n.canShootCannon=!0,n.reloadTime_Cannon=400,Object.assign(n,e),n.assignTeamColor(),n.geo.graphics.addChild(lt(Ki.turret1).graphics,lt(Ki.turret2).graphics,lt(Ki.turret3).graphics,lt(Ki.turret4).graphics),Math.random()<.4&&(n.shield=sr.create("PShield",{team:e.team,anchor:n})),n}return Zi(e,t),e}(Ve),to=(bi=function(t,e){return(bi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}bi(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),eo={type:it.Polygon,_name:"Planetary Colony",lineStyle:{width:1,color:255,alpha:1},path:[-30,40,-70,40,-70,-40,-30,-40,-30,40]},no=function(t){function e(e){var n=t.call(this)||this;return n.type="PColony",n.geo=lt(eo),n.reticleOffsetX=-50,n.reticleOffsetY=0,n.hp=15,n.maxHp=15,n.canDisplayHit=!0,n.canMine=!0,n.canExplode=!0,n.explosionOriginDx=-50,n.explosionOriginDy=0,n.canManufacture=!0,n.PRODUCT={Freighter:{cost:300,time:120},Fighter:{cost:500,time:90}},n.canOccupyPlanet=!0,n.canRepair=!0,n.REPAIR_COST_FINISHED=10,n.REPAIR_TIME=20,Object.assign(n,e),n.assignTeamColor(),n}return to(e,t),e}(Ve),ao=(Oi=function(t,e){return(Oi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Oi(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),io={type:it.Polygon,_name:"Planetary Communications Center",lineStyle:{width:1,color:255,alpha:1},path:[40,30,0,30,0,50,40,50,40,30,60,35,30,10,40,30]},oo=function(t){function e(e){var n=t.call(this)||this;return n.type="PComm",n.geo=lt(io),n.reticleOffsetX=31,n.reticleOffsetY=33,n.hp=7,n.maxHp=7,n.canDisplayHit=!0,n.canExplode=!0,n.explosionOriginDx=31,n.explosionOriginDy=33,n.canBeShielded=!0,n.canRepair=!0,n.canOccupyPlanet=!0,n.REPAIR_COST_FINISHED=2,n.REPAIR_TIME=10,Object.assign(n,e),n.assignTeamColor(),Math.random()<.15&&(n.shield=sr.create("PShield",{team:e.team,anchor:n,anchorOffsetX:31,anchorOffsetY:33})),n}return ao(e,t),e}(Ve),ro=(Ai=function(t,e){return(Ai=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Ai(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),lo={type:it.Polygon,_name:"Planetary Lab",lineStyle:{width:1,color:16777215,alpha:1},path:[0,-40,0,-70,50,-70,50,-40,0,-40]},co=function(t){function e(e){var n=t.call(this)||this;n.type="PLab",n.geo=lt(lo),n.reticleOffsetX=25,n.reticleOffsetY=-55,n.hp=10,n.maxHp=10,n.canShimmer=!0,n.isShimmering=!1,n.shimmerBlinkColor=1044495,n.canDevelopEquipment=!0,n.canDisplayHit=!0,n.canExplode=!0,n.explosionOriginDx=25,n.explosionOriginDy=-55,n.canOccupyPlanet=!0,Object.assign(n,e);var a=n.assignTeamColor();return n.shimmerNormalColor=a||10066329,n}return ro(e,t),e}(Ve),so=(Ci=function(t,e){return(Ci=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Ci(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),po={_name:"Planetary Shield",type:it.Circle,radius:30,collisionRadius:30,fill:{color:0,alpha:0},lineStyle:{width:1,color:43690,alpha:1}},uo=function(t){function e(e){var n=t.call(this)||this;return n.type="PShield",n.hp=20,n.maxHp=20,n.geo=lt(po),n.canDisplayHit=!0,n.canAnchor=!0,Object.assign(n,e),n}return so(e,t),e}(Ve),ho=(wi=function(t,e){return(wi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}wi(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),fo={body:{type:it.Polygon,lineStyle:{width:1,color:16711935,alpha:1},path:[-4,1,0,2,4,0,0,-2,-4,-1,-4,1],collisionPath:[-4,2,0,4,8,0,0,-4,-4,-2]},flame:{type:it.Polygon,lineStyle:{width:1,color:65535,alpha:1},path:[-4,-4,-8,-5,-4,-6]}},yo=function(t){function e(e){var n=t.call(this)||this;return n.type="Probe",n.geo=lt(fo.body),n.hp=2,n.maxHp=2,n.canMoveLinearly=!0,n.canFlock=!0,n.flameOn=function(){return n.setChildVisible(0,!0)},n.flameOff=function(){return n.setChildVisible(0,!1)},Object.assign(n,e),n.assignTeamColor(),n.geo.graphics.addChild(lt(fo.flame).graphics),n.flameOff(),n}return ho(e,t),e}(Ve),mo=(Fi=function(t,e){return(Fi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Fi(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),go={_name:"Orbital Sensor Array",type:it.Polygon,lineStyle:{width:1,color:255,alpha:1},path:[6,26,12,28,12,40,18,46,18,34,12,40,6,42]},vo=function(t){function e(e){var n=t.call(this)||this;return n.type="SensorArray",n.geo=lt(go),n.hp=5,n.maxHp=5,n.canExplode=!0,n.canDisplayHit=!0,n.canRepair=!0,n.canOccupySpacePort=!0,Object.assign(n,e),n.assignTeamColor(),n}return mo(e,t),e}(Ve),_o=(Mi=function(t,e){return(Mi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Mi(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),To={_name:"Space Dock",type:it.Polygon,lineStyle:{width:1,color:255,alpha:1},path:[6,-42,20,-42,20,-22,14,-26,6,-26]},Eo=function(t){function e(e){var n=t.call(this)||this;return n.type="SpaceDock",n.geo=lt(To),n.hp=8,n.maxHp=8,n.canExplode=!0,n.canDisplayHit=!0,n.canRepair=!0,n.canManufacture=!0,n.PRODUCT={Fighter:{cost:200,time:60},Probe:{cost:15,time:10}},n.canOccupySpacePort=!0,Object.assign(n,e),n.assignTeamColor(),n}return _o(e,t),e}(Ve),So=(Ri=function(t,e){return(Ri=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Ri(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Po={_name:"Space Port",body:{type:it.Polygon,lineStyle:{width:1,color:255,alpha:1},path:[-2,0,-6,-20,-6,-36,-2,-44,6,-44,6,-24,2,-20,2,20,6,24,6,44,-2,44,-6,36,-6,20,-2,0]},turret1:{type:it.Polygon,lineStyle:{width:1,color:65535,alpha:.5},path:[0,28,4,26,4,30,0,28]},turret2:{type:it.Polygon,lineStyle:{width:1,color:65535,alpha:.5},path:[0,-28,4,-26,4,-30,0,-28]},turret3:{type:it.Polygon,lineStyle:{width:1,color:65535,alpha:.5},path:[4,44,2,48,0,44]},turret4:{type:it.Polygon,lineStyle:{width:1,color:65535,alpha:.5},path:[4,-44,2,-48,0,-44]},flame1:{type:it.Polygon,lineStyle:{width:1,color:65535,alpha:1},path:[-6,20,-12,22,-6,24]},flame2:{type:it.Polygon,lineStyle:{width:1,color:65535,alpha:1},path:[-6,-24,-12,-22,-6,-20]},flame3:{type:it.Polygon,lineStyle:{width:1,color:65535,alpha:1},path:[-6,32,-12,34,-6,36]},flame4:{type:it.Polygon,lineStyle:{width:1,color:65535,alpha:1},path:[-6,-36,-12,-34,-6,-32]}},xo=function(t,e,n){var a=t.attackTarget,i=a.dx||0,o=a.dy||0,r={x:a.x+20*i,y:a.y+20*o};return Ot({x:e+t.x,y:n+t.y},r)+v.float(-.15,.15)},bo=Math.PI/2,Oo=[function(t){var e=28*Math.cos(t.rotation-bo),n=28*Math.sin(t.rotation-bo);return{x:e,y:n,rotation:xo(t,e,n)}},function(t){var e=-28*Math.cos(t.rotation-bo),n=-28*Math.sin(t.rotation-bo);return{x:e,y:n,rotation:xo(t,e,n)}},function(t){var e=46*Math.cos(t.rotation-bo),n=46*Math.sin(t.rotation-bo);return{x:e,y:n,rotation:xo(t,e,n)}},function(t){var e=-46*Math.cos(t.rotation-bo),n=-46*Math.sin(t.rotation-bo);return{x:e,y:n,rotation:xo(t,e,n)}}],Ao=function(t){function e(e){var n=t.call(this)||this;return n.type="SpacePort",n.geo=lt(Po.body),n.hp=35,n.maxHp=35,n.canRepair=!0,n.canRefine=!0,n.canOrbitPlanet=!0,n.orbitDistance=205,n.canAutoTargetEnemy=!0,n.canDisplayHit=!0,n.canExplode=!0,n.canAttack=!0,n.attackTurretPositions=Oo,n.canShootCannon=!0,n.reloadTime_Cannon=300,n.canCarryFighter=!0,n.canStoreMaterial=!0,n.materialsRaw=0,n.materialsFinished=0,Object.assign(n,e),n.assignTeamColor(),n.geo.graphics.addChild(lt(Po.flame1).graphics,lt(Po.flame2).graphics,lt(Po.flame3).graphics,lt(Po.flame4).graphics,lt(Po.turret1).graphics,lt(Po.turret2).graphics,lt(Po.turret3).graphics,lt(Po.turret4).graphics),n}return So(e,t),e}(Ve),Co=(ki=function(t,e){return(ki=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}ki(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),wo={type:it.Circle,radius:20,collisionRadius:10,fill:{color:0,alpha:0},lineStyle:{width:1,color:65535,alpha:1}},Fo=function(t){function e(e){var n=t.call(this)||this;return n.type="Shield",n.hp=12,n.maxHp=12,n.geo=lt(wo),n.canDisplayHit=!0,n.canAnchor=!0,Object.assign(n,e),n}return Co(e,t),e}(Ve),Mo=(Ii=function(t,e){return(Ii=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Ii(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Ro={type:it.Polygon,fill:{color:16777215,alpha:1},path:[-1,1,1,1,1,-1,-1,-1,-1,1]},ko=function(t){function e(e){var n=t.call(this)||this;return n.type="CannonShot",n.canMoveLinearly=!0,n.canDamage=!0,n.canMetabolize=!0,n.hp=60,n.damageHp=1,n.geo=lt(Ro),Object.assign(n,e),n}return Mo(e,t),e}(Ve),Io=(Di=function(t,e){return(Di=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Di(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Do={type:it.Polygon,lineStyle:{width:2,color:16777215,alpha:1},path:[-3,0,0,0,0,-3,0,0,0,3,0,0,3,0]},No=function(t){function e(e){var n=t.call(this)||this;return n.type="HeavyCannonShot",n.canShimmer=!0,n.shimmerNormalColor=65535,n.canMoveLinearly=!0,n.canDamage=!0,n.canMetabolize=!0,n.hp=40,n.damageHp=2,n.geo=lt(Do),Object.assign(n,e),n}return Io(e,t),e}(Ve),Lo=(Ni=function(t,e){return(Ni=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Ni(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Ho={type:it.Polygon,lineStyle:{width:1,color:16776960,alpha:1},path:[5,0,-5,0]},Bo=function(t){function e(e){var n=t.call(this)||this;return n.type="LaserBolt",n.canMoveLinearly=!0,n.canDamage=!0,n.canMetabolize=!0,n.hp=v.int(2,3),n.damageHp=30,n.geo=lt(Ho),Object.assign(n,e),n}return Lo(e,t),e}(Ve),Uo=(Li=function(t,e){return(Li=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Li(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),jo={missileBody:{type:it.Polygon,lineStyle:{width:1,color:16777215,alpha:1},path:[0,0,6,0]},missileFlame:{type:it.Polygon,lineStyle:{width:1,color:16711680,alpha:1},path:[0,0,-3,0]}},Go=function(t){function e(e){var n=t.call(this)||this;return n.type="HomingMissile",n.canShimmer=!0,n.shimmerNormalColor=15597568,n.canMoveLinearly=!0,n.canLimitSpeed=!0,n.MAX_SPEED=55,n.MAX_SPEED2=3025,n.canAccelerateToAttackTarget=!0,n.canDamage=!0,n.canMetabolize=!0,n.canAttack=!0,n.hp=60,n.damageHp=7,n.geo=lt(jo.missileBody),n.geo.graphics.addChild(lt(jo.missileFlame).graphics),Object.assign(n,e),n}return Uo(e,t),e}(Ve),zo=(Hi=function(t,e){return(Hi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Hi(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Wo={missileBody:{type:it.Polygon,lineStyle:{width:2,color:4474111,alpha:1},path:[0,0,8,0]},missileFlame:{type:it.Polygon,lineStyle:{width:1,color:16776960,alpha:1},path:[0,0,-2,0]}},Xo=function(t){function e(e){var n=t.call(this)||this;return n.type="ClusterRocket",n.geo=lt(Wo.missileBody),n.canExplode=!0,n.EXPLOSION_FRAGMENTS=20,n.EXPLOSION_SOUND="fire-heavy",n.canMoveLinearly=!0,n.canDamage=!0,n.canMetabolize=!0,n.canAttack=!0,n.hp=45,n.damageHp=.5,n.geo.graphics.addChild(lt(Wo.missileFlame).graphics),Object.assign(n,e),n}return zo(e,t),e}(Ve),qo=function(){return(qo=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Vo=new Bi,Yo={Probe:yo,PBase:$i,PColony:no,PComm:oo,PLab:co,PShield:uo,SpacePort:Ao,SpaceDock:Eo,SensorArray:vo,Fighter:zi,Freighter:Yi,Shield:Fo},Zo=[],Ko={CannonShot:ko,HeavyCannonShot:No,LaserBolt:Bo,HomingMissile:Go,ClusterRocket:Xo},Jo=[],Qo={Star:$e,Planet:Ke},$o=qo({},Qo,Yo,Ko),tr=Object.keys(Qo).concat(Object.keys(Yo),Object.keys(Ko));function er(t){var e=_i.getByType(t);e&&e.forEach(yi.update)}var nr=function(t){return 0<t.hp};function ar(){Vo.prepareNext(),Zo=Zo.filter(nr)}var ir,or,rr,lr,cr,sr={create:function(t,e){var n;return t in $o&&(n=new $o[t](e),yi.init(n),_i.add(n),t in Qo&&Jo.push(n)),n},updateAll:function(){tr.forEach(er)},commit:function(t){t.type in Yo&&Vo.commit(t)},prepareNext:ar,getBodies:function(){return Jo},getAbsoluteNearestByBodyType:function(t,e){var n,a=1/0;return Jo.filter(function(t){return t.type===e}).forEach(function(e){var i=bt(t,e);i<a&&(a=i,n=e)}),n},getNearestEnemyUnit:function(t,e){return void 0===e&&(e=1/0),Vo.getNearestEnemy(t,e)},getNearestUnits:function(t){return Vo.get1CellRadiusAroundEntity(t)},clearAll:function(){for(var t=0;t<4;t++)ar();Jo=[],_i.clearAll()},getAll:_i.getAll,destroy:_i.remove,getByType:_i.getByType};r.settings.SCALE_MODE=r.SCALE_MODES.NEAREST;var pr=new r.Container,ur=new r.Container,hr={};function dr(){or=innerWidth,lr=innerHeight,rr=or>>1,cr=lr>>1,ir&&(ir.resize(or,lr),Object.values(hr).forEach(function(t){return t()}))}var fr=function(t){var e=t.x,n=t.y;return e<-ur.x-200||e>-ur.x+or+200||n<-ur.y-200||n>-ur.y+lr+200},yr={init:function(){!function(){for(hr={};ur.children[0];)ur.removeChild(ur.children[0]);for(;pr.children[0];)pr.removeChild(pr.children[0]);pr.addChild(ur)}(),void 0===ir&&(dr(),pr.addChild(ur),ir=new r.WebGLRenderer(or,lr),document.body.appendChild(ir.view))},setGlobalAlpha:function(t){return pr.alpha=t},addChild:function(t){return ur.addChild(t)},removeChild:function(t){return ur.removeChild(t)},render:function(){return ir.render(pr)},centerOn:function(t){t&&(ur.x=-(t.x-rr),ur.y=-(t.y-cr))},addChildToHUD:function(t){if(t.modal){var e=t.modal,n=t.id,a=t.onResize;pr.addChild(e),hr[n]=a}else pr.addChild(t)},removeChildFromHUD:function(t){if(t.modal){var e=t.modal,n=t.id;pr.removeChild(e),delete hr[n]}else pr.removeChild(t)},cullRenderable:function(){sr.getAll().forEach(function(t){return t.geo.graphics.visible=!fr(t)})},onResize:dr,getSceneCoordFromStageCoord:function(t,e){return{x:t+ur.x,y:e+ur.y}}},mr=2,gr=.8,vr=8e3,_r=Math.pow(vr,2);function Tr(t){for(var e=sr.getByType("Star"),n=0;n<e.length;n++)if(e[n]!==t&&bt(t,e[n])<_r)return!1;return!0}function Er(){for(var t;!Tr(t={x:v.float(vr,st-vr),y:v.float(vr,st-vr)}););var e=sr.create("Star",t),n=e;if(v.float(0,1)<gr)for(var a=v.int(1,mr),i=0;i<a;i++)n=sr.create("Planet",{star:e,orbitDistance:1600+i*v.int(2,5)*800,orbitRotation:v.float(-Math.PI,Math.PI)});return n}var Sr=function(){return(Sr=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Pr=["Cannon","HeavyCannon","LaserBolt","HomingMissile","ClusterRocket"];function xr(t,e){var n=vt[t];if("Star"===e.type){var a=v.float(-Math.PI,Math.PI),i=e.x+1e3*Math.cos(a),o=e.y+1e3*Math.sin(a);(r=sr.create("Fighter",{x:i+v.int(-100,100),y:o+v.int(-100,100),attackWeapon:v.arrayElement(Pr),isFighterAutoAccelerated:!Tt(n),reloadTime_HeavyCannon:60,team:n})).shield=sr.create("Shield",{x:r.x,y:r.y,team:n,anchor:r}),sr.create("Freighter",{x:i+v.int(-100,100),y:o+v.int(-100,100),team:n,isOrbitingPlanet:!1,materialsFinished:500}),sr.create("Freighter",{x:i+v.int(-100,100),y:o+v.int(-100,100),team:n,attackWeapon:"HomingMissile",ammo_HomingMissile:240,target:r,isOrbitingPlanet:!1,materialsFinished:500}),sr.create("Freighter",{x:i+v.int(-100,100),y:o+v.int(-100,100),team:n,attackWeapon:"HomingMissile",isOrbitingPlanet:!1,materialsFinished:500}),sr.create("Freighter",{x:i+v.int(-100,100),y:o+v.int(-100,100),team:n,isOrbitingPlanet:!1,materialsFinished:500}),Oa.displayText(n,"Invasion fleet en route to hostile world.")}else{var r,l={team:n,planet:e};e.team=n,e.updateFlagColor(),(r=sr.create("Fighter",{isFighterAutoAccelerated:!Tt(n),team:n})).dockPlanet(e),e.pbase=sr.create("PBase",l),e.pcolony=sr.create("PColony",l),e.plab=sr.create("PLab",l),e.pcomm=sr.create("PComm",l),e.spaceport=sr.create("SpacePort",l);var c=Sr({},l,{spaceport:e.spaceport});e.spacedock=sr.create("SpaceDock",c),e.sensorarray=sr.create("SensorArray",c),sr.getByType("Planet").filter(function(t){return t.star===e.star&&t!==e}).forEach(function(t){t.team=n,t.updateFlagColor()})}}var br=["BLUE","GREEN","RED","YELLOW","MAGENTA"],Or={init:function(){for(var t=v.int(2,5),e=br.slice(),n=0;n<t;n++){var a=Er(),i=e.pop();i&&xr(i,a)}}};function Ar(){var t=this;this.buttons.forEach(function(e,n){n===t.activeIndex?e.mouseover():e.mouseout()})}function Cr(){this.activeIndex--,this.activeIndex<0&&(this.activeIndex=0),this.updateButtonState()}function wr(){this.activeIndex++;var t=this.buttons.length-1;this.activeIndex>t&&(this.activeIndex=t),this.updateButtonState()}function Fr(){var t=this.buttons[this.activeIndex];t&&t.click()}var Mr,Rr,kr=function(t){var e=t.width,n=void 0===e?640:e,a=t.height,i=void 0===a?480:a,o=new r.Graphics;o.lineStyle(1,65280,1),o.beginFill(0,1),o.drawRect(0,0,n,i),o.endFill();var l=function(){o.x=(innerWidth-n)/2,o.y=(innerHeight-i)/2};return l(),{id:Date.now().toString(16),modal:o,onResize:l,activeIndex:-1,buttons:[],updateButtonState:Ar,prevButton:Cr,nextButton:wr,clickButton:Fr}},Ir=function(t){var e=t.modal;yr.removeChildFromHUD(e)},Dr=function(t){var e=t.text,n=t.width,a=void 0===n?300:n,i=t.height,o=void 0===i?40:i,l=t.onClick,c=new r.Graphics;c.lineStyle(1,16777215,1),c.drawRect(0,0,a,o),c.tint=65280;var s=new r.Text(e,{fontFamily:"arial",fontSize:12,fill:16777215,align:"center"});return s.x=(a-s.width)/2,s.y=(o-s.height)/2,c.addChild(s),c.interactive=!0,c.interactiveChildren=!1,c.buttonMode=!0,c.hitArea=new r.Rectangle(0,0,a,o),c.mouseover=function(t){var e=(t||{currentTarget:this}).currentTarget;e.tint=16777215,e.getChildAt(0).tint=16711680,kt("switch-flick")},c.mouseout=function(t){var e=(t||{currentTarget:this}).currentTarget;e.tint=65280,e.getChildAt(0).tint=16777215},c.click=function(){l(),kt("nav")},c},Nr={create:function(t){var e=t.onClickContinue,n=kr({width:400,height:300}),a=Dr({text:"Continue to next sector",width:360,onClick:function(){Ir(n),e()}});a.x=20,a.y=240;var i=new r.Text("GALAXY CONQUERED\n\nAll enemies in this sector have been eradicated!\nYour empire encompasses all known worlds in this galaxy.",{fontFamily:"arial",fontSize:12,fill:16777215,align:"center"});return i.x=(400-i.width)/2,i.y=40,n.buttons.push(a),n.modal.addChild(a),n.modal.addChild(i),n}},Lr={create:function(t){var e=t.onClickContinue,n=kr({width:400,height:200}),a=Dr({text:"Retreat to a different sector",width:360,onClick:function(){Ir(n),e()}});a.x=20,a.y=140;var i=new r.Text("GALAXY LOST\n\nFriendly forces have been vanquished!\nYour empire has failed to establish\na foothold in this galaxy.",{fontFamily:"arial",fontSize:12,fill:16777215,align:"center"});return i.x=(400-i.width)/2,i.y=30,n.buttons.push(a),n.modal.addChild(a),n.modal.addChild(i),n}},Hr={create:function(t){var e=t.onClickContinue,n=kr({width:400,height:200}),a=Dr({text:"Return to main menu",width:360,onClick:function(){Ir(n),e()}});a.x=20,a.y=140;var i=cn.getScoreRank(),o=i.rank,l=i.score,c=new r.Text(["GAME OVER\n","Your career ends with a forced","retirement after recent losses.\n","Your final rank is "+o+".","Your final score is "+l+"."].join("\n"),{fontFamily:"arial",fontSize:12,fill:16777215,align:"center"});return c.x=(400-c.width)/2,c.y=30,n.buttons.push(a),n.modal.addChild(a),n.modal.addChild(c),n}},Br=1e3/60,Ur=!0,jr=0,Gr=.05,zr=!1;function Wr(){var t=Date.now(),e=t-Rr;if(!zr&&(te.update(),sr.updateAll(),sr.prepareNext()),Re.update(),Br<e){Ur&&(jr<1?jr+=Gr:Ur=!(jr=1),yr.setGlobalAlpha(jr));var n=K.getFocus();n&&(Oa.setFocus(n),yr.centerOn(n)),xt.update(),yr.cullRenderable(),A.process(n),Oa.update(),yr.render(),Rr=t-e%Br}Mr=requestAnimationFrame(Wr)}function Xr(){zr=!1,Yr(),Re.setControlledEntity(null)}function qr(t){if(Tt(t)){xt.clear(),cn.addSectorResult(-1),zr=!0,kt("galaxy-lose");var e;e=cn.getIsGameOver()?function(){var t=Hr.create({onClickContinue:function(){return location.reload()}});yr.addChildToHUD(t.modal),Re.setControlledEntity(t)}:Xr;var n=Lr.create({onClickContinue:e});yr.addChildToHUD(n.modal),Re.setControlledEntity(n)}}function Vr(t){if(Tt(t)){xt.clear(),zr=!0,cn.addSectorResult(1),kt("galaxy-win");var e=Nr.create({onClickContinue:Xr});yr.addChildToHUD(e.modal),Re.setControlledEntity(e)}}function Yr(){addEventListener("resize",Zr),Ur=!0,jr=0,sr.clearAll(),yr.init(),A.init().forEach(yr.addChild),xt.init(),Oa.init(),Or.init(),te.init(),te.setOnTeamLostCallback(qr),te.setOnTeamWinCallback(Vr)}function Zr(){Oa.onResize(),A.onResize(),yr.onResize()}var Kr,Jr,Qr={init:Yr,start:function(){Rr=Date.now(),Wr()},stop:function(){cancelAnimationFrame(Mr)},togglePause:function(){zr=!zr,kt("pause"),Oa.setPauseVisible(zr)},getIsPaused:function(){return zr}},$r=0,tl={update:function(t){var e=Date.now(),n=e-$r;if(62.5<n){var a=Z(),i=a.getInputState;(0,a.getEvents)();var o=i();o.up||o.up_arrow?t.prevButton():o.down||o.down_arrow?t.nextButton():(o.f||o.button0||o.button1||o.button2||o.button3)&&t.clickButton(),$r=e-n%62.5}}},el=function(){return window.open("how-to-play","_blank")},nl=function(){return window.open("http://github.com/jsyang/celestial","_blank")},al=function(t){var e=t.onClickNewGame,n=kr({width:340,height:360}),a=new r.Text("Build: Sun Dec 02 2018 -- 5463a2e\n",{fontFamily:"arial",fontSize:12,fill:1122833,align:"left"});a.x=0,a.y=370,n.modal.addChild(a);var i=360;i-=60;var o=Dr({text:"Source code",onClick:nl});o.x=20,o.y=i,n.modal.addChild(o),i-=60;var l=Dr({text:"How to play",onClick:el});l.x=20,l.y=i,n.modal.addChild(l),i-=60;var c=Dr({text:"New game",onClick:e});c.x=20,c.y=i,n.modal.addChild(c),n.buttons.push(c),n.buttons.push(l),n.buttons.push(o);var s,p,u=new r.Graphics;u.lineStyle(2,16776960,1);var h=.0625,d=.05;s=40,p=60,"celestial".split("").forEach(function(t){u.drawPolygon(rt(dt[t],s,p,h,d)),s+=30}),s=90,p=100,"combat".split("").forEach(function(t){u.drawPolygon(rt(dt[t],s,p,h,d)),s+=30});var f=new r.Graphics;return s=190,p=20,d=h=1/3,f.lineStyle(12,3355392,1),f.drawPolygon(rt(dt.symbol[0],s,p,h,d)),f.lineStyle(32,3355392,1),f.drawPolygon(rt(dt.symbol[1],s,p,h,d)),n.modal.addChild(f),n.modal.addChild(u),n},il=1e3/60,ol={x:0,y:0},rl=600,ll=0,cl=Math.PI/180*.02,sl=.05,pl=1,ul=!1;function hl(){var t=Date.now(),e=t-Jr,n=!0;ul||tl.update(fl),il<e&&(ul?(yr.setGlobalAlpha(pl),0<pl?pl-=sl:n=!(pl=1)):(ol.x=Math.cos(ll)*rl,ol.y=Math.sin(ll)*rl,ll+=cl,yr.centerOn(ol),A.process(ol)),yr.render(),Jr=t-e%il),n?Kr=requestAnimationFrame(hl):(cancelAnimationFrame(Kr),dl&&(removeEventListener("resize",yl),dl()))}var dl,fl=al({onClickNewGame:function(){return ul=!0}});function yl(){yr.onResize()}var ml={setFadeOutCallback:function(t){dl=t},start:function(){addEventListener("resize",yl),yr.init(),A.init().forEach(yr.addChild),yr.addChildToHUD(fl),Jr=Date.now(),hl()}},gl=n(143),vl=n.n(gl),_l=n(144),Tl=n.n(_l),El=/(^sounds\/|\.ogg$)/gi,Sl=/\.ogg$/i;function Pl(t){var e=[],n=[];return t.folder("sounds/").forEach(function(t,a){Sl.test(t)&&(e.push(a.name.replace(El,"")),n.push(a.async("arraybuffer")))}),Promise.all(n).then(function(t){return t.forEach(function(t,n){return function(t){var e=t.name,n=t.arrayBuffer;try{Ft.decodeAudioData(n).then(function(t){Mt[e]=t})}catch(t){console.warn('Failed to decode audio file "'+e+'"! '+t.toString())}}({name:e[n],arrayBuffer:t})})})}var xl,bl,Ol=function(){return new Promise(function(t,e){Tl.a.getBinaryContent("assets.zip",function(n,a){n?e(n):t(a)})}).then(function(t){return vl.a.loadAsync(t)}).then(Pl)},Al=function(t){return xl=t},Cl={},wl={update:function(){var t=Z().getEvents();t.PAUSE&&!Cl.PAUSE&&Ll.togglePause(),Ll.getIsPaused()||(t.FOCUS_NEXT_ENEMY&&!Cl.FOCUS_NEXT_ENEMY&&(A.process(null),K.setFocus(Al(pe(!0)))),t.TOGGLE_RADAR&&!Cl.TOGGLE_RADAR&&Ce.setVisible(!Ce.getIsVisible())),Cl=t},getControlledEntity:function(){return xl},setControlledEntity:Al},Fl=vt.MAGENTA,Ml=vt.BLUE,Rl=function(){var t=sr.create("Star",{x:5e3,y:5e3}),e=sr.create("Planet",{star:t,orbitDistance:3200,orbitRotation:0});e.team=Ml,e.updateFlagColor();var n={team:e.team,planet:e};e.pbase=sr.create("PBase",n);var a=sr.create("Fighter",{x:15e3,y:15e3,isFighterAutoAccelerated:!0,team:Fl,attackTarget:e.pbase});K.setFocus(a)},kl=1e3/60,Il=!1;function Dl(){var t=Date.now(),e=t-bl;if(!Il&&(sr.updateAll(),sr.prepareNext()),wl.update(),kl<e){var n=K.getFocus();n&&(Oa.setFocus(n),yr.centerOn(n)),yr.cullRenderable(),A.process(n),Oa.update(),yr.render(),bl=t-e%kl}requestAnimationFrame(Dl)}function Nl(){Oa.onResize(),A.onResize(),yr.onResize()}var Ll={init:function(){addEventListener("resize",Nl),sr.clearAll(),yr.init(),A.init().forEach(yr.addChild),Oa.init(wl),Rl()},start:function(){bl=Date.now(),Dl()},togglePause:function(){Il=!Il,Oa.setPauseVisible(Il)},getIsPaused:function(){return Il}},Hl=function(){Qr.init(),Qr.start()};addEventListener("DOMContentLoaded",function t(){var e;removeEventListener("DOMContentLoaded",t),e=q?function(){Ll.init(),Ll.start()}:X?Hl:V?y.start:(ml.setFadeOutCallback(Hl),ml.start),Ol().then(e)})}});