!function(t){function e(e){for(var a,r,l=e[0],c=e[1],s=e[2],h=0,u=[];h<l.length;h++)r=l[h],o[r]&&u.push(o[r][0]),o[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);for(p&&p(e);u.length;)u.shift()();return i.push.apply(i,s||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,l=1;l<n.length;l++){var c=n[l];0!==o[c]&&(a=!1)}a&&(i.splice(e--,1),t=r(r.s=n[0]))}return t}var a={},o={0:0},i=[];function r(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=a,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var l=window.webpackJsonp=window.webpackJsonp||[],c=l.push.bind(l);l.push=e,l=l.slice();for(var s=0;s<l.length;s++)e(l[s]);var p=c;i.push([295,1]),n()}({141:function(module,__webpack_exports__,__webpack_require__){"use strict";var pixi_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),pixi_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(pixi_js__WEBPACK_IMPORTED_MODULE_0__),TEXT="\nClick to add a new vertex to each polyline\n\nPress Z to undo last vertex\nPress Q / P to add / delete a layer\nPress H to export all layers\n\nPress S to set the scale of the preview / exported geometry\n",DIVISION=12,SIZE=400,scaleX=.25,scaleY=.25,layerPoints=[],editor,preview;function getRelativeXY(t){var e=t.data.originalEvent,n=e.x,a=e.y,o=DIVISION/SIZE,i=1/o,r=n-editor.x,l=a-editor.y;return{x:r,y:l,gridX:Math.min(Math.round(r*o)*i,SIZE),gridY:Math.min(Math.round(l*o)*i,SIZE)}}function onClick(t){var e=editor.children,n=getRelativeXY(t),a=n.gridX,o=n.gridY,i=e[e.length-1],r=layerPoints[layerPoints.length-1];r.push(a),r.push(o),updateLayer(i,r)}function onMouseMove(t){var e=getRelativeXY(t),n=e.gridX,a=e.gridY;editor.children[1].x=n,editor.children[1].y=a}function deleteLayer(){1<layerPoints.length?(editor.removeChild(editor.children[editor.children.length-1]),layerPoints.pop()):layerPoints[0]=[],updatePreview()}function exportLayers(){var t=1<layerPoints.length?JSON.stringify(layerPoints):JSON.stringify(layerPoints[0]);prompt("Exported geometry",t)}var setScale=function(){var userScaleX=prompt('Scale X coordinates\nYou may also use fractions here, e.g. "0.25" or "1/4"',scaleX.toString())||"1/4",userScaleY=prompt('Scale Y coordinates\nYou may also use fractions here, e.g. "0.25" or "1/4"',scaleY.toString())||"1/4";scaleX=parseFloat(eval(userScaleX)),scaleY=parseFloat(eval(userScaleY))};function onKeyPress(t){var e;switch(t.which){case 115:setScale(),updatePreview();break;case 104:exportLayers();break;case 112:deleteLayer();break;case 113:addLayer();break;case 122:var n=editor.children;(e=layerPoints[layerPoints.length-1]).pop(),e.pop(),updateLayer(n[n.length-1],e)}}function create(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),(editor=new pixi_js__WEBPACK_IMPORTED_MODULE_0__.Graphics).lineStyle(1,16777215,.25),editor.beginFill(0,0),editor.drawRect(0,0,SIZE,SIZE),editor.endFill(),editor.x=t,editor.y=e,editor.interactive=!0,editor.hitArea=new pixi_js__WEBPACK_IMPORTED_MODULE_0__.Rectangle(0,0,SIZE,SIZE),editor.buttonMode=!0,editor.click=onClick,editor.mousemove=onMouseMove,drawGridLines(),drawHelpLabel(),addSnapCursor(),addPreviewWindow(),addLayer(),addEventListener("keypress",onKeyPress),editor}function addPreviewWindow(){(preview=new pixi_js__WEBPACK_IMPORTED_MODULE_0__.Graphics).x=SIZE+20,preview.y=0,editor.addChild(preview)}function addSnapCursor(){var t=new pixi_js__WEBPACK_IMPORTED_MODULE_0__.Graphics;t.lineStyle(1,16711680,1),t.drawRect(-2,-2,4,4),editor.addChild(t)}function addLayer(){editor.addChild(new pixi_js__WEBPACK_IMPORTED_MODULE_0__.Graphics),layerPoints.push([])}function drawGridLines(){var t,e=SIZE/DIVISION;for(t=0;t<SIZE;t+=e)t>>0==SIZE>>1?editor.lineStyle(1,16777215,.5):editor.lineStyle(1,16777215,.25),editor.moveTo(t,0),editor.lineTo(t,SIZE);for(t=0;t<SIZE;t+=e)t>>0==SIZE>>1?editor.lineStyle(1,16777215,.5):editor.lineStyle(1,16777215,.25),editor.moveTo(0,t),editor.lineTo(SIZE,t)}function drawHelpLabel(){var t=new pixi_js__WEBPACK_IMPORTED_MODULE_0__.Text(TEXT,{fontFamily:"arial",fontSize:12,fill:16777215});t.x=0,t.y=editor.height,editor.addChild(t)}function updateLayer(t,e){t.clear(),t.lineStyle(1,16711680,1),t.drawPolygon(e),updatePreview()}function updatePreview(){preview.clear(),preview.lineStyle(1,65280,1);var t=function(t,e){return e%2?scaleX*t:scaleY*t};layerPoints.forEach(function(e){return preview.drawPolygon(e.map(t))})}function destroy(){removeEventListener("keypress",onKeyPress)}__webpack_exports__.a={create:create,destroy:destroy}},248:function(t,e){},295:function(t,e,n){"use strict";n.r(e);var a,o,i,r=n(0);r.settings.SCALE_MODE=r.SCALE_MODES.NEAREST;var l=new r.Container;function c(){o=innerWidth,i=innerHeight,a&&a.resize(o,i)}var s,p=function(){for(;l.children[0];)l.removeChild(l.children[0])},h={init:function(){p(),void 0===a&&(addEventListener("resize",c),c(),a=new r.WebGLRenderer(o,i),document.body.appendChild(a.view))},addChild:function(t){return l.addChild(t)},removeChild:function(t){return l.removeChild(t)},removeAllChildren:p,render:function(){return a.render(l)}},u=n(141),d=1e3/60;function f(){var t=Date.now(),e=t-s;d<e&&(h.render(),s=t-e%d),requestAnimationFrame(f)}var y=function(){h.init(),h.addChild(u.a.create(20,20)),s=Date.now(),f()},m=function(t,e){return Math.round(g(t,e))},g=function(t,e){return t+Math.random()*(e-t)},v={int:m,float:g,arrayElement:function(t){return t[m(0,t.length-1)]}},_=[];function T(t){var e=t.color,n=t.size,a=t.x,o=t.y,i=new r.Graphics;return i.beginFill(e),i.drawRect(0,0,n,n),i.lineWidth=n,i.endFill(),i.x=a,i.y=o,i}var E,S={BRIGHT:{speed:.01,count:8,size:2,color:11184810,x:0,y:0},DIM:{speed:.3,count:20,size:1,color:15790320,x:0,y:0}},x=innerWidth>>1,w=innerHeight>>1;function C(){b=null}var b=null;function A(t){if(t){var e=t.x,n=t.y,a=0,o=0;b?(a=e-b.x,o=n-b.y):(i=t,x=innerWidth>>1,w=innerHeight>>1,_.forEach(function(t){t.x=i.x+v.float(-x,x),t.y=i.y+v.float(-w,w)})),_.forEach(function(t,e,n,a){1===a.lineWidth?(t*=S.DIM.speed,e*=S.DIM.speed):(t*=S.BRIGHT.speed,e*=S.BRIGHT.speed),a.x+=t,a.y+=e,a.x<n.x-x?a.x=n.x+x:a.x>n.x+x&&(a.x=n.x-x),a.y<n.y-w?a.y=n.y+w:a.y>n.y+w&&(a.y=n.y-w)}.bind(null,a,o,t)),b={x:e,y:n}}else b=null;var i}var P,M,F,O,k,R={init:function(){var t;if(0===_.length){for(t=0;t<S.DIM.count;t++)_.push(T(S.DIM));for(t=0;t<S.BRIGHT.count;t++)_.push(T(S.BRIGHT))}else A(null);return E||(E=addEventListener("resize",C)),_},process:A};r.settings.SCALE_MODE=r.SCALE_MODES.NEAREST;var D=new r.Container,I=new r.Container;function L(){M=innerWidth,O=innerHeight,F=M>>1,k=O>>1,P&&P.resize(M,O)}var H,B=function(t){return D.addChild(t)},N=function(){for(;I.children[0];)I.removeChild(I.children[0]);for(;D.children[0];)D.removeChild(D.children[0]);D.addChild(I)},U={init:function(){N(),void 0===P&&(addEventListener("resize",L),L(),D.addChild(I),P=new r.WebGLRenderer(M,O),document.body.appendChild(P.view))},setGlobalAlpha:function(t){return D.alpha=t},addChild:function(t){return I.addChild(t)},removeChild:function(t){return I.removeChild(t)},removeAllChildren:N,render:function(){return P.render(D)},centerOn:function(t){t&&(I.x=F-t.x,I.y=k-t.y)},addChildToHUD:B,removeChildFromHUD:function(t){return D.removeChild(t)}},j={getFocus:function(){return{x:H.x,y:H.y}},setFocus:function(t){return H=t}},W=function(){return(W=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},G={left:!1,right:!1,up:!1,down:!1,analogAngle:0,button0:!1,button1:!1,button2:!1,button3:!1},z={getEvents:function(t){void 0===t&&(t=0);var e,n,a,o,i,r,l,c,s=navigator.getGamepads()[t];if(s){var p=s.axes,h=p[0],u=p[1],d=.1<Math.abs(h),f=.1<Math.abs(u),y=void 0;(d||f)&&(d||(h=0<h?1e-6:-1e-6),f||(u=0<u?1e-6:-1e-6),y=Math.atan2(u,h)),G={left:s.axes[0]<-.1,right:.1<s.axes[0],up:s.axes[1]<-.1,down:.1<s.axes[1],analogAngle:y,button0:s.buttons[0].pressed,button1:s.buttons[1].pressed,button2:s.buttons[2].pressed,button3:s.buttons[3].pressed}}return n=(e=G).left,a=e.right,e.up,o=e.analogAngle,i=e.button0,r=e.button1,l=e.button2,c=e.button3,{TURN_LEFT:Boolean(n),TURN_RIGHT:Boolean(a),ACCELERATE:Boolean(c),SPECIAL:Boolean(r),SHOOT:Boolean(i),PAUSE:Boolean(l),analogAngle:o}},getInputState:function(){return W({},G)}},q=function(){return(q=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},X={37:"left_arrow",38:"up_arrow",39:"right_arrow",40:"down_arrow",69:"e",80:"p",70:"f"},V={left_arrow:!1,right_arrow:!1,up_arrow:!1,down_arrow:!1,p:!1,e:!1,f:!1};window&&(window.addEventListener("keydown",function(t){var e=t.which;V[X[e]]=!0}),window.addEventListener("keyup",function(t){var e=t.which;V[X[e]]=!1}));var Y,Z,K,J={getEvents:function(){return{PAUSE:Boolean(V.p),SPECIAL:Boolean(V.e),TURN_LEFT:Boolean(V.left_arrow),TURN_RIGHT:Boolean(V.right_arrow),ACCELERATE:Boolean(V.up_arrow),SHOOT:Boolean(V.f)}},getInputState:function(){return q({},V)}};(Z=Y||(Y={}))[Z.Keyboard=0]="Keyboard",Z[Z.GamePad=1]="GamePad";var $=function(){var t=-1<location.search.indexOf("gamepad");K=t?Y.GamePad:Y.Keyboard},Q=function(){return K===Y.Keyboard?J:z},tt=0,et=62.5;function nt(t,e){var n=Date.now(),a=n-tt;et<a&&(e.up||e.up_arrow?t.prevButton():e.down||e.down_arrow?t.nextButton():(e.f||e.button0||e.button1||e.button2||e.button3)&&t.clickButton(),tt=n-a%et)}var at=32768,ot=.2,it=1,rt={d:[0,0,266.6666666666667,0,400,100,400,300,266.6666666666667,400,0,400,0,0],f:[400,0,0,0,0,400,0,200,300,200],g:[400,0,100,0,0,100,0,300,100,400,300,400,400,300,400,166.66666666666669,200,166.66666666666669],h:[0,0,0,400,0,200,400,200,400,0,400,400],j:[400,0,400,333.33333333333337,333.33333333333337,400,66.66666666666667,400,0,333.33333333333337],k:[0,0,0,400,0,200,266.6666666666667,200,400,0,266.6666666666667,200,400,400],n:[0,400,0,0,400,400,400,0],p:[0,400,0,0,300,0,400,100,300,200,0,200],q:[66.66666666666667,0,0,66.66666666666667,0,266.6666666666667,66.66666666666667,333.33333333333337,300,333.33333333333337,400,400,200,266.6666666666667,300,333.33333333333337,366.6666666666667,266.6666666666667,366.6666666666667,66.66666666666667,300,0,66.66666666666667,0],r:[0,400,0,0,300,0,400,100,300,200,0,200,300,200,400,266.6666666666667,400,400],u:[400,0,400,400,66.66666666666667,400,0,333.33333333333337,0,0],v:[0,0,0,133.33333333333334,200,400,400,133.33333333333334,400,0],w:[0,0,0,400,200,166.66666666666669,400,400,400,0],x:[0,0,0,100,66.66666666666667,200,200,200,66.66666666666667,200,0,300,0,400,0,300,66.66666666666667,200,333.33333333333337,200,400,100,400,0,400,100,333.33333333333337,200,400,300,400,400],y:[0,0,0,200,133.33333333333334,266.6666666666667,266.6666666666667,266.6666666666667,400,200,400,0,400,200,266.6666666666667,266.6666666666667,200,266.6666666666667,200,400],z:[0,0,400,0,400,33.333333333333336,0,300,0,400,400,400],c:[400,100,300,0,100,0,0,100,0,300,100,400,300,400,400,300],e:[400,0,0,0,0,200,300,200,0,200,0,400,400,400],l:[0,0,0,400,400,400],s:[400,0,100,0,0,100,100,200,300,200,400,300,300,400,0,400],t:[0,0,200,0,200,400,200,0,400,0],i:[0,0,400,0,200,0,200,400,0,400,400,400],a:[0,400,0,166.66666666666669,200,0,400,166.66666666666669,400,400,400,200,0,200],b:[400,100,300,0,0,0,0,400,300,400,400,300,300,200,0,200,300,200,400,100],m:[0,400,0,0,200,266.6666666666667,400,0,400,400],o:[0,100,100,0,300,0,400,100,400,300,300,400,100,400,0,300,0,100],symbol:[[0,233.33333333333334,0,166.66666666666669,33.333333333333336,66.66666666666667,66.66666666666667,33.333333333333336,166.66666666666669,0,233.33333333333334,0,333.33333333333337,33.333333333333336,366.6666666666667,66.66666666666667,400,166.66666666666669,400,233.33333333333334,366.6666666666667,333.33333333333337,333.33333333333337,366.6666666666667,233.33333333333334,400,166.66666666666669,400,66.66666666666667,366.6666666666667,33.333333333333336,333.33333333333337,0,233.33333333333334,400,166.66666666666669],[33.333333333333336,66.66666666666667,366.6666666666667,333.33333333333337]]},lt={NONE:-1,BLUE:0,GREEN:1,RED:2,YELLOW:3,MAGENTA:4},ct=[255,65280,16711680,16776960,16711935],st=function(t){return t===lt.MAGENTA},pt=n(14),ht=function(t,e){return new pt.Vector(t,e)},ut=2*Math.PI;function dt(t,e){var n=t.x,a=t.y,o=e.geo.collider,i=ht(n,a);return o instanceof pt.Circle?Object(pt.pointInCircle)(i,o):Object(pt.pointInPolygon)(i,o)}var ft=function(t,e,n,a,o){return void 0===e&&(e=0),void 0===n&&(n=0),void 0===a&&(a=1),void 0===o&&(o=1),t.map(function(t,i){return i%2==0?t*a+e:t*o+n})};function yt(t){var e,n=t.lineStyle,a=t.fill,o=t.path,i=t.radius,l=t.x,c=t.y,s=t.collisionPath,p=t.collisionRadius,h=t.type,u=new r.Graphics;n&&u.lineStyle(n.width,n.color,n.alpha),a?u.beginFill(a.color,a.alpha):u.beginFill(0,0),u.x=l||0,u.y=c||0;var d=ht(u.x,u.y);if("circle"===h)u.drawCircle(0,0,i),e=new pt.Circle(d,p||i);else{for(var f=[],y=s||o,m=0;m<y.length;m+=2)f.push(ht(y[m],y[m+1]));u.drawPolygon(o),e=new pt.Polygon(d,f)}return u.endFill(),{set x(t){t<0?t=0:at<t&&(t=at),this.graphics.x=t,this.collider.pos.x=t},set y(t){t<0?t=0:at<t&&(t=at),this.graphics.y=t,this.collider.pos.y=t},set rotation(t){ut<t?t-=ut:t<-ut&&(t+=ut),this.collider instanceof pt.Circle||(this.collider.setAngle(t),this.graphics.rotation=t)},get x(){return this.graphics.x},get y(){return this.graphics.y},get rotation(){return this.graphics.rotation},graphics:u,collider:e}}var mt=ft([200,0,166.66666666666669,100,200,0,233.33333333333334,100,200,0,200,400,166.66666666666669,300,200,400,233.33333333333334,300,200,400,200,200,0,200,100,166.66666666666669,0,200,100,233.33333333333334,0,200,400,200,300,166.66666666666669,400,200,300,233.33333333333334],-32,-32,.16,.16),gt=new r.Graphics;gt.lineStyle(1,65280,1),gt.drawPolygon(mt);var vt=function(t){return gt.visible=t},_t=40;function Tt(){gt.x=innerWidth-_t,gt.y=_t}var Et,St={init:function(){B(gt),Tt(),vt(!1),addEventListener("resize",Tt)},symbol:gt,setIconVisible:vt},xt={x:0,y:0},wt=function(t){var e=t.x,n=t.y;return xt={x:e,y:n}},Ct=function(t){return(t.up_arrow||t.up)&&(xt.y-=40),(t.down_arrow||t.down)&&(xt.y+=40),(t.left_arrow||t.left)&&(xt.x-=40),(t.right_arrow||t.right)&&(xt.x+=40),xt},bt=function(t){return Et=t},At={update:function(){var t,e,n,a,o,i,r,l,c=Q(),s=c.getEvents(),p=c.getInputState();if(s.PAUSE&&Vi.togglePause(),Vi.getIsPaused())Et&&Et.modal&&nt(Et,p);else if(Et)if(Et.modal)nt(Et,p);else if(0<Et.hp)switch(St.setIconVisible(!1),j.setFocus(Et),Et.type){case"Fighter":e=s,n=(t=Et).isDockedPlanet,a=t.isDockedSpacePort,o=t.team,i=t.planet,r=t.spaceport,(l=n||a)?e.SPECIAL&&(n&&i.team===o||a&&r.team===o)&&Vi.showDockedModal():("number"==typeof e.analogAngle?t.rotation=e.analogAngle:e.TURN_LEFT?t.rotation-=.05:e.TURN_RIGHT&&(t.rotation+=.05),t.isAttacking=e.SHOOT),e.ACCELERATE?(l&&(n?t.undockPlanet():a&&t.undockSpacePort(),t.accelerate(it)),t.flameOn(),t.accelerate(ot)):t.flameOff()}else wt(Et),bt(null);else j.setFocus(Ct(p)),St.setIconVisible(!0)},getControlledEntity:function(){return Et},setControlledEntity:bt},Pt={componentFlag:"canAutoTargetEnemy",DEFAULTS:{AUTO_TARGET_ENEMY_TIME:1500,autoTargetSearchDist2:16e4,autoTargetLastSearchTime:0},process:function(t){if(t.canAttack){var e=Date.now();e-t.autoTargetLastSearchTime>=t.AUTO_TARGET_ENEMY_TIME&&((n=t).attackTarget=Go.getNearestEnemyUnit(n,n.autoTargetSearchDist2),n.isAttacking=Boolean(n.attackTarget),t.autoTargetLastSearchTime=e)}var n}},Mt=new r.Graphics;Mt.x=4,Mt.y=216;var Ft=new r.Text("Unknown",{fontFamily:"arial",fontSize:12,fill:16316664,align:"left"});Ft.x=0,Ft.y=0;var Ot=new r.Graphics;Ot.x=0,Ot.y=16;var kt=new r.Graphics;kt.x=0,kt.y=16,Mt.addChild(Ft),Mt.addChild(Ot),Mt.addChild(kt);var Rt=function(){U.addChildToHUD(Mt)},Dt=function(){var t,e,n,a,o=At.getControlledEntity();o&&(Ft.text=o.type,e=(t=o).hp,n=t.maxHp,a=Math.floor(e/n*100),Ot.clear(),Ot.beginFill(6728294,1),Ot.drawRect(0,0,a,12),Ot.endFill(),kt.clear(),kt.beginFill(11167334,1),kt.drawRect(0,0,100-a,12),kt.endFill(),kt.x=a)},It=new r.Graphics;It.x=4,It.y=248;var Lt=new r.Text("Unarmed",{fontFamily:"arial",fontSize:12,fill:16316664,align:"left"});Lt.x=0,Lt.y=0;var Ht=new r.Text("",{fontFamily:"arial",fontSize:12,fill:16711680,align:"left"});Ht.x=0,Ht.y=14,It.addChild(Lt),It.addChild(Ht);var Bt=function(){U.addChildToHUD(It)},Nt=function(){var t=At.getControlledEntity();if(t){var e=t.attackWeapon,n=t.canAttack,a=t.ammo_HomingMissile,o=t.ammo_ClusterRocket,i=t.ammo_LaserBolt;if(n)switch(Lt.text=e){case"HomingMissile":Ht.text="|".repeat(a);break;case"ClusterRocket":Ht.text="|".repeat(o);break;case"LaserBolt":Ht.text="|".repeat(i);break;case"HeavyCannon":case"Cannon":default:Ht.text=""}}else Lt.text="Freelook mode",Ht.text="ON"};function Ut(t,e){var n=e.x-t.x,a=e.y-t.y;return Math.pow(n,2)+Math.pow(a,2)}function jt(t,e){var n=e.x-t.x,a=e.y-t.y;return Math.atan2(a,n)}var Wt,Gt,zt,qt,Xt=.08,Vt=Math.PI/180;function Yt(t){var e=t.trackWidth,n=t.trackColor,a=t.trackRadius,o=t.dialColor,i=t.dialSize,l=new r.Graphics;l.beginFill(0,0),l.lineStyle(e,n,Xt),l.drawCircle(0,0,a),l.endFill(),l.x=0,l.y=0;var c=new r.Graphics;c.beginFill(0,0),c.lineStyle(e,o,1);var s=.5*i;return c.arc(0,0,a,-s*Vt,s*Vt),c.endFill(),c.x=0,c.y=0,l.addChild(c),l}var Zt,Kt=!0,Jt=0,$t={init:function(){zt=Yt({trackWidth:4,trackRadius:45,trackColor:16777215,dialColor:65280,dialSize:6}),qt=Yt({trackWidth:4,trackRadius:50,trackColor:16777215,dialColor:16776960,dialSize:12}),Gt=Yt({trackWidth:1,trackRadius:50,trackColor:16777215,dialColor:16711680,dialSize:2});var t=new r.Text("Tactical Radar",{fontFamily:"arial",fontSize:8,fill:16316664,align:"center"});t.x=-t.width>>1,t.y=-t.height>>1,(Wt=new r.Container).addChild(zt,qt,Gt,t),Wt.x=54,Wt.y=162,Wt.visible=!0,U.addChildToHUD(Wt)},update:function(){if(Zt&&Kt){var t=Date.now();if(500<t-Jt){var e=Go.getAbsoluteNearestByBodyType(Zt,"Planet"),n=Go.getAbsoluteNearestByBodyType(Zt,"Star");(a={nearestEnemy:void 0,nearestPlanet:e&&jt(Zt,e),nearestStar:n&&jt(Zt,n)}).nearestEnemy?(Gt.visible=!0,Gt.rotation=a.nearestEnemy):Gt.visible=!1,a.nearestStar?(qt.visible=!0,qt.rotation=a.nearestStar):qt.visible=!1,a.nearestPlanet?(zt.visible=!0,zt.rotation=a.nearestPlanet):zt.visible=!1,Jt=t}}var a},setOrigin:function(t){var e=t.x,n=t.y;return Zt={x:e,y:n}},set isEnabled(t){Kt=t,Wt.visible=t},get isEnabled(){return Kt}},Qt=new r.Graphics;Qt.x=4,Qt.y=4;var te,ee,ne=100/at,ae=function(t){var e,n,a=t.type,o=t.team;switch(a){case"Planet":n=ie,e=4;break;case"Star":n=oe,e=2;break;case"Fighter":n=ct[o],e=2;break;case"Freighter":default:n=re,e=1}var i=t.x*ne,r=t.y*ne;Qt.beginFill(0,0),Qt.lineStyle(1,n,1),Qt.drawRect(i-e/2,r-e/2,e,e),Qt.endFill()},oe=16776960,ie=65280,re=11184810,le=0,ce=function(){U.addChildToHUD(Qt)},se=function(){var t=Date.now();500<t-le&&(Qt.clear(),Qt.beginFill(0,1),Qt.lineStyle(1,16777215,.3),Qt.drawRect(0,0,100,100),Qt.endFill(),Go.getByType("Star").forEach(ae),Go.getByType("Planet").forEach(ae),Go.getByType("Freighter").forEach(ae),Go.getByType("Fighter").forEach(ae),le=t)},pe=new r.Graphics;function he(){pe.x=.5*(innerWidth-pe.width),pe.y=.5*(innerHeight-pe.height)+40}pe.lineStyle(1,16777215,1),te=14,ee=0,"game".split("").forEach(function(t){pe.drawPolygon(ft(rt[t],te,ee,.03125,.025)),te+=17}),te=0,ee=20,"paused".split("").forEach(function(t){pe.drawPolygon(ft(rt[t],te,ee,.03125,.025)),te+=16});var ue={init:function(){pe.renderable=!1,U.addChildToHUD(pe)},setVisible:function(t){(pe.renderable=t)?(he(),addEventListener("resize",he)):removeEventListener("resize",he)}},de=new r.Container;function fe(){de.x=innerWidth-5,de.y=innerHeight}var ye=[],me=400;function ge(){de.children.forEach(function(t,e){t.text=ye[e],t.x=-t.width})}var ve=function(){for(var t;de.children.length<8;){t=new r.Text("",{fontFamily:"arial",fontSize:12,fill:11184810}),de.addChild(t),ye.push();var e=de.children.length-1;de.children[e].y=-20*(e+1)}ye=[],ge(),U.addChildToHUD(de),addEventListener("resize",fe),fe()},_e=function(){0<me?me--:(me=400,ye.shift(),ge())},Te=function(t){void 0===t&&(t=""),ye.push(t),8<ye.length&&ye.shift(),ge()},Ee={init:function(){ve(),ue.init(),$t.init(),ce(),Rt(),Bt()},update:function(){_e(),se(),$t.update(),Dt(),Nt()},displayText:function(t,e){st(t)&&Te(e)},setFocus:$t.setOrigin,setPauseVisible:ue.setVisible},Se={Freighter:{cost:800,time:1500},Fighter:{cost:500,time:100}},xe={componentFlag:"canManufacture",DEFAULTS:{orderManufacture:function(t){this.isManufacturing||(this.isManufacturing=!0,this.manufactureTime=Se[t].time,this.manufactureType=t,Ee.displayText(this.team,"Manufacturing new "+t+"."))},isManufacturing:!1,manufactureTime:0,manufactureType:void 0},process:function(t){if(t.isManufacturing){var e=t.planet,n=t.team;if(t.planet.pbase&&t.planet.pbase.materialsFinished>=t.PRODUCT[t.manufactureType].cost)if(0<t.manufactureTime)t.manufactureTime--;else{var a=t.x+v.int(-20,20),o=t.y+v.int(-20,20),i=Go.create(t.manufactureType,{x:a,y:o,team:n});"Fighter"===t.manufactureType?e.spaceport&&!e.spaceport.isCarryingFighter?i.dockSpacePort(e.spaceport):i.dockPlanet(e):"Freighter"===t.manufactureType&&i.enterPlanetOrbit(e),Ee.displayText(n,"New "+i.type+" manufactured."),t.isManufacturing=!1,t.manufactureType=void 0}}}},we={componentFlag:"canMoveLinearly",DEFAULTS:{dx:0,dy:0},process:function(t){t.isDockedPlanet||(t.x+=t.dx,t.y+=t.dy,0!==t.x&&t.x!==at||(t.dx=0),0!==t.y&&t.y!==at||(t.dy=0))}},Ce={TURN_RATE:.07,SPEED:2.5,DIST_HALT2:Math.pow(80,2)},be=Math.pow(200,2),Ae={componentFlag:"canMoveToColonizationTarget",DEFAULTS:Ce,process:function(t){var e,n,a,o,i=t.isOrbitingPlanet,r=t.colonizationTarget,l=t.DIST_HALT2;if(!i&&r){var c=Ut(t,r);if("Planet"===r.type&&(l=be),l<c){var s=(n=(e=t).rotation,a=jt(e,e.colonizationTarget),(o=Math.abs(a-n))>Math.PI?0<n?e.rotation+=e.TURN_RATE:e.rotation-=e.TURN_RATE:o>e.TURN_RATE?a<n?e.rotation-=e.TURN_RATE:e.rotation+=e.TURN_RATE:e.rotation=a,n=e.rotation);t.x+=Math.cos(s)*t.SPEED,t.y+=Math.sin(s)*t.SPEED,t.flameOn&&t.flameOn()}else"Planet"===r.type&&t.canOrbitPlanet&&t.enterPlanetOrbit(r),t.flameOff&&t.flameOff()}}},Pe={componentFlag:"canAnchor",process:function(t){0<t.anchor.hp?(t.x=t.anchor.x,t.y=t.anchor.y):Go.destroy(t)}},Me=[{type:"PLab",cost:200},{type:"PComm",cost:300},{type:"SpacePort",cost:1e3,prerequisite:"PColony"},{type:"SpaceDock",cost:500,prerequisite:"SpacePort",occupation:"SpacePort"},{type:"SensorArray",cost:500,prerequisite:"SpacePort",occupation:"SpacePort"}],Fe={componentFlag:"canConstruct",DEFAULTS:{constructionTime:8e3},process:function(t){0<t.materialsFinished&&(0<t.constructionTime?t.constructionTime--:(Me.some(function(t){var e=this.team,n=this.planet,a=t.type.toLowerCase(),o=!0;return t.prerequisite&&(o=Boolean(this.planet[t.prerequisite.toLowerCase()])),!!(!this.planet[a]&&this.materialsFinished>=t.cost&&o)&&("SpacePort"===t.occupation?this.planet[a]=Go.create(t.type,{spaceport:this.planet.spaceport,planet:n,team:e}):this.planet[a]=Go.create(t.type,{planet:n,team:e}),this.materialsFinished-=t.cost,!0)}.bind(t)),t.constructionTime=8e3))}},Oe=new AudioContext,ke={};function Re(t){var e=Oe.createBufferSource();e.buffer=ke[t],e.connect(Oe.destination),e.start()}var De=Math.pow(3e3,2),Ie=1/Math.log(De);function Le(t,e){var n=j.getFocus(),a=Math.max(Ut(e,n),1);if(a<De){var o=Oe.createBufferSource(),i=Oe.createGain();o.buffer=ke[t],i.gain.value=1-Math.log(a)*Ie,o.connect(i),i.connect(Oe.destination),o.start()}}function He(){var t=this,e=t.EXPLOSION_SOUND,n=t.EXPLOSION_FRAGMENTS,a=t.x,o=t.y,i=t.dx,r=t.dy,l=t.explosionOriginDx,c=t.explosionOriginDy;Le(e,this);for(var s=n;0<s;s--)Go.create("CannonShot",{x:l+a+v.float(-10,10),y:c+o+v.float(-10,10),team:lt.NONE,dx:v.float(-2,2)+(i||0),dy:v.float(-2,2)+(r||0)});this.hasExploded=!0}var Be={componentFlag:"canExplode",DEFAULTS:{explosionOriginDx:0,explosionOriginDy:0,EXPLOSION_SOUND:"collide",EXPLOSION_FRAGMENTS:6,hasExploded:!1,explode:He},process:function(t){var e=t.hasExploded,n=t.canExplode;t.hp<=0&&!e&&n&&He.call(t)}},Ne={componentFlag:"canOccupySpacePort",process:function(t){var e=t.spaceport,n=e.x,a=e.y,o=e.rotation;0<e.hp?(t.x=n,t.y=a,t.rotation=o):(t.explode&&t.explode(),Go.destroy(t))}},Ue={componentFlag:"canOrbitStar",DEFAULTS:{D_ROTATION:1e-4,orbitDistance:1800,orbitRotation:0},process:function(t){t.orbitRotation+=t.D_ROTATION,t.x=Math.cos(t.orbitRotation)*t.orbitDistance+t.star.x,t.y=Math.sin(t.orbitRotation)*t.orbitDistance+t.star.y}},je={enterPlanetOrbit:function(t){this.isOrbitingPlanet=!0,this.dx=0,this.dy=0,this.orbitRotation=jt(t,this),this.rotation=this.orbitRotation+We,this.planet=t,this.flameOff&&this.flameOff()},exitPlanetOrbit:function(){this.isOrbitingPlanet=!1,this.planet=void 0,this.flameOn&&this.flameOn()},isOrbitingPlanet:!0,D_ROTATION:1e-4,orbitDistance:105,orbitRotation:0},We=.5*Math.PI,Ge={componentFlag:"canOrbitPlanet",DEFAULTS:je,process:function(t){t.isOrbitingPlanet&&t.planet&&("SpacePort"===t.type?t.rotation=jt(t.planet,t):"Freighter"===t.type&&(t.rotation+=t.D_ROTATION),t.orbitRotation+=t.D_ROTATION,t.x=Math.cos(t.orbitRotation)*t.orbitDistance+t.planet.x,t.y=Math.sin(t.orbitRotation)*t.orbitDistance+t.planet.y)}},ze={componentFlag:"canDamage",DEFAULTS:{damageHp:1},process:function(t){Go.getNearestUnits(t).some(function(t){var e=this.team,n=this.damageHp;return!(t.team===e||!dt(this,t)||(Le(t.AUDIO_HIT||"hit",this),t.hp-=n,t.hitTime=10,Go.destroy(this),0))}.bind(t))}},qe={componentFlag:"canShootCannon",DEFAULTS:{lastShotTime_Cannon:0,reloadTime_Cannon:100},process:function(t){var e=t.isAttacking,n=t.attackWeapon;if(e&&"Cannon"===n){var a=Date.now();a-t.lastShotTime_Cannon>=t.reloadTime_Cannon&&(t.attackTurretPositions.forEach(function(t){var e=this.team,n=t(this),a=n.rotation,o=n.x,i=n.y,r=5*Math.cos(a),l=5*Math.sin(a),c=this.dx||0,s=this.dy||0;Go.create("CannonShot",{team:e,x:o+this.x-c,y:i+this.y-s,dx:r+c,dy:l+s})}.bind(t)),Le("fire",t),t.lastShotTime_Cannon=a)}}},Xe={componentFlag:"canShootHeavyCannon",DEFAULTS:{lastShotTime_HeavyCannon:0,reloadTime_HeavyCannon:120},process:function(t){var e=t.isAttacking,n=t.attackWeapon;if(e&&"HeavyCannon"===n){var a=Date.now();a-t.lastShotTime_HeavyCannon>=t.reloadTime_HeavyCannon&&(t.attackTurretPositions.forEach(function(t){var e=this.team,n=t(this),a=n.rotation,o=n.x,i=n.y,r=6*Math.cos(a),l=6*Math.sin(a),c=this.dx||0,s=this.dy||0;Go.create("HeavyCannonShot",{team:e,x:o+this.x-c,y:i+this.y-s,dx:r+c,dy:l+s})}.bind(t)),Le("fire",t),t.lastShotTime_HeavyCannon=a)}}},Ve={componentFlag:"canShootLaserBolt",DEFAULTS:{reload_LaserBolt:function(t){void 0===t&&(t=!0),this.ammo_LaserBolt<this.ammoMax_LaserBolt&&(Re("empty"),t?this.ammo_LaserBolt++:this.ammo_LaserBolt=this.ammoMax_LaserBolt)},range_LaserBolt:20,ammo_LaserBolt:4,ammoMax_LaserBolt:4,lastShotTime_LaserBolt:0,reloadTime_LaserBolt:1e3},process:function(t){var e=t.isAttacking,n=t.attackWeapon,a=t.ammo_LaserBolt;if(e&&"LaserBolt"===n){var o=Date.now();o-t.lastShotTime_LaserBolt>=t.reloadTime_LaserBolt&&0<a&&(t.attackTurretPositions.forEach(function(t){for(var e=this.team,n=this.range_LaserBolt,a=t(this),o=a.rotation,i=a.x,r=a.y,l=10*Math.cos(o),c=10*Math.sin(o),s=this.dx||0,p=this.dy||0,h=n;0<h;h--)Go.create("LaserBolt",{team:e,rotation:o,x:i+this.x-s+l*h,y:r+this.y-p+c*h})}.bind(t)),Le("laser",t),t.ammo_LaserBolt--,t.lastShotTime_LaserBolt=o)}}},Ye={componentFlag:"canShootHomingMissile",DEFAULTS:{reload_HomingMissile:function(t){void 0===t&&(t=!0),this.ammo_HomingMissile<this.ammoMax_HomingMissile&&(Re("empty"),t?this.ammo_HomingMissile++:this.ammo_HomingMissile=this.ammoMax_HomingMissile)},lastShotTime_HomingMissile:0,ammo_HomingMissile:40,ammoMax_HomingMissile:40},process:function(t){var e=t.isAttacking,n=t.ammo_HomingMissile,a=t.attackWeapon;if(e&&"HomingMissile"===a){var o=Date.now();200<=o-t.lastShotTime_HomingMissile&&0<n&&(t.attackTarget=Go.getNearestEnemyUnit(t,64e4),t.attackTurretPositions.forEach(function(t){var e=this.attackTarget,n=this.team,a=t(this),o=a.rotation,i=a.x,r=a.y,l=4*Math.cos(o),c=4*Math.sin(o),s=this.dx||0,p=this.dy||0;Go.create("HomingMissile",{team:n,attackTarget:e,rotation:o,x:i+this.x-s,y:r+this.y-p,dx:l+s,dy:c+p})}.bind(t)),t.lastShotTime_HomingMissile=o,t.ammo_HomingMissile--,Le("missile",t))}}},Ze={componentFlag:"canShootClusterRocket",DEFAULTS:{reload_ClusterRocket:function(t){void 0===t&&(t=!0),this.ammo_ClusterRocket<this.ammoMax_ClusterRocket&&(Re("empty"),t?this.ammo_ClusterRocket++:this.ammo_ClusterRocket=this.ammoMax_ClusterRocket)},lastShotTime_ClusterRocket:0,reloadTime_ClusterRocket:600,ammo_ClusterRocket:8,ammoMax_ClusterRocket:8},process:function(t){var e=t.isAttacking,n=t.attackWeapon,a=t.ammo_ClusterRocket;if(e&&"ClusterRocket"===n){var o=Date.now();o-t.lastShotTime_ClusterRocket>=t.reloadTime_ClusterRocket&&0<a&&(t.attackTurretPositions.forEach(function(t){var e=this.team,n=t(this),a=n.rotation,o=n.x,i=n.y,r=2.5*Math.cos(a),l=2.5*Math.sin(a),c=this.dx||0,s=this.dy||0;Go.create("ClusterRocket",{rotation:a,team:e,x:o+this.x-c,y:i+this.y-s,dx:r+c,dy:l+s})}.bind(t)),t.lastShotTime_ClusterRocket=o,t.ammo_ClusterRocket--,Le("bomb-release",t))}}},Ke={componentFlag:"canLimitSpeed",DEFAULTS:{MAX_SPEED:40,MAX_SPEED2:Math.pow(40,2)},process:function(t){var e=Math.pow(t.dx,2)+Math.pow(t.dy,2);if(e>t.MAX_SPEED2){var n=t.MAX_SPEED*Math.pow(e,-.5);t.dx*=n,t.dy*=n}}},Je={componentFlag:"canAccelerate",DEFAULTS:{accelerate:function(t){this.dx+=Math.cos(this.rotation)*t,this.dy+=Math.sin(this.rotation)*t}}},$e={componentFlag:"canAccelerateToAttackTarget",DEFAULTS:{delayBeforeTracking:5},process:function(t){if(0<t.delayBeforeTracking)t.delayBeforeTracking--;else{var e=t.attackTarget;if(e){var n=e.x,a=e.y;t.x>n?t.dx-=.26:t.x<n&&(t.dx+=.26),t.y>a?t.dy-=.26:t.y<a&&(t.dy+=.26),t.rotation=Math.atan2(t.dy,t.dx)}}}},Qe=.05,tn=.1,en=Math.PI/.05,nn=Math.pow(400,2),an=Math.pow(600,2),on=Math.pow(275,2),rn=5;function ln(t,e){void 0===e&&(e=ot),t.accelerate(e),t.flameOn()}var cn,sn,pn={componentFlag:"canAccelerateFighterToAttackTarget",DEFAULTS:{isFighterPreviouslyDocked:!1,isFighterAutoAccelerated:!0},process:function(t){var e,n;t.isFighterAutoAccelerated&&(n=(e=t).attackTarget,e.flameOff(),n&&(0<n.hp?function(t){var e,n=t.attackTarget,a=t.dx,o=t.dy,i=t.isDockedPlanet,r=t.isDockedSpacePort,l=t.isFighterPreviouslyDocked;if(i)t.isFighterPreviouslyDocked=!0,t.undockPlanet(),ln(t,2*it+ot);else if(r)t.isFighterPreviouslyDocked=!0,t.undockSpacePort(),ln(t,it+ot);else{var c,s=void 0,p=Ut(t,n),h=Math.pow(a,2)+Math.pow(o,2);c="PBase"===n.type?an:nn;var u=jt(t,n),d=Math.atan2(o,a),f=Math.pow(p/ot,.25)+en+rn,y=Math.sqrt(p/h);if(l&&h<9)s=t.rotation;else{if(t.isFighterPreviouslyDocked=!1,t.isAttacking=!1,s=y<=f?d+Math.PI:u,p<on)s=d+Math.PI;else if(p<c){var m=10*Math.cos(u),g=10*Math.sin(u);s=Math.atan2(g-o,m-a),t.isAttacking=Math.abs(s-t.rotation)<2*Qe}s>(e=t).rotation?e.rotation+=tn:e.rotation-=tn}!t.isAttacking&&Math.abs(Math.cos(s)-Math.cos(t.rotation))<Qe&&ln(t)}}(e):e.attackTarget=null))}},hn={componentFlag:"canDockPlanet",DEFAULTS:{isDockedPlanet:!1,dockPlanet:function(t){this.isDockedPlanet=!0,this.dx=0,this.dy=0,this.rotation=jt(t,this),(this.planet=t).isOccupied()||(t.team=this.team,t.updateFlagColor())},undockPlanet:function(){this.isDockedPlanet=!1,this.planet=void 0}},process:function(t){t.isDockedPlanet&&(t.x=105*Math.cos(t.rotation)+t.planet.x,t.y=105*Math.sin(t.rotation)+t.planet.y)}},un={componentFlag:"canDockSpacePort",DEFAULTS:{spaceport:null,isDockedSpacePort:!1,dockSpacePort:function(t){this.isDockedSpacePort=!0,this.dx=0,this.dy=0,this.rotation=t.rotation,this.spaceport=t,(this.spaceport.fighter=this).spaceport.isCarryingFighter=!0},undockSpacePort:function(){this.spaceport.fighter=null,this.spaceport.isCarryingFighter=!1,this.spaceport=null,this.isDockedSpacePort=!1}},process:function(t){var e=t.isDockedSpacePort,n=t.spaceport;e&&(t.rotation=n.rotation,t.x=211*Math.cos(t.rotation)+n.planet.x,t.y=211*Math.sin(t.rotation)+n.planet.y)}},dn=Math.pow(7,2),fn={componentFlag:"canCarryFighter",DEFAULTS:{fighter:null,isCarryingFighter:!1},process:function(t){t.isCarryingFighter||Go.getNearestUnits(t).some(function(t){var e=t.dx,n=t.dy,a=t.type,o=t.team,i=t.canDockSpacePort;return!!("Fighter"===a&&o===this.team&&i&&dt(this,t)&&Math.pow(e,2)+Math.pow(n,2)<=dn)&&(st(o)&&Re("repaired"),t.dockSpacePort(this),!0)}.bind(t))}},yn={componentFlag:"canColonizePlanet",DEFAULTS:{MAX_MATERIALS_FINISHED:500,colonizationTarget:null},process:function(t){var e,n,a,o,i,r,l,c,s,p,h=t.colonizationTarget,u=t.isOrbitingPlanet,d=t.planet,f=t.team;h&&u&&d&&(d.team===f?0<t.materialsFinished&&(void 0===t.supplyTime?t.supplyTime=600:0<t.supplyTime?t.supplyTime--:0===t.supplyTime&&(d.pbase?d.pcolony?d.spaceport?(function(t){var e=t.planet.pbase;if(0===e.materialsFinished){e.materialsFinished+=t.materialsFinished;var n=t.materialsFinished=0;e.materialsFinished>e.MAX_FINISHED_MATERIALS?(n=e.materialsFinished-e.MAX_FINISHED_MATERIALS,e.materialsFinished=e.MAX_MATERIALS_FINISHED,t.materialsFinished=n,t.unloadSupply()):(t.canExplode=!1,Go.destroy(t))}else if(0<t.planet.materialsFinished&&t.materialsFinished<t.MAX_MATERIALS_FINISHED){var a=t.MAX_MATERIALS_FINISHED-t.materialsFinished;a>=t.planet.materialsFinished?(t.materialsFinished+=t.planet.materialsFinished,t.planet.materialsFinished=0):(t.materialsFinished+=a,t.planet.materialsFinished-=a),t.loadSupply()}}(t),t.colonizationTarget=null):(n=(e=t).planet,a=e.team,o=e.orbitRotation,st(a)&&Re("nav"),n.spaceport=Go.create("SpacePort",{x:n.x,y:n.y,planet:n,team:a}),n.spaceport.enterPlanetOrbit(n),n.spaceport.orbitRotation=o,e.canExplode=!1,Go.destroy(e),Ee.displayText(f,"Colonization successful: SpacePort secured.")):(r=(i=t).planet,l=i.team,st(l)&&Re("nav"),r.pcolony=Go.create("PColony",{x:r.x,y:r.y,planet:r,team:l}),i.canExplode=!1,Go.destroy(i),Ee.displayText(f,"Colonization successful: Colony secured.")):(s=(c=t).planet,p=c.team,st(p)&&Re("nav"),s.pbase=Go.create("PBase",{x:s.x,y:s.y,planet:s,team:p}),c.canExplode=!1,Go.destroy(c),Ee.displayText(f,"Colonization successful: PBase secured.")))):h.isOccupied()||(h.team=f,h.updateFlagColor()))}},mn={HeavyCannon:.6,ClusterRocket:.5,HomingMissile:.4,LaserBolt:.2,Shield:.7},gn={componentFlag:"candevelopEquipment",DEFAULTS:{developEquipment_installTimeMax:150,developEquipment_installTime:150,developEquipment_timeMax:1600,developEquipment_time:1600,developEquipment_equipmentReady:""},process:function(t){var e=t.developEquipment_time,n=t.developEquipment_installTime,a=t.developEquipment_installTimeMax,o=t.developEquipment_timeMax,i=t.developEquipment_equipmentReady,r=t.team;if(Boolean(i))if(t.isShimmering=!0,0<n)t.developEquipment_installTime--;else{var l=Go.getNearestUnits(t).find(function(e){return e.team===r&&(e.isDockedPlanet&&e.planet===t.planet||e.isDockedSpacePort&&e.spaceport===t.planet.spaceport)});l&&("Shield"!==i||l.shield?"Cannon"===l.attackWeapon&&(l.attackWeapon=i,t.developEquipment_equipmentReady="",st(r)&&(Re("install"),l.isFighterAutoAccelerated||Ee.displayText(r,i+" installed."))):(l.shield=Go.create("Shield",{team:r,anchor:l}),t.developEquipment_equipmentReady="",st(r)&&(Re("install"),l.isFighterAutoAccelerated||Ee.displayText(r,i+" installed.")))),t.developEquipment_installTime=a}else if(t.isShimmering=!1,0<e)t.developEquipment_time--;else{t.developEquipment_time=o;var c=v.arrayElement(Object.keys(mn));Math.random()<mn[c]&&(t.developEquipment_equipmentReady=c,st(r)&&(Re("develop"),Ee.displayText(r,"New equipment: "+c+" available.")))}}},vn=function(){function t(){this.team=lt.NONE}return Object.defineProperty(t.prototype,"x",{get:function(){return this.geo.x},set:function(t){this.geo.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.geo.y},set:function(t){this.geo.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.geo.rotation},set:function(t){this.geo.rotation=t},enumerable:!0,configurable:!0}),t.prototype.getChildAt=function(t){return this.geo.graphics.getChildAt(t)},t.prototype.setChildVisible=function(t,e){this.getChildAt(t).visible=e},t.prototype.assignTeamColor=function(){var t=ct[this.team];return this.geo.graphics.currentPath.lineColor=t},t.prototype.renderHit=function(){0<this.hitTime?(this.hitTime--,this.geo.graphics.alpha=Math.random()):0===this.hitTime&&(this.hitTime=-1,this.geo.graphics.alpha=1)},t}(),_n=(cn=function(t,e){return(cn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}cn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Tn={type:"circle",radius:100,fill:{color:0,alpha:1},lineStyle:{width:1,color:65280,alpha:1}},En={type:"polygon",fill:{color:16777215,alpha:1},path:[-5,-4,-5,4,5,4,5,-4]},Sn=function(t){function e(e){var n=t.call(this)||this;return n.type="Planet",n.canOrbitStar=!0,n.canStoreMaterial=!0,n.materialsRaw=0,n.materialsFinished=0,n.hp=2e3,n.mass=180,n.geo=yt(Tn),n.geo.graphics.addChild(yt(En).graphics),Object.assign(n,e),n.updateFlagColor(),n}return _n(e,t),e.prototype.isOccupied=function(){return Boolean(this.pbase||this.plab||this.pcolony||this.pcomm)},e.prototype.updateFlagColor=function(){var t=this.geo.graphics.children[0];this.team===lt.NONE?t.visible=!1:(window.foo=t,window.doo=this,t.visible=!0,t.tint=ct[this.team])},e.DIST_SURFACE2=11025,e}(vn),xn=(sn=function(t,e){return(sn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}sn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),wn={type:"circle",radius:200,fill:{color:0,alpha:1},lineStyle:{width:1,color:16776960,alpha:1}},Cn=function(t){function e(e){var n=t.call(this)||this;return n.geo=yt(wn),n.type="Star",n.hp=1e4,n.mass=600,Object.assign(n,e),n}return xn(e,t),e.DIST_SURFACE2=4e4,e}(vn),bn=Math.pow(1e3,2),An=Math.pow(800,2),Pn=Math.PI/4,Mn=Math.pow(2.1,2),Fn=2*Math.PI;function On(t){t.explode(t),Go.destroy(t)}var kn={componentFlag:"canGravitate",DEFAULTS:{},process:function(t){var e=t.isDockedPlanet,n=t.isDockedSpacePort,a=t.hp;!e&&!n&&0<a&&Go.getBodies().forEach(function(t){var e=t.type;"Star"===e?function(t){var e=Ut(this,t);if(e<bn){var n=t.x-this.x,a=t.y-this.y,o=this.mass*t.mass/Math.pow(e,1.5);this.dx+=n*o,this.dy+=a*o,e<Cn.DIST_SURFACE2&&On(this)}}.call(this,t):"Planet"===e&&function(t){var e=Ut(this,t);if(e<An){var n=this.mass*t.mass/Math.pow(e,1.5),a=t.x-this.x,o=t.y-this.y;if(this.dx+=a*n,this.dy+=o*n,e<Sn.DIST_SURFACE2){var i=this.dx*this.dx+this.dy*this.dy,r=this.rotation,l=jt(t,this),c=Math.abs(l-r);c>Math.PI&&(0<r?r-=Fn:r+=Fn,c=Math.abs(l-r)),c<Pn&&i<Mn?this.dockPlanet(t):On(this)}}}.call(this,t)}.bind(t))}},Rn=Math.pow(20,2),Dn=[{componentFlag:"canFlock",DEFAULTS:{flockPoint:null},process:function(t){var e,n,a,o,i;t.canMoveLinearly&&(i=t,Go.getNearestUnits(i).filter(function(t){return t.canFlock&&t!==i}).forEach(function(t){var e=Ut(i,t);if(e<Rn){var n=-5;e<6&&(n*=4),i.dx+=(t.x-i.x)*n,i.dy+=(t.y-i.y)*n}}),function(t){var e=t.flockPoint;if(e){var n=jt(t,e);t.dx+=5*Math.cos(n),t.dy+=5*Math.sin(n)}}(t),n=(e=t).dx,a=e.dy,o=Math.atan2(a,n),e.rotation=o,e.dx=2.5*Math.cos(o),e.dy=2.5*Math.sin(o))}},hn,un,Pe,{componentFlag:"canOccupyPlanet",process:function(t){t.x=t.planet.x,t.y=t.planet.y}},Ne,Je,$e,pn,we,Ae,Ue,Ge,Ke,Pt,ze,{componentFlag:"canStoreMaterial",DEFAULTS:{MAX_RAW_MATERIALS:3e3,MAX_FINISHED_MATERIALS:2e3,materialsRaw:0,materialsFinished:0},process:function(){}},{componentFlag:"canHarvest",DEFAULTS:{HARVEST_RATE_RAW:35,HARVEST_RATE_FINISHED:25,HARVEST_TIME:10,harvestTime:0},process:function(t){0<t.harvestTime?t.harvestTime--:(t.harvestTime=t.HARVEST_TIME,0<t.planet.materialsRaw&&t.materialsRaw<t.MAX_RAW_MATERIALS&&(t.MAX_RAW_MATERIALS-t.materialsRaw<t.HARVEST_RATE_RAW?(t.planet.materialsRaw=0,t.materialsRaw+=t.MAX_RAW_MATERIALS-t.materialsRaw):(t.planet.materialsRaw-=t.HARVEST_RATE_RAW,t.materialsRaw+=t.HARVEST_RATE_RAW)),0<t.planet.materialsFinished&&t.materialsFinished<t.MAX_FINISHED_MATERIALS&&(t.MAX_FINISHED_MATERIALS-t.materialsFinished<t.HARVEST_RATE_FINISHED?(t.planet.materialsFinished=0,t.materialsFinished+=t.MAX_FINISHED_MATERIALS-t.materialsFinished):(t.planet.materialsFinished-=t.HARVEST_RATE_FINISHED,t.materialsFinished+=t.HARVEST_RATE_FINISHED)))}},{componentFlag:"canMine",DEFAULTS:{MINE_RATE:25,MINE_TIME:20,mineTime:20},process:function(t){0<t.mineTime?t.mineTime--:(t.mineTime=t.MINE_TIME,t.planet.materialsRaw+=t.MINE_RATE)}},gn,{componentFlag:"canRepair",DEFAULTS:{REPAIR_COST_FINISHED:25,REPAIR_TIME:30,repairTime:0},process:function(t){t.hp<t.maxHp&&t.materialsFinished>t.REPAIR_COST_FINISHED&&0<t.materialsFinished&&(0<t.repairTime?t.repairTime--:(t.hp++,t.materialsFinished-=t.REPAIR_COST_FINISHED,t.repairTime=t.REPAIR_TIME))}},{componentFlag:"canRefine",DEFAULTS:{REFINE_RATE_RAW_TO_FINISHED:.5},process:function(t){t.materialsFinished<t.MAX_FINISHED_MATERIALS?0<t.materialsRaw&&(t.materialsFinished+=t.REFINE_RATE_RAW_TO_FINISHED,t.materialsFinished>t.MAX_FINISHED_MATERIALS&&(t.planet.materialsFinished+=t.materialsFinished-t.MAX_FINISHED_MATERIALS,t.materialsFinished=t.MAX_FINISHED_MATERIALS),t.materialsRaw--):0<t.materialsRaw&&(t.planet.materialsFinished+=t.REFINE_RATE_RAW_TO_FINISHED,t.materialsRaw--)}},Fe,xe,{componentFlag:"canAttack",DEFAULTS:{attackTurretPositions:[],attackTarget:null,attackWeapon:"Cannon",isAttacking:!1}},qe,Xe,Ve,Ye,Ze,yn,fn,{componentFlag:"canMetabolize",process:function(t){t.hp--}},{componentFlag:"canDisplayHit",DEFAULTS:{hitTime:-1},process:function(t){t.renderHit&&t.renderHit()}},{componentFlag:"canShimmer",DEFAULTS:{isShimmering:!0,isShimmerBlink:!1,shimmerTime:3,shimmerTimeMax:3,shimmerBlinkColor:16777215,shimmerNormalColor:16711935},process:function(t){if(t.isShimmering){var e=t.shimmerBlinkColor,n=t.shimmerNormalColor,a=t.shimmerTime,o=t.shimmerTimeMax,i=t.isShimmerBlink;0<a?t.shimmerTime--:(t.shimmerTime=o,t.isShimmerBlink=!i),t.geo.graphics.tint=i?e:n}else t.geo.graphics.tint=t.shimmerNormalColor}},Be,kn,{DEFAULTS:{shield:null},componentFlag:"canBeShielded"}],In={init:function(t){Dn.forEach(function(e){e.DEFAULTS&&t[e.componentFlag]&&Object.keys(e.DEFAULTS).forEach(function(n){void 0===t[n]&&(t[n]=e.DEFAULTS[n])})})},update:function(t){0<t.hp?Dn.forEach(function(e){t[e.componentFlag]&&e.process&&e.process(t)}):t[Be.componentFlag]&&Be.process(t),0<t.hp?Go.commit(t):Go.destroy(t)}},Ln={},Hn=function(t){return Ln[t]||[]};function Bn(t){t.hp=0;var e=t.type.toLowerCase();t.planet&&delete t.planet[e],t.spaceport&&delete t.spaceport[e],t.fighter&&(t.fighter.hp=0,t.fighter.undockSpacePort(),delete t.fighter),t.anchor&&(t.anchor.shield=null,delete t.anchor),delete t.shield,delete t.attackTarget,delete t.colonizationTarget;var n=Hn(t.type),a=n.indexOf(t);-1!==a&&n.splice(a,1),U.removeChild(t.geo.graphics)}var Nn={add:function(t){var e=t.type;Ln[e]?Ln[e].push(t):Ln[e]=[t],U.addChild(t.geo.graphics)},remove:Bn,clearAll:function(){Object.keys(Ln).forEach(function(t){Ln[t].forEach(Bn),delete Ln[t]})},getByType:Hn},Un=at>>10;function jn(t,e,n){var a=t.x>>10,o=t.y>>10;return(a+=e||0)+(o+=n||0)*Un}var Wn,Gn,zn,qn,Xn,Vn,Yn,Zn,Kn,Jn,$n,Qn,ta,ea,na,aa,oa=function(){function t(){this.grid=[],this.nextGrid=[]}return t.prototype.prepareNext=function(){return this.grid=this.nextGrid,this.nextGrid=[],this},t.prototype.commit=function(t){var e=this.nextGrid;if(0<t.hp){var n=jn(t,0,0);e[n]instanceof Array?e[n].push(t):e[n]=[t]}return this},t.prototype.get1CellRadiusAroundEntity=function(t){var e=this.grid;return[].concat(e[jn(t,-1,-1)],e[jn(t,0,-1)],e[jn(t,1,-1)],e[jn(t,-1,0)],e[jn(t,0,0)],e[jn(t,1,0)],e[jn(t,0,1)],e[jn(t,-1,1)],e[jn(t,1,1)]).filter(Boolean)},t.prototype.getNearestEnemy=function(t,e){void 0===e&&(e=1/0);var n,a=this.get1CellRadiusAroundEntity(t).filter(function(e){return e.team!==t.team}),o=1/0;return a&&a.forEach(function(a){var i=Ut(t,a);i<=e&&i<o&&(o=i,n=a)}),n},t}(),ia=(Wn=function(t,e){return(Wn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Wn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),ra={type:"polygon",lineStyle:{width:1,color:255,alpha:1},path:[-2,2,-4,0,-2,-2,-4,-4,-4,-6,2,-4,0,-2,8,0,0,2,2,4,-4,6,-4,4,-2,2],collisionPath:[-4,-6,8,0,-4,6]},la={type:"polygon",lineStyle:{width:1,color:65535,alpha:1},path:[-4,-4,-8,-5,-4,-6]},ca={type:"polygon",lineStyle:{width:1,color:65535,alpha:1},path:[-4,4,-8,5,-4,6]},sa=[function(t){var e=t.geo.collider.calcPoints[1];return{x:e.x,y:e.y,rotation:t.rotation}}],pa=function(t){function e(e){var n=t.call(this)||this;return n.type="Fighter",n.geo=yt(ra),n.mass=10,n.hp=4,n.maxHp=4,n.rotation=0,n.canGravitate=!0,n.canExplode=!0,n.canAttack=!0,n.attackWeapon="Cannon",n.attackTurretPositions=sa,n.canBeShielded=!0,n.canShootLaserBolt=!0,n.canShootCannon=!0,n.canShootHeavyCannon=!0,n.canShootClusterRocket=!0,n.canShootHomingMissile=!0,n.canLimitSpeed=!0,n.canMoveLinearly=!0,n.canAccelerate=!0,n.canDockPlanet=!0,n.canDockSpacePort=!0,n.canAccelerateFighterToAttackTarget=!0,n.flameOn=function(){n.setChildVisible(0,!0),n.setChildVisible(1,!0)},n.flameOff=function(){n.setChildVisible(0,!1),n.setChildVisible(1,!1)},Object.assign(n,e),n.assignTeamColor(),n.geo.graphics.addChild(yt(la).graphics,yt(ca).graphics),n.flameOff(),n}return ia(e,t),e}(vn),ha=(Gn=function(t,e){return(Gn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Gn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),ua={type:"polygon",lineStyle:{width:1,color:15658734,alpha:1},collisionPath:[-44,-4,-38,-8,26,-10,44,0,26,10,-38,8,-44,4],path:[-26,-2,-26,-8,-38,-8,-38,2,-44,4,-44,-4,-38,-2,-38,8,-26,8,-26,-2,24,-2,26,-10,44,0,26,10,24,2,-26,2]},da={type:"polygon",lineStyle:{width:1,color:15658734,alpha:1},path:[-24,-2,-24,-12,22,-12,22,-2]},fa={type:"polygon",lineStyle:{width:1,color:15658734,alpha:1},path:[-24,2,-24,12,22,12,22,2]},ya={type:"polygon",lineStyle:{width:2,color:255,alpha:1},path:[34,0,42,0]},ma={type:"polygon",lineStyle:{width:1,color:65535,alpha:.5},path:[-34,0,-30,-3,-30,3,-34,0]},ga={type:"polygon",lineStyle:{width:1,color:65535,alpha:.5},path:[28,-3,32,0,28,3,28,-2]},va={type:"polygon",lineStyle:{width:1,color:65535,alpha:1},path:[-44,-2,-50,0,-44,2]},_a=function(t,e,n){var a=t.attackTarget,o=(a=a||{}).dx||0,i=a.dy||0,r={x:a.x+24*o,y:a.y+24*i};return jt({x:e+t.x,y:n+t.y},r)+v.float(-.2,.2)},Ta=[function(t){var e=-34*Math.cos(t.rotation),n=-34*Math.sin(t.rotation);return{x:e,y:n,rotation:_a(t,e,n)}},function(t){var e=32*Math.cos(t.rotation),n=32*Math.sin(t.rotation);return{x:e,y:n,rotation:_a(t,e,n)}}],Ea=function(t){function e(e){var n=t.call(this)||this;return n.type="Freighter",n.geo=yt(ua),n.hp=10,n.maxHp=10,n.canDisplayHit=!0,n.canOrbitPlanet=!0,n.isOrbitingPlanet=!1,n.orbitDistance=205,n.canExplode=!0,n.canColonizePlanet=!0,n.canMoveToColonizationTarget=!0,n.canStoreMaterial=!0,n.materialsRaw=0,n.materialsFinished=500,n.canAutoTargetEnemy=!0,n.autoTargetSearchDist2=16e4,n.canAttack=!0,n.attackTurretPositions=Ta,n.canShootHomingMissile=!0,n.canShootLaserBolt=!0,n.canShootCannon=!0,n.reloadTime_Cannon=400,n.loadSupply=function(){n.setChildVisible(2,!0),n.setChildVisible(3,!0)},n.unloadSupply=function(){n.setChildVisible(2,!1),n.setChildVisible(3,!1)},n.flameOn=function(){return n.setChildVisible(0,!0)},n.flameOff=function(){return n.setChildVisible(0,!1)},Object.assign(n,e),n.geo.graphics.addChild(yt(va).graphics,yt(ya).graphics,yt(da).graphics,yt(fa).graphics,yt(ma).graphics,yt(ga).graphics),n.assignTeamColor(),n.flameOff(),n}return ha(e,t),e.prototype.assignTeamColor=function(){this.getChildAt(1).currentPath.lineColor=ct[this.team]},e}(vn),Sa=(zn=function(t,e){return(zn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}zn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),xa={type:"polygon",lineStyle:{width:1,color:255,alpha:1},path:[-20,20,-20,-20,20,-20,20,20,-20,20]},wa={type:"polygon",lineStyle:{width:1,color:65280,alpha:.5},path:[65,-60,65,-65,60,-65,65,-60]},Ca={type:"polygon",lineStyle:{width:1,color:65280,alpha:.5},path:[-65,-60,-65,-65,-60,-65,-65,-60]},ba={type:"polygon",lineStyle:{width:1,color:65280,alpha:.5},path:[65,60,65,65,60,65,65,60]},Aa={type:"polygon",lineStyle:{width:1,color:65280,alpha:.5},path:[-65,60,-65,65,-60,65,-65,60]},Pa=function(t,e,n){var a=t.attackTarget,o=a.dx||0,i=a.dy||0,r={x:a.x+24*o,y:a.y+24*i};return jt({x:e+t.x,y:n+t.y},r)+v.float(-.2,.2)},Ma=[function(t){return{x:65,y:65,rotation:Pa(t,65,65)}},function(t){return{x:65,y:-65,rotation:Pa(t,65,-65)}},function(t){return{x:-65,y:-65,rotation:Pa(t,-65,-65)}},function(t){return{x:-65,y:65,rotation:Pa(t,-65,65)}}],Fa=function(t){function e(e){var n=t.call(this)||this;return n.type="PBase",n.geo=yt(xa),n.hp=20,n.maxHp=20,n.canDisplayHit=!0,n.canExplode=!0,n.canHarvest=!0,n.canRepair=!0,n.canRefine=!0,n.canConstruct=!0,n.canOccupyPlanet=!0,n.canStoreMaterial=!0,n.materialsRaw=0,n.materialsFinished=0,n.canAutoTargetEnemy=!0,n.autoTargetSearchDist2=36e4,n.canAttack=!0,n.attackTurretPositions=Ma,n.canShootCannon=!0,n.reloadTime_Cannon=400,Object.assign(n,e),n.assignTeamColor(),n.geo.graphics.addChild(yt(wa).graphics,yt(Ca).graphics,yt(ba).graphics,yt(Aa).graphics),n}return Sa(e,t),e}(vn),Oa=(qn=function(t,e){return(qn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}qn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),ka={type:"polygon",_name:"Planetary Colony",lineStyle:{width:1,color:255,alpha:1},path:[-30,40,-70,40,-70,-40,-30,-40,-30,40]},Ra=function(t){function e(e){var n=t.call(this)||this;return n.type="PColony",n.geo=yt(ka),n.hp=15,n.maxHp=15,n.canDisplayHit=!0,n.canMine=!0,n.canExplode=!0,n.explosionOriginDx=-50,n.explosionOriginDy=0,n.canManufacture=!0,n.PRODUCT={Freighter:{cost:300,time:120},Fighter:{cost:500,time:90}},n.canOccupyPlanet=!0,n.canRepair=!0,n.REPAIR_COST_FINISHED=10,n.REPAIR_TIME=20,Object.assign(n,e),n.assignTeamColor(),n}return Oa(e,t),e}(vn),Da=(Xn=function(t,e){return(Xn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Xn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Ia={type:"polygon",_name:"Planetary Communications Center",lineStyle:{width:1,color:255,alpha:1},path:[40,30,0,30,0,50,40,50,40,30,60,35,30,10,40,30]},La=function(t){function e(e){var n=t.call(this)||this;return n.type="PComm",n.geo=yt(Ia),n.hp=7,n.maxHp=7,n.canDisplayHit=!0,n.canExplode=!0,n.explosionOriginDx=31,n.explosionOriginDy=33,n.canRepair=!0,n.canOccupyPlanet=!0,n.REPAIR_COST_FINISHED=2,n.REPAIR_TIME=10,Object.assign(n,e),n.assignTeamColor(),n}return Da(e,t),e}(vn),Ha=(Vn=function(t,e){return(Vn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Vn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Ba={type:"polygon",_name:"Planetary Lab",lineStyle:{width:1,color:16777215,alpha:1},path:[0,-40,0,-70,50,-70,50,-40,0,-40]},Na=function(t){function e(e){var n=t.call(this)||this;n.type="PLab",n.geo=yt(Ba),n.hp=10,n.maxHp=10,n.canShimmer=!0,n.isShimmering=!1,n.shimmerBlinkColor=1044495,n.canDevelopEquipment=!0,n.canDisplayHit=!0,n.canExplode=!0,n.explosionOriginDx=20,n.explosionOriginDy=-52,n.canOccupyPlanet=!0,Object.assign(n,e);var a=n.assignTeamColor();return n.shimmerNormalColor=a,n}return Ha(e,t),e}(vn),Ua=(Yn=function(t,e){return(Yn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Yn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),ja={type:"polygon",lineStyle:{width:1,color:16711935,alpha:1},path:[-4,1,0,2,4,0,0,-2,-4,-1,-4,1],collisionPath:[-4,2,0,4,8,0,0,-4,-4,-2]},Wa={type:"polygon",lineStyle:{width:1,color:65535,alpha:1},path:[-4,-4,-8,-5,-4,-6]},Ga=function(t){function e(e){var n=t.call(this)||this;return n.type="Probe",n.geo=yt(ja),n.hp=2,n.maxHp=2,n.canMoveLinearly=!0,n.canFlock=!0,n.flameOn=function(){return n.setChildVisible(0,!0)},n.flameOff=function(){return n.setChildVisible(0,!1)},Object.assign(n,e),n.assignTeamColor(),n.geo.graphics.addChild(yt(Wa).graphics),n.flameOff(),n}return Ua(e,t),e}(vn),za=(Zn=function(t,e){return(Zn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Zn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),qa={_name:"Orbital Sensor Array",type:"polygon",lineStyle:{width:1,color:255,alpha:1},path:[6,26,12,28,12,40,18,46,18,34,12,40,6,42]},Xa=function(t){function e(e){var n=t.call(this)||this;return n.type="SensorArray",n.geo=yt(qa),n.hp=5,n.maxHp=5,n.canExplode=!0,n.canDisplayHit=!0,n.canRepair=!0,n.canOccupySpacePort=!0,Object.assign(n,e),n.assignTeamColor(),n}return za(e,t),e}(vn),Va=(Kn=function(t,e){return(Kn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Kn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Ya={_name:"Space Dock",type:"polygon",lineStyle:{width:1,color:255,alpha:1},path:[6,-42,20,-42,20,-22,14,-26,6,-26]},Za=function(t){function e(e){var n=t.call(this)||this;return n.type="SpaceDock",n.geo=yt(Ya),n.hp=8,n.maxHp=8,n.canExplode=!0,n.canDisplayHit=!0,n.canRepair=!0,n.canManufacture=!0,n.PRODUCT={Fighter:{cost:200,time:60},Probe:{cost:15,time:10}},n.canOccupySpacePort=!0,Object.assign(n,e),n.assignTeamColor(),n}return Va(e,t),e}(vn),Ka=(Jn=function(t,e){return(Jn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Jn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Ja={type:"polygon",lineStyle:{width:1,color:255,alpha:1},path:[-2,0,-6,-20,-6,-36,-2,-44,6,-44,6,-24,2,-20,2,20,6,24,6,44,-2,44,-6,36,-6,20,-2,0]},$a={type:"polygon",lineStyle:{width:1,color:65535,alpha:.5},path:[0,28,4,26,4,30,0,28]},Qa={type:"polygon",lineStyle:{width:1,color:65535,alpha:.5},path:[0,-28,4,-26,4,-30,0,-28]},to={type:"polygon",lineStyle:{width:1,color:65535,alpha:.5},path:[4,44,2,48,0,44]},eo={type:"polygon",lineStyle:{width:1,color:65535,alpha:.5},path:[4,-44,2,-48,0,-44]},no={type:"polygon",lineStyle:{width:1,color:65535,alpha:1},path:[-6,20,-12,22,-6,24]},ao={type:"polygon",lineStyle:{width:1,color:65535,alpha:1},path:[-6,-24,-12,-22,-6,-20]},oo={type:"polygon",lineStyle:{width:1,color:65535,alpha:1},path:[-6,32,-12,34,-6,36]},io={type:"polygon",lineStyle:{width:1,color:65535,alpha:1},path:[-6,-36,-12,-34,-6,-32]},ro=function(t,e,n){var a=t.attackTarget,o=a.dx||0,i=a.dy||0,r={x:a.x+20*o,y:a.y+20*i};return jt({x:e+t.x,y:n+t.y},r)+v.float(-.15,.15)},lo=Math.PI/2,co=[function(t){var e=28*Math.cos(t.rotation-lo),n=28*Math.sin(t.rotation-lo);return{x:e,y:n,rotation:ro(t,e,n)}},function(t){var e=-28*Math.cos(t.rotation-lo),n=-28*Math.sin(t.rotation-lo);return{x:e,y:n,rotation:ro(t,e,n)}},function(t){var e=46*Math.cos(t.rotation-lo),n=46*Math.sin(t.rotation-lo);return{x:e,y:n,rotation:ro(t,e,n)}},function(t){var e=-46*Math.cos(t.rotation-lo),n=-46*Math.sin(t.rotation-lo);return{x:e,y:n,rotation:ro(t,e,n)}}],so=function(t){function e(e){var n=t.call(this)||this;return n.type="SpacePort",n.geo=yt(Ja),n.hp=35,n.maxHp=35,n.canRepair=!0,n.canRefine=!0,n.canOrbitPlanet=!0,n.orbitDistance=205,n.canAutoTargetEnemy=!0,n.canDisplayHit=!0,n.canExplode=!0,n.canAttack=!0,n.attackTurretPositions=co,n.canShootCannon=!0,n.reloadTime_Cannon=300,n.canCarryFighter=!0,n.canStoreMaterial=!0,n.materialsRaw=0,n.materialsFinished=0,Object.assign(n,e),n.assignTeamColor(),n.geo.graphics.addChild(yt(no).graphics,yt(ao).graphics,yt(oo).graphics,yt(io).graphics,yt($a).graphics,yt(Qa).graphics,yt(to).graphics,yt(eo).graphics),n}return Ka(e,t),e}(vn),po=($n=function(t,e){return($n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}$n(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),ho={type:"circle",radius:20,collisionRadius:10,fill:{color:0,alpha:0},lineStyle:{width:1,color:65535,alpha:1}},uo=function(t){function e(e){var n=t.call(this)||this;return n.type="Shield",n.hp=12,n.maxHp=12,n.geo=yt(ho),n.canDisplayHit=!0,n.canAnchor=!0,Object.assign(n,e),n}return po(e,t),e}(vn),fo=(Qn=function(t,e){return(Qn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Qn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),yo={type:"polygon",fill:{color:16777215,alpha:1},path:[-1,1,1,1,1,-1,-1,-1,-1,1]},mo=function(t){function e(e){var n=t.call(this)||this;return n.type="CannonShot",n.canMoveLinearly=!0,n.canDamage=!0,n.canMetabolize=!0,n.hp=60,n.damageHp=1,n.geo=yt(yo),Object.assign(n,e),n}return fo(e,t),e}(vn),go=(ta=function(t,e){return(ta=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}ta(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),vo={type:"polygon",lineStyle:{width:2,color:16777215,alpha:1},path:[-3,0,0,0,0,-3,0,0,0,3,0,0,3,0]},_o=function(t){function e(e){var n=t.call(this)||this;return n.type="HeavyCannonShot",n.canShimmer=!0,n.shimmerNormalColor=65535,n.canMoveLinearly=!0,n.canDamage=!0,n.canMetabolize=!0,n.hp=40,n.damageHp=2,n.geo=yt(vo),Object.assign(n,e),n}return go(e,t),e}(vn),To=(ea=function(t,e){return(ea=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}ea(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Eo={type:"polygon",lineStyle:{width:1,color:16776960,alpha:1},path:[5,0,-5,0]},So=function(t){function e(e){var n=t.call(this)||this;return n.type="LaserBolt",n.canMoveLinearly=!0,n.canDamage=!0,n.canMetabolize=!0,n.hp=v.int(2,3),n.damageHp=30,n.geo=yt(Eo),Object.assign(n,e),n}return To(e,t),e}(vn),xo=(na=function(t,e){return(na=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}na(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),wo={type:"polygon",lineStyle:{width:1,color:16777215,alpha:1},path:[0,0,6,0]},Co={type:"polygon",lineStyle:{width:1,color:16711680,alpha:1},path:[0,0,-3,0]},bo=function(t){function e(e){var n=t.call(this)||this;return n.type="HomingMissile",n.canShimmer=!0,n.shimmerNormalColor=15597568,n.canMoveLinearly=!0,n.canLimitSpeed=!0,n.MAX_SPEED=55,n.MAX_SPEED2=3025,n.canAccelerateToAttackTarget=!0,n.canDamage=!0,n.canMetabolize=!0,n.canAttack=!0,n.hp=60,n.damageHp=6,n.geo=yt(wo),n.geo.graphics.addChild(yt(Co).graphics),Object.assign(n,e),n}return xo(e,t),e}(vn),Ao=(aa=function(t,e){return(aa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}aa(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Po={type:"polygon",lineStyle:{width:2,color:4474111,alpha:1},path:[0,0,8,0]},Mo={type:"polygon",lineStyle:{width:1,color:16776960,alpha:1},path:[0,0,-2,0]},Fo=function(t){function e(e){var n=t.call(this)||this;return n.type="ClusterRocket",n.geo=yt(Po),n.canExplode=!0,n.EXPLOSION_FRAGMENTS=20,n.EXPLOSION_SOUND="fire-heavy",n.canMoveLinearly=!0,n.canDamage=!0,n.canMetabolize=!0,n.canAttack=!0,n.hp=45,n.damageHp=.5,n.geo.graphics.addChild(yt(Mo).graphics),Object.assign(n,e),n}return Ao(e,t),e}(vn),Oo=function(){return(Oo=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},ko=new oa,Ro={Probe:Ga,PBase:Fa,PColony:Ra,PComm:La,PLab:Na,SpacePort:so,SpaceDock:Za,SensorArray:Xa,Fighter:pa,Freighter:Ea,Shield:uo},Do=[],Io={CannonShot:mo,HeavyCannonShot:_o,LaserBolt:So,HomingMissile:bo,ClusterRocket:Fo},Lo=[],Ho={Star:Cn,Planet:Sn},Bo=Oo({},Ho,Ro,Io),No=Object.keys(Ho).concat(Object.keys(Ro),Object.keys(Io));function Uo(t){var e=Nn.getByType(t);e&&e.forEach(In.update)}var jo=function(t){return 0<t.hp};function Wo(){ko.prepareNext(),Do=Do.filter(jo)}var Go={create:function(t,e){var n;return t in Bo&&(n=new Bo[t](e),In.init(n),Nn.add(n),t in Ho&&Lo.push(n)),n},updateAll:function(){No.forEach(Uo)},commit:function(t){t.type in Ro&&ko.commit(t)},prepareNext:Wo,getBodies:function(){return Lo},getAbsoluteNearestByBodyType:function(t,e){var n,a=1/0;return Lo.filter(function(t){return t.type===e}).forEach(function(e){var o=Ut(t,e);o<a&&(a=o,n=e)}),n},getNearestEnemyUnit:function(t,e){return void 0===e&&(e=1/0),ko.getNearestEnemy(t,e)},getNearestUnits:function(t){return ko.get1CellRadiusAroundEntity(t)},clearAll:function(){for(var t=0;t<4;t++)Wo();Lo=[],Nn.clearAll()},destroy:Nn.remove,getByType:Nn.getByType},zo=2,qo=.8,Xo=8e3,Vo=Math.pow(Xo,2);function Yo(t){for(var e=Go.getByType("Star"),n=0;n<e.length;n++)if(e[n]!==t&&Ut(t,e[n])<Vo)return!1;return!0}function Zo(){for(var t;!Yo(t={x:v.float(Xo,at-Xo),y:v.float(Xo,at-Xo)}););var e=Go.create("Star",t),n=e;if(v.float(0,1)<qo)for(var a=v.int(1,zo),o=0;o<a;o++)n=Go.create("Planet",{star:e,orbitDistance:1600+o*v.int(2,5)*800,orbitRotation:v.float(-Math.PI,Math.PI)});return n}var Ko=function(){return(Ko=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Jo=["Cannon","HeavyCannon","LaserBolt","HomingMissile","ClusterRocket"];function $o(t,e){var n=lt[t];if("Star"===e.type){var a=v.float(-Math.PI,Math.PI),o=e.x+1e3*Math.cos(a),i=e.y+1e3*Math.sin(a);(r=Go.create("Fighter",{x:o+v.int(-100,100),y:i+v.int(-100,100),attackWeapon:v.arrayElement(Jo),isFighterAutoAccelerated:!st(n),reloadTime_HeavyCannon:60,team:n})).shield=Go.create("Shield",{x:r.x,y:r.y,team:n,anchor:r}),Go.create("Freighter",{x:o+v.int(-100,100),y:i+v.int(-100,100),team:n,isOrbitingPlanet:!1,materialsFinished:500}),Go.create("Freighter",{x:o+v.int(-100,100),y:i+v.int(-100,100),team:n,attackWeapon:"HomingMissile",ammo_HomingMissile:240,target:r,isOrbitingPlanet:!1,materialsFinished:500}),Go.create("Freighter",{x:o+v.int(-100,100),y:i+v.int(-100,100),team:n,attackWeapon:"HomingMissile",isOrbitingPlanet:!1,materialsFinished:500}),Go.create("Freighter",{x:o+v.int(-100,100),y:i+v.int(-100,100),team:n,isOrbitingPlanet:!1,materialsFinished:500}),Ee.displayText(n,"Invasion fleet en route to hostile world.")}else{var r,l={team:n,planet:e};(r=Go.create("Fighter",{isFighterAutoAccelerated:!st(n),team:n})).dockPlanet(e),e.pbase=Go.create("PBase",l),e.pcolony=Go.create("PColony",l),e.plab=Go.create("PLab",l),e.pcomm=Go.create("PComm",l),e.spaceport=Go.create("SpacePort",l);var c=Ko({},l,{spaceport:e.spaceport});e.spacedock=Go.create("SpaceDock",c),e.sensorarray=Go.create("SensorArray",c),e.team=n,e.updateFlagColor(),Go.getByType("Planet").filter(function(t){return t.star===e.star&&t!==e}).forEach(function(t){t.team=n,t.updateFlagColor()})}}var Qo,ti=["BLUE","GREEN","RED","YELLOW","MAGENTA"],ei={init:function(){for(var t=v.int(2,5),e=ti.slice(),n=0;n<t;n++){var a=Zo(),o=e.pop();o&&$o(o,a)}}};function ni(t){return!t.pbase||!t.pcolony}function ai(t){return t.pcolony&&!t.pcolony.isManufacturing}function oi(t,e,n){if(e){var a=void 0;if(st(t)&&Qo){var o=Qo.pcolony;o&&!o.isManufacturing&&(a=o)}a||(a=v.arrayElement(e).pcolony),a&&a.orderManufacture(n)}}function ii(t){var e=t.planet,n=t.isDockedPlanet,a=t.team,o=t.isDockedSpacePort,i=t.reload_HomingMissile,r=t.reload_ClusterRocket,l=t.reload_LaserBolt,c=!1;o?(t.hp<t.maxHp&&(c=st(a),t.hp=t.maxHp,Ee.displayText(t.team,"Fully repaired.")),i&&t.reload_HomingMissile(!1),r&&t.reload_ClusterRocket(!1),l&&t.reload_LaserBolt(!1)):n&&a===e.team&&e.isOccupied()&&(i&&t.reload_HomingMissile(),r&&t.reload_ClusterRocket(),l&&t.reload_LaserBolt(),t.hp<t.maxHp&&(c=st(a),t.hp+=.5,Ee.displayText(t.team,"Repairing: "+Math.round(t.hp/t.maxHp*100)+"%"))),c&&Re("repaired")}function ri(t){if(!t.colonizationTarget){var e,n=1/0;Go.getByType("Planet").forEach(function(a){var o=Ut(t,a);o<n&&(e=a,n=o)}),e&&(t.exitPlanetOrbit(),t.colonizationTarget=e)}}function li(t,e){var n=t.planet===Qo||t.spaceport&&t.spaceport.planet===Qo;return((e.planet===Qo||e.spaceport&&e.spaceport.planet===Qo)>>0)-(n>>0)}function ci(t){var e,n=function(e){return e.team===t},a=function(e){return e.team!==t},o=Go.getByType("Planet").filter(n),i=Go.getByType("PColony").filter(n),r=Go.getByType("Freighter").filter(n),l=Go.getByType("Fighter").filter(n);if(e=0<(e=o.filter(ai)).length?e:void 0,0===o.length&&0<r.length?r.forEach(ri):o.filter(ni).forEach(function(t,e){var n=!1;if(0<t.length){for(var a=t.length-1;0<=a;a--){var o=t[a];if(!Boolean(o.colonizationTarget)){o.isOrbitingPlanet&&o.exitPlanetOrbit(),o.colonizationTarget=e,n=!0;break}}n&&Ee.displayText(t[0].team,"Freighter fleet heading towards target.")}}.bind(null,r)),l.length<o.length&&oi(t,e,"Fighter"),0<l.length){var c=v.arrayElement(l);if(st(t)&&(Qo&&!st(Qo.team)&&(Qo=null),At.getControlledEntity()||(c=l.filter(function(t){return!t.isFighterAutoAccelerated||!t.attackTarget&&(t.planet||t.spaceport)}).sort(li)[0])&&(c.isFighterAutoAccelerated=!1,At.setControlledEntity(c),j.setFocus(c),R.init())),c&&!c.attackTarget&&c.isFighterAutoAccelerated){var s=Math.random(),p=void 0;s<.1?(p=v.arrayElement(Go.getByType("Freighter").filter(a)),Ee.displayText(t,"Friendly Fighter targeting enemy Freighter!")):s<.3&&(p=v.arrayElement(Go.getByType("PBase").filter(a)),Ee.displayText(t,"Friendly Fighter targeting enemy planet!")),p&&(c.attackTarget=p)}}l.forEach(ii),o.length>r.length&&oi(t,e,"Freighter"),0===i.length&&0===l.length&&0===r.length&&(si=si.filter(function(e){return e!==t}),ui(t))}var si,pi=0,hi=[lt.GREEN,lt.BLUE,lt.YELLOW,lt.RED,lt.MAGENTA],ui=new Function,di=new Function,fi={init:function(){si=hi.slice()},update:function(){var t=Date.now();3e3<t-pi&&(si.forEach(ci),1===si.length&&di(si[0]),pi=t)},setHumanTeamHomePlanet:function(t){Qo=t},setOnTeamLostCallback:function(t){return ui=t},setOnTeamWinCallback:function(t){return di=t}};function yi(){var t=this;this.buttons.forEach(function(e,n){n===t.activeIndex?e.mouseover():e.mouseout()})}function mi(){this.activeIndex--,this.activeIndex<0&&(this.activeIndex=0),this.updateButtonState()}function gi(){this.activeIndex++;var t=this.buttons.length-1;this.activeIndex>t&&(this.activeIndex=t),this.updateButtonState()}function vi(){var t=this.buttons[this.activeIndex];t&&t.click()}var _i,Ti,Ei=function(t){var e=t.width,n=void 0===e?640:e,a=t.height,o=void 0===a?480:a,i=new r.Graphics;i.lineStyle(1,65280,1),i.beginFill(0,1),i.drawRect(0,0,n,o),i.endFill();var l=function(){i.x=(innerWidth-n)/2,i.y=(innerHeight-o)/2};return l(),addEventListener("resize",l),{modal:i,onResize:l,activeIndex:-1,buttons:[],updateButtonState:yi,prevButton:mi,nextButton:gi,clickButton:vi}},Si=function(t){var e=t.modal,n=t.onResize;U.removeChildFromHUD(e),removeEventListener("resize",n)},xi=function(t){var e=t.text,n=t.width,a=void 0===n?300:n,o=t.height,i=void 0===o?40:o,l=t.onClick,c=new r.Graphics;c.lineStyle(1,16777215,1),c.drawRect(0,0,a,i),c.tint=65280;var s=new r.Text(e,{fontFamily:"arial",fontSize:12,fill:16777215,align:"center"});return s.x=(a-s.width)/2,s.y=(i-s.height)/2,c.addChild(s),c.interactive=!0,c.interactiveChildren=!1,c.buttonMode=!0,c.hitArea=new r.Rectangle(0,0,a,i),c.mouseover=function(t){var e=(t||{currentTarget:this}).currentTarget;e.tint=16777215,e.getChildAt(0).tint=16711680,Re("switch-flick")},c.mouseout=function(t){var e=(t||{currentTarget:this}).currentTarget;e.tint=65280,e.getChildAt(0).tint=16777215},c.click=function(){l(),Re("nav")},c},wi=function(t){var e=t.onClickSetHomePlanet,n=t.onClickSwapWeapon,a=t.onClickDone,o=Ei({width:400,height:250}),i=250;i-=60;var l=xi({text:"Done",width:360,onClick:function(){Si(o),a()}});l.x=20,l.y=i,i-=60;var c=xi({text:"Swap weapon",width:360,onClick:function(){Si(o),n()}});c.x=20,c.y=i,i-=60;var s=xi({text:"Set as home planet",width:360,onClick:function(){Si(o),e()}});s.x=20,s.y=i;var p=new r.Text("Fighter is docked to friendly facilities.",{fontFamily:"arial",fontSize:12,fill:16777215,align:"center"});return p.x=(400-p.width)/2,p.y=30,o.modal.addChild(p),o.buttons.push(s),o.modal.addChild(s),o.buttons.push(c),o.modal.addChild(c),o.buttons.push(l),o.modal.addChild(l),o},Ci="Cannon",bi=function(t){var e=t.fighter,n=t.onClickWeapon,a=e.attackWeapon,o=(e.planet?e.planet:e.spaceport.planet).plab,i=o&&o.developEquipment_equipmentReady,l=Ei({width:400,height:200}),c=200;[Ci,i].filter(Boolean).map(function(t){c-=60;var i=xi({text:"Switch to "+t,width:360,onClick:function(){o&&"Shield"!==o.developEquipment_equipmentReady&&(e.attackWeapon=o.developEquipment_equipmentReady||Ci,o.developEquipment_equipmentReady=a===Ci?"":a),n(),Si(l)}});i.x=20,i.y=c,l.modal.addChild(i),l.buttons.push(i)}),l.buttons.reverse();var s=new r.Text("Fighter is armed with "+e.attackWeapon+".",{fontFamily:"arial",fontSize:12,fill:16777215,align:"center"});return s.x=(400-s.width)/2,s.y=30,l.modal.addChild(s),l},Ai={create:function(t){var e=t.onClickContinue,n=Ei({width:400,height:300}),a=xi({text:"Continue to next sector",width:360,onClick:function(){Si(n),e()}});a.x=20,a.y=240;var o=new r.Text("GALAXY CONQUERED\n\nAll enemies in this sector have been eradicated!\nYour empire encompasses all known worlds in this galaxy.",{fontFamily:"arial",fontSize:12,fill:16777215,align:"center"});return o.x=(400-o.width)/2,o.y=40,n.buttons.push(a),n.modal.addChild(a),n.modal.addChild(o),n}},Pi={create:function(t){var e=t.onClickContinue,n=Ei({width:400,height:200}),a=xi({text:"Retreat to a different sector",width:360,onClick:function(){Si(n),e()}});a.x=20,a.y=140;var o=new r.Text("GALAXY LOST\n\nFriendly forces have been vanquished!\nYour empire has failed to establish\na foothold in this galaxy.",{fontFamily:"arial",fontSize:12,fill:16777215,align:"center"});return o.x=(400-o.width)/2,o.y=30,n.buttons.push(a),n.modal.addChild(a),n.modal.addChild(o),n}},Mi=1e3/60,Fi=!0,Oi=0,ki=.05,Ri=!1;function Di(){var t=Date.now(),e=t-Ti;if(!Ri&&(fi.update(),Go.updateAll(),Go.prepareNext()),At.update(),Mi<e){Fi&&(Oi<1?Oi+=ki:Fi=!(Oi=1),U.setGlobalAlpha(Oi));var n=j.getFocus();n&&(Ee.setFocus(n),U.centerOn(n)),R.process(n),Ee.update(),U.render(),Ti=t-e%Mi}_i=requestAnimationFrame(Di)}function Ii(){Ri=!1,Bi(),At.setControlledEntity(null)}function Li(t){if(st(t)){Ri=!0;var e=Pi.create({onClickContinue:Ii});U.addChildToHUD(e.modal),At.setControlledEntity(e)}}function Hi(t){if(st(t)){Ri=!0;var e=Ai.create({onClickContinue:Ii});U.addChildToHUD(e.modal),At.setControlledEntity(e)}}function Bi(){Fi=!0,Oi=0,Go.clearAll(),U.init(),St.init(),R.init().forEach(U.addChild),Ee.init(),ei.init(),fi.init(),fi.setOnTeamLostCallback(Li),fi.setOnTeamWinCallback(Hi)}var Ni,Ui,ji,Wi,Gi,zi,qi=function(){At.setControlledEntity(Ni),Ri=!1,Ni=null},Xi=function(){Ri=!0;var t=bi({fighter:Ni,onClickWeapon:qi});U.addChildToHUD(t.modal),At.setControlledEntity(t)},Vi={init:Bi,start:function(){Ti=Date.now(),Di()},stop:function(){cancelAnimationFrame(_i)},showDockedModal:function(){Ri=!0,Ni=At.getControlledEntity();var t=wi({onClickSetHomePlanet:function(){fi.setHumanTeamHomePlanet(Ni.planet||Ni.spaceport.planet),qi()},onClickSwapWeapon:Xi,onClickDone:qi});U.addChildToHUD(t.modal),At.setControlledEntity(t)},togglePause:(Ui=function(){Ri=!Ri,Re("pause"),Ee.setPauseVisible(Ri)},250,void 0===ji&&(ji=!1),function(){var t=this,e=arguments;clearTimeout(Wi),Wi=setTimeout(function(){Wi=null,ji||Ui.apply(t,e)},250),ji&&!Wi&&Ui.apply(t,e)}),getIsPaused:function(){return Ri}},Yi=0,Zi={update:function(t){var e=Date.now(),n=e-Yi;if(62.5<n){var a=Q(),o=a.getInputState;(0,a.getEvents)();var i=o();i.up||i.up_arrow?t.prevButton():i.down||i.down_arrow?t.nextButton():(i.f||i.button0||i.button1||i.button2||i.button3)&&t.clickButton(),Yi=e-n%62.5}}},Ki=function(){return window.open("how-to-play","_blank")},Ji=function(){return window.open("http://github.com/jsyang/celestial","_blank")},$i=function(t){var e=t.onClickNewGame,n=Ei({width:340,height:360}),a=new r.Text("Build: Sun Nov 11 2018 -- 924b86d\n",{fontFamily:"arial",fontSize:12,fill:1122833,align:"left"});a.x=0,a.y=370,n.modal.addChild(a);var o=360;o-=60;var i=xi({text:"GitHub project",onClick:Ji});i.x=20,i.y=o,n.modal.addChild(i),o-=60;var l=xi({text:"How to play",onClick:Ki});l.x=20,l.y=o,n.modal.addChild(l),o-=60;var c=xi({text:"New game",onClick:e});c.x=20,c.y=o,n.modal.addChild(c),n.buttons.push(c),n.buttons.push(l),n.buttons.push(i);var s,p,h=new r.Graphics;h.lineStyle(2,16776960,1);var u=.0625,d=.05;s=40,p=60,"celestial".split("").forEach(function(t){h.drawPolygon(ft(rt[t],s,p,u,d)),s+=30}),s=90,p=100,"combat".split("").forEach(function(t){h.drawPolygon(ft(rt[t],s,p,u,d)),s+=30});var f=new r.Graphics;return s=190,p=20,d=u=1/3,f.lineStyle(12,3355392,1),f.drawPolygon(ft(rt.symbol[0],s,p,u,d)),f.lineStyle(32,3355392,1),f.drawPolygon(ft(rt.symbol[1],s,p,u,d)),n.modal.addChild(f),n.modal.addChild(h),n},Qi=1e3/60,tr={x:0,y:0},er=600,nr=0,ar=Math.PI/180*.02,or=1,ir=.05,rr=!1;function lr(){var t=Date.now(),e=t-zi,n=!0;rr||Zi.update(sr),Qi<e&&(rr?(U.setGlobalAlpha(or),0<or?or-=ir:n=!(or=1)):(tr.x=Math.cos(nr)*er,tr.y=Math.sin(nr)*er,nr+=ar,U.centerOn(tr),R.process(tr)),U.render(),zi=t-e%Qi),n?Gi=requestAnimationFrame(lr):pr()}var cr,sr=$i({onClickNewGame:function(){return rr=!0}});function pr(){cancelAnimationFrame(Gi),cr&&cr()}var hr={setFadeOutCallback:function(t){cr=t},start:function(){U.init(),R.init().forEach(U.addChild),U.addChildToHUD(sr.modal),zi=Date.now(),lr()},stop:pr},ur=n(142),dr=n.n(ur),fr=n(143),yr=n.n(fr),mr=/(^sounds\/|\.ogg$)/gi,gr=/\.ogg$/i;var vr=function(){return new Promise(function(t,e){yr.a.getBinaryContent("assets.zip",function(n,a){n?e(n):t(a)})}).then(function(t){return dr.a.loadAsync(t)}).then(function(t){return function(t){var e=[],n=[];return t.folder("sounds/").forEach(function(t,a){gr.test(t)&&(e.push(a.name.replace(mr,"")),n.push(a.async("arraybuffer")))}),Promise.all(n).then(function(t){return t.forEach(function(t,n){return function(t){var e=t.name,n=t.arrayBuffer;try{Oe.decodeAudioData(n).then(function(t){ke[e]=t})}catch(t){console.warn('Failed to decode audio file "'+e+'"! '+t.toString())}}({name:e[n],arrayBuffer:t})})})}(t)})};function _r(){Vi.init(),Vi.start()}var Tr=location.search.match(/game$/),Er=location.search.match(/editor$/);addEventListener("DOMContentLoaded",function(){var t;t=Tr?_r:Er?y:(hr.setFadeOutCallback(_r),hr.start),$(),vr().then(t)})}});